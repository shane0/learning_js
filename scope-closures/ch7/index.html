
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../ch6/" rel="prev"/>
<link href="../ch8/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.6" name="generator"/>
<title>Chapter 7: Using Closures - shane0 learning_js</title>
<link href="../../assets/stylesheets/main.558e4712.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#chapter-7-using-closures">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="shane0 learning_js" class="md-header__button md-logo" data-md-component="logo" href="../.." title="shane0 learning_js">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            shane0 learning_js
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Chapter 7: Using Closures
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="shane0 learning_js" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="shane0 learning_js">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    shane0 learning_js
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../todo/">
        todo cli integration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../todocli/">
        todo cli
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4" tabindex="0">
          Bujo
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Bujo" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Bujo
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bujo/2023/">
        2023
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_5" tabindex="0">
          Es next beyond
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Es next beyond" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Es next beyond
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../es-next-beyond/ch1/">
        Chapter 1: TODO
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../es-next-beyond/toc/">
        TOC: ES.Next &amp; Beyond - 2nd Edition
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_6" tabindex="0">
          Get started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Get started" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Get started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/apA/">
        Appendix A: Exploring Further
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/apB/">
        Appendix B: Practice, Practice, Practice!
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch1/">
        Chapter 1: What *Is* JavaScript?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch2/">
        Chapter 2: Surveying JS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch3/">
        Chapter 3: Digging to the Roots of JS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch4/">
        Chapter 4: The Bigger Picture
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/toc/">
        Table of Contents
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_7" tabindex="0">
          Objects classes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Objects classes" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Objects classes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch1/">
        Chapter 1: Object Foundations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch2/">
        Chapter 2: How Objects Work
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch3/">
        Chapter 3: Classy Objects
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch4/">
        Chapter 4: This Works
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch5/">
        Chapter 5: Delegation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/toc/">
        You Don't Know JS Yet: Objects &amp; Classes - 2nd Edition
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/>
<label aria-expanded="true" class="md-nav__link" for="__nav_8" tabindex="0">
          Scope closures
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Scope closures" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
          Scope closures
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../apA/">
        Appendix A: Exploring Further
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../apB/">
        Appendix B: Practice
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch1/">
        Chapter 1: What's the Scope?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch2/">
        Chapter 2: Illustrating Lexical Scope
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch3/">
        Chapter 3: The Scope Chain
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch4/">
        Chapter 4: Around the Global Scope
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch5/">
        Chapter 5: The (Not So) Secret Lifecycle of Variables
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch6/">
        Chapter 6: Limiting Scope Exposure
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 7: Using Closures
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Chapter 7: Using Closures
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#see-the-closure">
    See the Closure
  </a>
<nav aria-label="See the Closure" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pointed-closure">
    Pointed Closure
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adding-up-closures">
    Adding Up Closures
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#live-link-not-a-snapshot">
    Live Link, Not a Snapshot
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-closures-ajax-and-events">
    Common Closures: Ajax and Events
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-if-i-cant-see-it">
    What If I Can't See It?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#observable-definition">
    Observable Definition
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-closure-lifecycle-and-garbage-collection-gc">
    The Closure Lifecycle and Garbage Collection (GC)
  </a>
<nav aria-label="The Closure Lifecycle and Garbage Collection (GC)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#per-variable-or-per-scope">
    Per Variable or Per Scope?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#an-alternative-perspective">
    An Alternative Perspective
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-closure">
    Why Closure?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#closer-to-closure">
    Closer to Closure
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch8/">
        Chapter 8: The Module Pattern
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../closures_bard/">
        closures bard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../scope_bard/">
        scope: bard version
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../toc/">
        Scope &amp; Closures - 2nd Edition
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" id="__nav_9" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_9" tabindex="0">
          Sync async
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Sync async" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
          Sync async
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sync-async/ch1/">
        Chapter 1: TODO
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sync-async/toc/">
        TOC: Sync &amp; Async - 2nd Edition
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" id="__nav_10" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_10" tabindex="0">
          Types grammar
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Types grammar" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
          Types grammar
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/ch1/">
        Chapter 1: Primitive Values
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/ch2/">
        Chapter 2: Primitive Behaviors
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/ch3/">
        Chapter 3: Object Values
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/ch4/">
        Chapter 4: Coercing Values
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/toc/">
        TOC: Types &amp; Grammar - 2nd Edition
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#see-the-closure">
    See the Closure
  </a>
<nav aria-label="See the Closure" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pointed-closure">
    Pointed Closure
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adding-up-closures">
    Adding Up Closures
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#live-link-not-a-snapshot">
    Live Link, Not a Snapshot
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-closures-ajax-and-events">
    Common Closures: Ajax and Events
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-if-i-cant-see-it">
    What If I Can't See It?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#observable-definition">
    Observable Definition
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-closure-lifecycle-and-garbage-collection-gc">
    The Closure Lifecycle and Garbage Collection (GC)
  </a>
<nav aria-label="The Closure Lifecycle and Garbage Collection (GC)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#per-variable-or-per-scope">
    Per Variable or Per Scope?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#an-alternative-perspective">
    An Alternative Perspective
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-closure">
    Why Closure?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#closer-to-closure">
    Closer to Closure
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<nav class="md-tags">
<a class="md-tag" href="../../#closures">closures</a>
</nav>
<h1 id="chapter-7-using-closures">Chapter 7: Using Closures<a class="headerlink" href="#chapter-7-using-closures" title="Permanent link">¶</a></h1>
<p>closures_bard.md</p>
<p>Up to this point, we've focused on the ins and outs of LEXICAL scope, and how that affects the organization and usage of variables in our programs.</p>
<p>Our attention again shifts broader in abstraction, to the historically somewhat daunting topic of closure. Don't worry! You don't need an advanced computer science degree to make sense of it. Our broad goal in this book is not merely to understand scope, but to more effectively use it in the structure of our programs; closure is central to that effort.</p>
<p>Recall the main conclusion of Chapter 6: the <em>least exposure</em> principle (POLE) encourages us to use block (and function) scoping to limit the scope exposure of variables. This helps keep code understandable and maintainable, and helps avoid many scoping pitfalls (i.e., name collision, etc.).</p>
<p>Closure builds on this approach: for variables we need to use over time, instead of placing them in larger outer scopes, we can encapsulate (more narrowly scope) them but still preserve access from inside functions, for broader use. Functions <em>remember</em> these referenced scoped variables via closure.</p>
<p>We already saw an example of this kind of closure in the previous chapter (<code>factorial(..)</code> in Chapter 6), and you've almost certainly already used it in your own programs. If you've ever written a callback that accesses variables outside its own scope... guess what!? That's closure.</p>
<p>Closure is one of the most important language characteristics ever invented in programming—it underlies major programming paradigms, including Functional Programming (FP), modules, and even a bit of class-oriented design. Getting comfortable with closure is required for mastering JS and effectively leveraging many important design patterns throughout your code.</p>
<p>Addressing all aspects of closure requires a daunting mountain of discussion and code throughout this chapter. Make sure to take your time and ensure you're comfortable with each bit before moving onto the next.</p>
<h2 id="see-the-closure">See the Closure<a class="headerlink" href="#see-the-closure" title="Permanent link">¶</a></h2>
<p>Closure is originally a mathematical concept, from lambda calculus. But I'm not going to list out math formulas or use a bunch of notation and jargon to define it.</p>
<p>Instead, I'm going to focus on a practical perspective. We'll start by defining closure in terms of what we can observe in different behavior of our programs, as opposed to if closure was not present in JS. However, later in this chapter, we're going to flip closure around to look at it from an <em>alternative perspective</em>.</p>
<p>Closure is a behavior of functions and only functions. If you aren't dealing with a function, closure does not apply. An object cannot have closure, nor does a class have closure (though its functions/methods might). Only functions have closure.</p>
<p>For closure to be observed, a function must be invoked, and specifically it must be invoked in a different branch of the scope chain from where it was originally defined. A function executing in the same scope it was defined would not exhibit any observably different behavior with or without closure being possible; by the observational perspective and definition, that is not closure.</p>
<p>Let's look at some code, annotated with its relevant scope bubble colors (see Chapter 2):</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">// outer/global scope: RED(1)</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kd">function</span><span class="w"> </span><span class="nx">lookupStudent</span><span class="p">(</span><span class="nx">studentID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="c1">// function scope: BLUE(2)</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">students</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">14</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kyle"</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">73</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Suzy"</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">112</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Frank"</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Sarah"</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="p">];</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">greetStudent</span><span class="p">(</span><span class="nx">greeting</span><span class="p">){</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">        </span><span class="c1">// function scope: GREEN(3)</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">student</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">students</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">            </span><span class="nx">student</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">student</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">studentID</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">        </span><span class="p">);</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="w"> </span><span class="nx">greeting</span><span class="w"> </span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="w"> </span><span class="nx">student</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="si">}</span><span class="sb">!`</span><span class="p">;</span>
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="p">}</span>
<a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="kd">var</span><span class="w"> </span><span class="nx">chosenStudents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">    </span><span class="nx">lookupStudent</span><span class="p">(</span><span class="mf">6</span><span class="p">),</span>
<a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="nx">lookupStudent</span><span class="p">(</span><span class="mf">112</span><span class="p">)</span>
<a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="p">];</span>
<a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="c1">// accessing the function's name:</span>
<a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="nx">chosenStudents</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">name</span><span class="p">;</span>
<a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="c1">// greetStudent</span>
<a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="nx">chosenStudents</span><span class="p">[</span><span class="mf">0</span><span class="p">](</span><span class="s2">"Hello"</span><span class="p">);</span>
<a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="c1">// Hello, Sarah!</span>
<a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="nx">chosenStudents</span><span class="p">[</span><span class="mf">1</span><span class="p">](</span><span class="s2">"Howdy"</span><span class="p">);</span>
<a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="c1">// Howdy, Frank!</span>
</code></pre></div>
<p>The first thing to notice about this code is that the <code>lookupStudent(..)</code> outer function creates and returns an inner function called <code>greetStudent(..)</code>. <code>lookupStudent(..)</code> is called twice, producing two separate instances of its inner <code>greetStudent(..)</code> function, both of which are saved into the <code>chosenStudents</code> array.</p>
<p>We verify that's the case by checking the <code>.name</code> property of the returned function saved in <code>chosenStudents[0]</code>, and it's indeed an instance of the inner <code>greetStudent(..)</code>.</p>
<p>After each call to <code>lookupStudent(..)</code> finishes, it would seem like all its inner variables would be discarded and GC'd (garbage collected). The inner function is the only thing that seems to be returned and preserved. But here's where the behavior differs in ways we can start to observe.</p>
<p>While <code>greetStudent(..)</code> does receive a single argument as the parameter named <code>greeting</code>, it also makes reference to both <code>students</code> and <code>studentID</code>, identifiers which come from the enclosing scope of <code>lookupStudent(..)</code>. Each of those references from the inner function to the variable in an outer scope is called a <em>closure</em>. In academic terms, each instance of <code>greetStudent(..)</code> <em>closes over</em> the outer variables <code>students</code> and <code>studentID</code>.</p>
<p>So what do those closures do here, in a concrete, observable sense?</p>
<p>Closure allows <code>greetStudent(..)</code> to continue to access those outer variables even after the outer scope is finished (when each call to <code>lookupStudent(..)</code> completes). Instead of the instances of <code>students</code> and <code>studentID</code> being GC'd, they stay around in memory. At a later time when either instance of the <code>greetStudent(..)</code> function is invoked, those variables are still there, holding their current values.</p>
<p>If JS functions did not have closure, the completion of each <code>lookupStudent(..)</code> call would immediately tear down its scope and GC the <code>students</code> and <code>studentID</code> variables. When we later called one of the <code>greetStudent(..)</code> functions, what would then happen?</p>
<p>If <code>greetStudent(..)</code> tried to access what it thought was a BLUE(2) marble, but that marble did not actually exist (anymore), the reasonable assumption is we should get a <code>ReferenceError</code>, right?</p>
<p>But we don't get an error. The fact that the execution of <code>chosenStudents[0]("Hello")</code> works and returns us the message "Hello, Sarah!", means it was still able to access the <code>students</code> and <code>studentID</code> variables. This is a direct observation of closure!</p>
<h3 id="pointed-closure">Pointed Closure<a class="headerlink" href="#pointed-closure" title="Permanent link">¶</a></h3>
<p>Actually, we glossed over a little detail in the previous discussion which I'm guessing many readers missed!</p>
<p>Because of how terse the syntax for <code>=&gt;</code> arrow functions is, it's easy to forget that they still create a scope (as asserted in "Arrow Functions" in Chapter 3). The <code>student =&gt; student.id == studentID</code> arrow function is creating another scope bubble inside the <code>greetStudent(..)</code> function scope.</p>
<p>Building on the metaphor of colored buckets and bubbles from Chapter 2, if we were creating a colored diagram for this code, there's a fourth scope at this innermost nesting level, so we'd need a fourth color; perhaps we'd pick ORANGE(4) for that scope:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">student</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">students</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="nx">student</span><span class="w"> </span><span class="p">=&gt;</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">        </span><span class="c1">// function scope: ORANGE(4)</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">        </span><span class="nx">student</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">studentID</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">);</span>
</code></pre></div>
<p>The BLUE(2) <code>studentID</code> reference is actually inside the ORANGE(4) scope rather than the GREEN(3) scope of <code>greetStudent(..)</code>; also, the <code>student</code> parameter of the arrow function is ORANGE(4), shadowing the GREEN(3) <code>student</code>.</p>
<p>The consequence here is that this arrow function passed as a callback to the array's <code>find(..)</code> method has to hold the closure over <code>studentID</code>, rather than <code>greetStudent(..)</code> holding that closure. That's not too big of a deal, as everything still works as expected. It's just important not to skip over the fact that even tiny arrow functions can get in on the closure party.</p>
<h3 id="adding-up-closures">Adding Up Closures<a class="headerlink" href="#adding-up-closures" title="Permanent link">¶</a></h3>
<p>Let's examine one of the canonical examples often cited for closure:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="nx">num1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">addTo</span><span class="p">(</span><span class="nx">num2</span><span class="p">){</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">num2</span><span class="p">;</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="p">}</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">add10To</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">add42To</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="mf">42</span><span class="p">);</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="nx">add10To</span><span class="p">(</span><span class="mf">15</span><span class="p">);</span><span class="w">    </span><span class="c1">// 25</span>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="nx">add42To</span><span class="p">(</span><span class="mf">9</span><span class="p">);</span><span class="w">     </span><span class="c1">// 51</span>
</code></pre></div>
<p>Each instance of the inner <code>addTo(..)</code> function is closing over its own <code>num1</code> variable (with values <code>10</code> and <code>42</code>, respectively), so those <code>num1</code>'s don't go away just because <code>adder(..)</code> finishes. When we later invoke one of those inner <code>addTo(..)</code> instances, such as the <code>add10To(15)</code> call, its closed-over <code>num1</code> variable still exists and still holds the original <code>10</code> value. The operation is thus able to perform <code>10 + 15</code> and return the answer <code>25</code>.</p>
<p>An important detail might have been too easy to gloss over in that previous paragraph, so let's reinforce it: closure is associated with an instance of a function, rather than its single LEXICAL definition. In the preceding snippet, there's just one inner <code>addTo(..)</code> function defined inside <code>adder(..)</code>, so it might seem like that would imply a single closure.</p>
<p>But actually, every time the outer <code>adder(..)</code> function runs, a <em>new</em> inner <code>addTo(..)</code> function instance is created, and for each new instance, a new closure. So each inner function instance (labeled <code>add10To(..)</code> and <code>add42To(..)</code> in our program) has its own closure over its own instance of the scope environment from that execution of <code>adder(..)</code>.</p>
<p>Even though closure is based on LEXICAL scope, which is handled at compile time, closure is observed as a runtime characteristic of function instances.</p>
<h3 id="live-link-not-a-snapshot">Live Link, Not a Snapshot<a class="headerlink" href="#live-link-not-a-snapshot" title="Permanent link">¶</a></h3>
<p>In both examples from the previous sections, we <strong>read the value from a variable</strong> that was held in a closure. That makes it feel like closure might be a snapshot of a value at some given moment. Indeed, that's a common misconception.</p>
<p>Closure is actually a live link, preserving access to the full variable itself. We're not limited to merely reading a value; the closed-over variable can be updated (re-assigned) as well! By closing over a variable in a function, we can keep using that variable (read and write) as long as that function reference exists in the program, and from anywhere we want to invoke that function. This is why closure is such a powerful technique used widely across so many areas of programming!</p>
<p>Figure 4 depicts the function instances and scope links:</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="images/fig4.png"><img align="center" alt="Function instances linked to scopes via closure" src="images/fig4.png" width="400"/></a>
<figcaption><em>Fig. 4: Visualizing Closures</em></figcaption>
<br/><br/>
</figure>
<p>As shown in Figure 4, each call to <code>adder(..)</code> creates a new BLUE(2) scope containing a <code>num1</code> variable, as well as a new instance of <code>addTo(..)</code> function as a GREEN(3) scope. Notice that the function instances (<code>addTo10(..)</code> and <code>addTo42(..)</code>) are present in and invoked from the RED(1) scope.</p>
<p>Now let's examine an example where the closed-over variable is updated:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">makeCounter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getCurrent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="p">}</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="kd">var</span><span class="w"> </span><span class="nx">hits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">makeCounter</span><span class="p">();</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="c1">// later</span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="nx">hits</span><span class="p">();</span><span class="w">     </span><span class="c1">// 1</span>
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="c1">// later</span>
<a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a>
<a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="nx">hits</span><span class="p">();</span><span class="w">     </span><span class="c1">// 2</span>
<a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="nx">hits</span><span class="p">();</span><span class="w">     </span><span class="c1">// 3</span>
</code></pre></div>
<p>The <code>count</code> variable is closed over by the inner <code>getCurrent()</code> function, which keeps it around instead of it being subjected to GC. The <code>hits()</code> function calls access <em>and</em> update this variable, returning an incrementing count each time.</p>
<p>Though the enclosing scope of a closure is typically from a function, that's not actually required; there only needs to be an inner function present inside an outer scope:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">hits</span><span class="p">;</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="p">{</span><span class="w">   </span><span class="c1">// an outer scope (but not a function)</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="nx">hits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getCurrent</span><span class="p">(){</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">;</span>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="p">}</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="nx">hits</span><span class="p">();</span><span class="w">     </span><span class="c1">// 1</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="nx">hits</span><span class="p">();</span><span class="w">     </span><span class="c1">// 2</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="nx">hits</span><span class="p">();</span><span class="w">     </span><span class="c1">// 3</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">I deliberately defined <code>getCurrent()</code> as a <code>function</code> expression instead of a <code>function</code> declaration. This isn't about closure, but with the dangerous quirks of FiB (Chapter 6).</td>
</tr>
</tbody>
</table>
<p>Because it's so common to mistake closure as value-oriented instead of variable-oriented, developers sometimes get tripped up trying to use closure to snapshot-preserve a value from some moment in time. Consider:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">studentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Frank"</span><span class="p">;</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="c1">// we are closing over `studentName`,</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="c1">// not "Frank"</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">        </span><span class="sb">`Hello, </span><span class="si">${</span><span class="w"> </span><span class="nx">studentName</span><span class="w"> </span><span class="si">}</span><span class="sb">!`</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="p">);</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="p">}</span>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="c1">// later</span>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="nx">studentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Suzy"</span><span class="p">;</span>
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="c1">// later</span>
<a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a>
<a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="nx">greeting</span><span class="p">();</span>
<a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="c1">// Hello, Suzy!</span>
</code></pre></div>
<p>By defining <code>greeting()</code> (aka, <code>hello()</code>) when <code>studentName</code> holds the value <code>"Frank"</code> (before the re-assignment to <code>"Suzy"</code>), the mistaken assumption is often that the closure will capture <code>"Frank"</code>. But <code>greeting()</code> is closed over the variable <code>studentName</code>, not its value. Whenever <code>greeting()</code> is invoked, the current value of the variable (<code>"Suzy"</code>, in this case) is reflected.</p>
<p>The classic illustration of this mistake is defining functions inside a loop:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">keeps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="nx">keeps</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">keepI</span><span class="p">(){</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">        </span><span class="c1">// closure over `i`</span>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="p">}</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">0</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 3 -- WHY!?</span>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">1</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 3</span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">2</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 3</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">This kind of closure illustration typically uses a <code>setTimeout(..)</code> or some other callback like an event handler, inside the loop. I've simplified the example by storing function references in an array, so that we don't need to consider asynchronous timing in our analysis. The closure principle is the same, regardless.</td>
</tr>
</tbody>
</table>
<p>You might have expected the <code>keeps[0]()</code> invocation to return <code>0</code>, since that function was created during the first iteration of the loop when <code>i</code> was <code>0</code>. But again, that assumption stems from thinking of closure as value-oriented rather than variable-oriented.</p>
<p>Something about the structure of a <code>for</code>-loop can trick us into thinking that each iteration gets its own new <code>i</code> variable; in fact, this program only has one <code>i</code> since it was declared with <code>var</code>.</p>
<p>Each saved function returns <code>3</code>, because by the end of the loop, the single <code>i</code> variable in the program has been assigned <code>3</code>. Each of the three functions in the <code>keeps</code> array do have individual closures, but they're all closed over that same shared <code>i</code> variable.</p>
<p>Of course, a single variable can only ever hold one value at any given moment. So if you want to preserve multiple values, you need a different variable for each.</p>
<p>How could we do that in the loop snippet? Let's create a new variable for each iteration:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">keeps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="c1">// new `j` created each iteration, which gets</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="c1">// a copy of the value of `i` at this moment</span>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="c1">// the `i` here isn't being closed over, so</span>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="c1">// it's fine to immediately use its current</span>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="c1">// value in each loop iteration</span>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="nx">keeps</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">keepEachJ</span><span class="p">(){</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">        </span><span class="c1">// close over `j`, not `i`!</span>
<a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">j</span><span class="p">;</span>
<a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="p">}</span>
<a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">0</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 0</span>
<a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">1</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 1</span>
<a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">2</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 2</span>
</code></pre></div>
<p>Each function is now closed over a separate (new) variable from each iteration, even though all of them are named <code>j</code>. And each <code>j</code> gets a copy of the value of <code>i</code> at that point in the loop iteration; that <code>j</code> never gets re-assigned. So all three functions now return their expected values: <code>0</code>, <code>1</code>, and <code>2</code>!</p>
<p>Again remember, even if we were using asynchrony in this program, such as passing each inner <code>keepEachJ()</code> function into <code>setTimeout(..)</code> or some event handler subscription, the same kind of closure behavior would still be observed.</p>
<p>Recall the "Loops" section in Chapter 5, which illustrates how a <code>let</code> declaration in a <code>for</code> loop actually creates not just one variable for the loop, but actually creates a new variable for <em>each iteration</em> of the loop. That trick/quirk is exactly what we need for our loop closures:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">keeps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="c1">// the `let i` gives us a new `i` for</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="c1">// each iteration, automatically!</span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="nx">keeps</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">keepEachI</span><span class="p">(){</span>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="p">}</span>
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">0</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 0</span>
<a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">1</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 1</span>
<a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="nx">keeps</span><span class="p">[</span><span class="mf">2</span><span class="p">]();</span><span class="w">   </span><span class="c1">// 2</span>
</code></pre></div>
<p>Since we're using <code>let</code>, three <code>i</code>'s are created, one for each loop, so each of the three closures <em>just work</em> as expected.</p>
<h3 id="common-closures-ajax-and-events">Common Closures: Ajax and Events<a class="headerlink" href="#common-closures-ajax-and-events" title="Permanent link">¶</a></h3>
<p>Closure is most commonly encountered with callbacks:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">lookupStudentRecord</span><span class="p">(</span><span class="nx">studentID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="nx">ajax</span><span class="p">(</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">        </span><span class="sb">`https://some.api/student/</span><span class="si">${</span><span class="w"> </span><span class="nx">studentID</span><span class="w"> </span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">        </span><span class="kd">function</span><span class="w"> </span><span class="nx">onRecord</span><span class="p">(</span><span class="nx">record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">                </span><span class="sb">`</span><span class="si">${</span><span class="w"> </span><span class="nx">record</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="w"> </span><span class="nx">studentID</span><span class="w"> </span><span class="si">}</span><span class="sb">)`</span>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">            </span><span class="p">);</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="p">);</span>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="p">}</span>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="nx">lookupStudentRecord</span><span class="p">(</span><span class="mf">114</span><span class="p">);</span>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="c1">// Frank (114)</span>
</code></pre></div>
<p>The <code>onRecord(..)</code> callback is going to be invoked at some point in the future, after the response from the Ajax call comes back. This invocation will happen from the internals of the <code>ajax(..)</code> utility, wherever that comes from. Furthermore, when that happens, the <code>lookupStudentRecord(..)</code> call will long since have completed.</p>
<p>Why then is <code>studentID</code> still around and accessible to the callback? Closure.</p>
<p>Event handlers are another common usage of closure:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">listenForClicks</span><span class="p">(</span><span class="nx">btn</span><span class="p">,</span><span class="nx">label</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="kd">function</span><span class="w"> </span><span class="nx">onClick</span><span class="p">(){</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">            </span><span class="sb">`The </span><span class="si">${</span><span class="w"> </span><span class="nx">label</span><span class="w"> </span><span class="si">}</span><span class="sb"> button was clicked!`</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="p">);</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="p">});</span>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="p">}</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">submitBtn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"submit-btn"</span><span class="p">);</span>
<a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a>
<a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="nx">listenForClicks</span><span class="p">(</span><span class="nx">submitBtn</span><span class="p">,</span><span class="s2">"Checkout"</span><span class="p">);</span>
</code></pre></div>
<p>The <code>label</code> parameter is closed over by the <code>onClick(..)</code> event handler callback. When the button is clicked, <code>label</code> still exists to be used. This is closure.</p>
<h3 id="what-if-i-cant-see-it">What If I Can't See It?<a class="headerlink" href="#what-if-i-cant-see-it" title="Permanent link">¶</a></h3>
<p>You've probably heard this common adage:</p>
<blockquote>
<p>If a tree falls in the forest but nobody is around to hear it, does it make a sound?</p>
</blockquote>
<p>It's a silly bit of philosophical gymnastics. Of course from a scientific perspective, sound waves are created. But the real point: <em>does it matter</em> if the sound happens?</p>
<p>Remember, the emphasis in our definition of closure is observability. If a closure exists (in a technical, implementation, or academic sense) but it cannot be observed in our programs, <em>does it matter?</em> No.</p>
<p>To reinforce this point, let's look at some examples that are <em>not</em> observably based on closure.</p>
<p>For example, invoking a function that makes use of LEXICAL scope lookup:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">say</span><span class="p">(</span><span class="nx">myName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Hello"</span><span class="p">;</span>
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="nx">output</span><span class="p">();</span>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">output</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">            </span><span class="sb">`</span><span class="si">${</span><span class="w"> </span><span class="nx">greeting</span><span class="w"> </span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="w"> </span><span class="nx">myName</span><span class="w"> </span><span class="si">}</span><span class="sb">!`</span>
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">        </span><span class="p">);</span>
<a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="p">}</span>
<a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a>
<a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="nx">say</span><span class="p">(</span><span class="s2">"Kyle"</span><span class="p">);</span>
<a href="#__codelineno-11-13" id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="c1">// Hello, Kyle!</span>
</code></pre></div>
<p>The inner function <code>output()</code> accesses the variables <code>greeting</code> and <code>myName</code> from its enclosing scope. But the invocation of <code>output()</code> happens in that same scope, where of course <code>greeting</code> and <code>myName</code> are still available; that's just LEXICAL scope, not closure.</p>
<p>Any lexically scoped language whose functions didn't support closure would still behave this same way.</p>
<p>In fact, global scope variables essentially cannot be (observably) closed over, because they're always accessible from everywhere. No function can ever be invoked in any part of the scope chain that is not a descendant of the global scope.</p>
<p>Consider:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">students</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">14</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kyle"</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">73</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Suzy"</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">112</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Frank"</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Sarah"</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="p">];</span>
<a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a>
<a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getFirstStudent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">firstStudent</span><span class="p">(){</span>
<a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">students</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">name</span><span class="p">;</span>
<a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="p">}</span>
<a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a>
<a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">student</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getFirstStudent</span><span class="p">();</span>
<a href="#__codelineno-12-15" id="__codelineno-12-15" name="__codelineno-12-15"></a>
<a href="#__codelineno-12-16" id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="nx">student</span><span class="p">();</span>
<a href="#__codelineno-12-17" id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="c1">// Kyle</span>
</code></pre></div>
<p>The inner <code>firstStudent()</code> function does reference <code>students</code>, which is a variable outside its own scope. But since <code>students</code> happens to be from the global scope, no matter where that function is invoked in the program, its ability to access <code>students</code> is nothing more special than normal LEXICAL scope.</p>
<p>All function invocations can access global variables, regardless of whether closure is supported by the language or not. Global variables don't need to be closed over.</p>
<p>Variables that are merely present but never accessed don't result in closure:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">lookupStudent</span><span class="p">(</span><span class="nx">studentID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">nobody</span><span class="p">(){</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Nobody's here yet."</span><span class="p">;</span>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="p">}</span>
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a>
<a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">student</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lookupStudent</span><span class="p">(</span><span class="mf">112</span><span class="p">);</span>
<a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a>
<a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="nx">student</span><span class="p">();</span>
<a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="c1">// Nobody's here yet.</span>
</code></pre></div>
<p>The inner function <code>nobody()</code> doesn't close over any outer variables—it only uses its own variable <code>msg</code>. Even though <code>studentID</code> is present in the enclosing scope, <code>studentID</code> is not referred to by <code>nobody()</code>. The JS engine doesn't need to keep <code>studentID</code> around after <code>lookupStudent(..)</code> has finished running, so GC wants to clean up that memory!</p>
<p>Whether JS functions support closure or not, this program would behave the same. Therefore, no observed closure here.</p>
<p>If there's no function invocation, closure can't be observed:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">greetStudent</span><span class="p">(</span><span class="nx">studentName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">greeting</span><span class="p">(){</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">            </span><span class="sb">`Hello, </span><span class="si">${</span><span class="w"> </span><span class="nx">studentName</span><span class="w"> </span><span class="si">}</span><span class="sb">!`</span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">        </span><span class="p">);</span>
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="p">}</span>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a>
<a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="nx">greetStudent</span><span class="p">(</span><span class="s2">"Kyle"</span><span class="p">);</span>
<a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a>
<a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="c1">// nothing else happens</span>
</code></pre></div>
<p>This one's tricky, because the outer function definitely does get invoked. But the inner function is the one that <em>could</em> have had closure, and yet it's never invoked; the returned function here is just thrown away. So even if technically the JS engine created closure for a brief moment, it was not observed in any meaningful way in this program.</p>
<p>A tree may have fallen... but we didn't hear it, so we don't care.</p>
<h3 id="observable-definition">Observable Definition<a class="headerlink" href="#observable-definition" title="Permanent link">¶</a></h3>
<p>We're now ready to define closure:</p>
<blockquote>
<p>Closure is observed when a function uses variable(s) from outer scope(s) even while running in a scope where those variable(s) wouldn't be accessible.</p>
</blockquote>
<p>The key parts of this definition are:</p>
<ul>
<li>
<p>Must be a function involved</p>
</li>
<li>
<p>Must reference at least one variable from an outer scope</p>
</li>
<li>
<p>Must be invoked in a different branch of the scope chain from the variable(s)</p>
</li>
</ul>
<p>This observation-oriented definition means we shouldn't dismiss closure as some indirect, academic trivia. Instead, we should look and plan for the direct, concrete effects closure has on our program behavior.</p>
<h2 id="the-closure-lifecycle-and-garbage-collection-gc">The Closure Lifecycle and Garbage Collection (GC)<a class="headerlink" href="#the-closure-lifecycle-and-garbage-collection-gc" title="Permanent link">¶</a></h2>
<p>Since closure is inherently tied to a function instance, its closure over a variable lasts as long as there is still a reference to that function.</p>
<p>If ten functions all close over the same variable, and over time nine of these function references are discarded, the lone remaining function reference still preserves that variable. Once that final function reference is discarded, the last closure over that variable is gone, and the variable itself is GC'd.</p>
<p>This has an important impact on building efficient and performant programs. Closure can unexpectedly prevent the GC of a variable that you're otherwise done with, which leads to run-away memory usage over time. That's why it's important to discard function references (and thus their closures) when they're not needed anymore.</p>
<p>Consider:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">manageBtnClickEvents</span><span class="p">(</span><span class="nx">btn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">clickHandlers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">listener</span><span class="p">(</span><span class="nx">cb</span><span class="p">){</span>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">clickHandler</span><span class="w"> </span><span class="o">=</span>
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">                </span><span class="kd">function</span><span class="w"> </span><span class="nx">onClick</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"clicked!"</span><span class="p">);</span>
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">                    </span><span class="nx">cb</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
<a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">                </span><span class="p">};</span>
<a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">            </span><span class="nx">clickHandlers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">clickHandler</span><span class="p">);</span>
<a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">            </span><span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">                </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">                </span><span class="nx">clickHandler</span>
<a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">            </span><span class="p">);</span>
<a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">            </span><span class="c1">// passing no callback unsubscribes</span>
<a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">            </span><span class="c1">// all click handlers</span>
<a href="#__codelineno-15-20" id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">handler</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">clickHandlers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-15-21" id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">                </span><span class="nx">btn</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<a href="#__codelineno-15-22" id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">                    </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-15-23" id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">                    </span><span class="nx">handler</span>
<a href="#__codelineno-15-24" id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="w">                </span><span class="p">);</span>
<a href="#__codelineno-15-25" id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">            </span><span class="p">}</span>
<a href="#__codelineno-15-26" id="__codelineno-15-26" name="__codelineno-15-26"></a>
<a href="#__codelineno-15-27" id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">            </span><span class="nx">clickHandlers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a href="#__codelineno-15-28" id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-15-29" id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-15-30" id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="p">}</span>
<a href="#__codelineno-15-31" id="__codelineno-15-31" name="__codelineno-15-31"></a>
<a href="#__codelineno-15-32" id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="c1">// var mySubmitBtn = ..</span>
<a href="#__codelineno-15-33" id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="kd">var</span><span class="w"> </span><span class="nx">onSubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manageBtnClickEvents</span><span class="p">(</span><span class="nx">mySubmitBtn</span><span class="p">);</span>
<a href="#__codelineno-15-34" id="__codelineno-15-34" name="__codelineno-15-34"></a>
<a href="#__codelineno-15-35" id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="nx">onSubmit</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">checkout</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
<a href="#__codelineno-15-36" id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="w">    </span><span class="c1">// handle checkout</span>
<a href="#__codelineno-15-37" id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="p">});</span>
<a href="#__codelineno-15-38" id="__codelineno-15-38" name="__codelineno-15-38"></a>
<a href="#__codelineno-15-39" id="__codelineno-15-39" name="__codelineno-15-39"></a><span class="nx">onSubmit</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">trackAction</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
<a href="#__codelineno-15-40" id="__codelineno-15-40" name="__codelineno-15-40"></a><span class="w">    </span><span class="c1">// log action to analytics</span>
<a href="#__codelineno-15-41" id="__codelineno-15-41" name="__codelineno-15-41"></a><span class="p">});</span>
<a href="#__codelineno-15-42" id="__codelineno-15-42" name="__codelineno-15-42"></a>
<a href="#__codelineno-15-43" id="__codelineno-15-43" name="__codelineno-15-43"></a><span class="c1">// later, unsubscribe all handlers:</span>
<a href="#__codelineno-15-44" id="__codelineno-15-44" name="__codelineno-15-44"></a><span class="nx">onSubmit</span><span class="p">();</span>
</code></pre></div>
<p>In this program, the inner <code>onClick(..)</code> function holds a closure over the passed in <code>cb</code> (the provided event callback). That means the <code>checkout()</code> and <code>trackAction()</code> function expression references are held via closure (and cannot be GC'd) for as long as these event handlers are subscribed.</p>
<p>When we call <code>onSubmit()</code> with no input on the last line, all event handlers are unsubscribed, and the <code>clickHandlers</code> array is emptied. Once all click handler function references are discarded, the closures of <code>cb</code> references to <code>checkout()</code> and <code>trackAction()</code> are discarded.</p>
<p>When considering the overall health and efficiency of the program, unsubscribing an event handler when it's no longer needed can be even more important than the initial subscription!</p>
<h3 id="per-variable-or-per-scope">Per Variable or Per Scope?<a class="headerlink" href="#per-variable-or-per-scope" title="Permanent link">¶</a></h3>
<p>Another question we need to tackle: should we think of closure as applied only to the referenced outer variable(s), or does closure preserve the entire scope chain with all its variables?</p>
<p>In other words, in the previous event subscription snippet, is the inner <code>onClick(..)</code> function closed over only <code>cb</code>, or is it also closed over <code>clickHandler</code>, <code>clickHandlers</code>, and <code>btn</code>?</p>
<p>Conceptually, closure is <strong>per variable</strong> rather than <em>per scope</em>. Ajax callbacks, event handlers, and all other forms of function closures are typically assumed to close over only what they explicitly reference.</p>
<p>But the reality is more complicated than that.</p>
<p>Another program to consider:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">manageStudentGrades</span><span class="p">(</span><span class="nx">studentRecords</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">grades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getGrade</span><span class="p">);</span>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a>
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">addGrade</span><span class="p">;</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">    </span><span class="c1">// ************************</span>
<a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a>
<a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">getGrade</span><span class="p">(</span><span class="nx">record</span><span class="p">){</span>
<a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">record</span><span class="p">.</span><span class="nx">grade</span><span class="p">;</span>
<a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a>
<a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">sortAndTrimGradesList</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">        </span><span class="c1">// sort by grades, descending</span>
<a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">        </span><span class="nx">grades</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="nx">desc</span><span class="p">(</span><span class="nx">g1</span><span class="p">,</span><span class="nx">g2</span><span class="p">){</span>
<a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">g2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">g1</span><span class="p">;</span>
<a href="#__codelineno-16-16" id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">        </span><span class="p">});</span>
<a href="#__codelineno-16-17" id="__codelineno-16-17" name="__codelineno-16-17"></a>
<a href="#__codelineno-16-18" id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="w">        </span><span class="c1">// only keep the top 10 grades</span>
<a href="#__codelineno-16-19" id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="w">        </span><span class="nx">grades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">grades</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">10</span><span class="p">);</span>
<a href="#__codelineno-16-20" id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-16-21" id="__codelineno-16-21" name="__codelineno-16-21"></a>
<a href="#__codelineno-16-22" id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">addGrade</span><span class="p">(</span><span class="nx">newGrade</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-16-23" id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="w">        </span><span class="nx">grades</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newGrade</span><span class="p">);</span>
<a href="#__codelineno-16-24" id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="w">        </span><span class="nx">sortAndTrimGradesList</span><span class="p">();</span>
<a href="#__codelineno-16-25" id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">grades</span><span class="p">;</span>
<a href="#__codelineno-16-26" id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-16-27" id="__codelineno-16-27" name="__codelineno-16-27"></a><span class="p">}</span>
<a href="#__codelineno-16-28" id="__codelineno-16-28" name="__codelineno-16-28"></a>
<a href="#__codelineno-16-29" id="__codelineno-16-29" name="__codelineno-16-29"></a><span class="kd">var</span><span class="w"> </span><span class="nx">addNextGrade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">manageStudentGrades</span><span class="p">([</span>
<a href="#__codelineno-16-30" id="__codelineno-16-30" name="__codelineno-16-30"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">14</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kyle"</span><span class="p">,</span><span class="w"> </span><span class="nx">grade</span><span class="o">:</span><span class="w"> </span><span class="mf">86</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-16-31" id="__codelineno-16-31" name="__codelineno-16-31"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">73</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Suzy"</span><span class="p">,</span><span class="w"> </span><span class="nx">grade</span><span class="o">:</span><span class="w"> </span><span class="mf">87</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-16-32" id="__codelineno-16-32" name="__codelineno-16-32"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">112</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Frank"</span><span class="p">,</span><span class="w"> </span><span class="nx">grade</span><span class="o">:</span><span class="w"> </span><span class="mf">75</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-16-33" id="__codelineno-16-33" name="__codelineno-16-33"></a><span class="w">    </span><span class="c1">// ..many more records..</span>
<a href="#__codelineno-16-34" id="__codelineno-16-34" name="__codelineno-16-34"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Sarah"</span><span class="p">,</span><span class="w"> </span><span class="nx">grade</span><span class="o">:</span><span class="w"> </span><span class="mf">91</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-16-35" id="__codelineno-16-35" name="__codelineno-16-35"></a><span class="p">]);</span>
<a href="#__codelineno-16-36" id="__codelineno-16-36" name="__codelineno-16-36"></a>
<a href="#__codelineno-16-37" id="__codelineno-16-37" name="__codelineno-16-37"></a><span class="c1">// later</span>
<a href="#__codelineno-16-38" id="__codelineno-16-38" name="__codelineno-16-38"></a>
<a href="#__codelineno-16-39" id="__codelineno-16-39" name="__codelineno-16-39"></a><span class="nx">addNextGrade</span><span class="p">(</span><span class="mf">81</span><span class="p">);</span>
<a href="#__codelineno-16-40" id="__codelineno-16-40" name="__codelineno-16-40"></a><span class="nx">addNextGrade</span><span class="p">(</span><span class="mf">68</span><span class="p">);</span>
<a href="#__codelineno-16-41" id="__codelineno-16-41" name="__codelineno-16-41"></a><span class="c1">// [ .., .., ... ]</span>
</code></pre></div>
<p>The outer function <code>manageStudentGrades(..)</code> takes a list of student records, and returns an <code>addGrade(..)</code> function reference, which we externally label <code>addNextGrade(..)</code>. Each time we call <code>addNextGrade(..)</code> with a new grade, we get back a current list of the top 10 grades, sorted numerically descending (see <code>sortAndTrimGradesList()</code>).</p>
<p>From the end of the original <code>manageStudentGrades(..)</code> call, and between the multiple <code>addNextGrade(..)</code> calls, the <code>grades</code> variable is preserved inside <code>addGrade(..)</code> via closure; that's how the running list of top grades is maintained. Remember, it's a closure over the variable <code>grades</code> itself, not the array it holds.</p>
<p>That's not the only closure involved, however. Can you spot other variables being closed over?</p>
<p>Did you spot that <code>addGrade(..)</code> references <code>sortAndTrimGradesList</code>? That means it's also closed over that identifier, which happens to hold a reference to the <code>sortAndTrimGradesList()</code> function. That second inner function has to stay around so that <code>addGrade(..)</code> can keep calling it, which also means any variables <em>it</em> closes over stick around—though, in this case, nothing extra is closed over there.</p>
<p>What else is closed over?</p>
<p>Consider the <code>getGrade</code> variable (and its function); is it closed over? It's referenced in the outer scope of <code>manageStudentGrades(..)</code> in the <code>.map(getGrade)</code> call. But it's not referenced in <code>addGrade(..)</code> or <code>sortAndTrimGradesList()</code>.</p>
<p>What about the (potentially) large list of student records we pass in as <code>studentRecords</code>? Is that variable closed over? If it is, the array of student records is never getting GC'd, which leads to this program holding onto a larger amount of memory than we might assume. But if we look closely again, none of the inner functions reference <code>studentRecords</code>.</p>
<p>According to the <em>per variable</em> definition of closure, since <code>getGrade</code> and <code>studentRecords</code> are <em>not</em> referenced by the inner functions, they're not closed over. They should be freely available for GC right after the <code>manageStudentGrades(..)</code> call completes.</p>
<p>Indeed, try debugging this code in a recent JS engine, like v8 in Chrome, placing a breakpoint inside the <code>addGrade(..)</code> function. You may notice that the inspector <strong>does not</strong> list the <code>studentRecords</code> variable. That's proof, debugging-wise anyway, that the engine does not maintain <code>studentRecords</code> via closure. Phew!</p>
<p>But how reliable is this observation as proof? Consider this (rather contrived!) program:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">storeStudentInfo</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="nx">name</span><span class="p">,</span><span class="nx">grade</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getInfo</span><span class="p">(</span><span class="nx">whichValue</span><span class="p">){</span>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">        </span><span class="c1">// warning:</span>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">        </span><span class="c1">//   using `eval(..)` is a bad idea!</span>
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">eval</span><span class="p">(</span><span class="nx">whichValue</span><span class="p">);</span>
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">val</span><span class="p">;</span>
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="p">}</span>
<a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>
<a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="kd">var</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">storeStudentInfo</span><span class="p">(</span><span class="mf">73</span><span class="p">,</span><span class="s2">"Suzy"</span><span class="p">,</span><span class="mf">87</span><span class="p">);</span>
<a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>
<a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="nx">info</span><span class="p">(</span><span class="s2">"name"</span><span class="p">);</span>
<a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="c1">// Suzy</span>
<a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="nx">info</span><span class="p">(</span><span class="s2">"grade"</span><span class="p">);</span>
<a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="c1">// 87</span>
</code></pre></div>
<p>Notice that the inner function <code>getInfo(..)</code> is not explicitly closed over any of <code>id</code>, <code>name</code>, or <code>grade</code> variables. And yet, calls to <code>info(..)</code> seem to still be able to access the variables, albeit through use of the <code>eval(..)</code> LEXICAL scope cheat (see Chapter 1).</p>
<p>So all the variables were definitely preserved via closure, despite not being explicitly referenced by the inner function. So does that disprove the <em>per variable</em> assertion in favor of <em>per scope</em>? Depends.</p>
<p>Many modern JS engines do apply an <em>optimization</em> that removes any variables from a closure scope that aren't explicitly referenced. However, as we see with <code>eval(..)</code>, there are situations where such an optimization cannot be applied, and the closure scope continues to contain all its original variables. In other words, closure must be <em>per scope</em>, implementation wise, and then an optional optimization trims down the scope to only what was closed over (a similar outcome as <em>per variable</em> closure).</p>
<p>Even as recent as a few years ago, many JS engines did not apply this optimization; it's possible your websites may still run in such browsers, especially on older or lower-end devices. That means it's possible that long-lived closures such as event handlers may be holding onto memory much longer than we would have assumed.</p>
<p>And the fact that it's an optional optimization in the first place, rather than a requirement of the specification, means that we shouldn't just casually over-assume its applicability.</p>
<p>In cases where a variable holds a large value (like an object or array) and that variable is present in a closure scope, if you don't need that value anymore and don't want that memory held, it's safer (memory usage) to manually discard the value rather than relying on closure optimization/GC.</p>
<p>Let's apply a <em>fix</em> to the earlier <code>manageStudentGrades(..)</code> example to ensure the potentially large array held in <code>studentRecords</code> is not caught up in a closure scope unnecessarily:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">manageStudentGrades</span><span class="p">(</span><span class="nx">studentRecords</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">grades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">studentRecords</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getGrade</span><span class="p">);</span>
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">    </span><span class="c1">// unset `studentRecords` to prevent unwanted</span>
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">    </span><span class="c1">// memory retention in the closure</span>
<a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="nx">studentRecords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a>
<a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">addGrade</span><span class="p">;</span>
<a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="p">}</span>
</code></pre></div>
<p>We're not removing <code>studentRecords</code> from the closure scope; that we cannot control. We're ensuring that even if <code>studentRecords</code> remains in the closure scope, that variable is no longer referencing the potentially large array of data; the array can be GC'd.</p>
<p>Again, in many cases JS might automatically optimize the program to the same effect. But it's still a good habit to be careful and explicitly make sure we don't keep any significant amount of device memory tied up any longer than necessary.</p>
<p>As a matter of fact, we also technically don't need the function <code>getGrade()</code> anymore after the <code>.map(getGrade)</code> call completes. If profiling our application showed this was a critical area of excess memory use, we could possibly eek out a tiny bit more memory by freeing up that reference so its value isn't tied up either. That's likely unnecessary in this toy example, but this is a general technique to keep in mind if you're optimizing the memory footprint of your application.</p>
<p>The takeaway: it's important to know where closures appear in our programs, and what variables are included. We should manage these closures carefully so we're only holding onto what's minimally needed and not wasting memory.</p>
<h2 id="an-alternative-perspective">An Alternative Perspective<a class="headerlink" href="#an-alternative-perspective" title="Permanent link">¶</a></h2>
<p>Reviewing our working definition for closure, the assertion is that functions are "first-class values" that can be passed around the program, just like any other value. Closure is the link-association that connects that function to the scope/variables outside of itself, no matter where that function goes.</p>
<p>Let's recall a code example from earlier in this chapter, again with relevant scope bubble colors annotated:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1">// outer/global scope: RED(1)</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="kd">function</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="nx">num1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">    </span><span class="c1">// function scope: BLUE(2)</span>
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>
<a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">addTo</span><span class="p">(</span><span class="nx">num2</span><span class="p">){</span>
<a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">        </span><span class="c1">// function scope: GREEN(3)</span>
<a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>
<a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">num2</span><span class="p">;</span>
<a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="p">}</span>
<a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="kd">var</span><span class="w"> </span><span class="nx">add10To</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="mf">10</span><span class="p">);</span>
<a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">add42To</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="mf">42</span><span class="p">);</span>
<a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>
<a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="nx">add10To</span><span class="p">(</span><span class="mf">15</span><span class="p">);</span><span class="w">    </span><span class="c1">// 25</span>
<a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="nx">add42To</span><span class="p">(</span><span class="mf">9</span><span class="p">);</span><span class="w">     </span><span class="c1">// 51</span>
</code></pre></div>
<p>Our current perspective suggests that wherever a function is passed and invoked, closure preserves a hidden link back to the original scope to facilitate the access to the closed-over variables. Figure 4, repeated here for convenience, illustrates this notion:</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="images/fig4.png"><img align="center" alt="Function instances linked to scopes via closure" src="images/fig4.png" width="400"/></a>
<figcaption><em>Fig. 4 (repeat): Visualizing Closures</em></figcaption>
<br/><br/>
</figure>
<p>But there's another way of thinking about closure, and more precisely the nature of functions being <em>passed around</em>, that may help deepen the mental models.</p>
<p>This alternative model de-emphasizes "functions as first-class values," and instead embraces how functions (like all non-primitive values) are held by reference in JS, and assigned/passed by reference-copy—see Appendix A of the <em>Get Started</em> book for more information.</p>
<p>Instead of thinking about the inner function instance of <code>addTo(..)</code> moving to the outer RED(1) scope via the <code>return</code> and assignment, we can envision that function instances actually just stay in place in their own scope environment, of course with their scope-chain intact.</p>
<p>What gets <em>sent</em> to the RED(1) scope is <strong>just a reference</strong> to the in-place function instance, rather than the function instance itself. Figure 5 depicts the inner function instances remaining in place, pointed to by the RED(1) <code>addTo10</code> and <code>addTo42</code> references, respectively:</p>
<figure>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="images/fig5.png"><img align="center" alt="Function instances inside scopes via closure, linked to by references" src="images/fig5.png" width="400"/></a>
<figcaption><em>Fig. 5: Visualizing Closures (Alternative)</em></figcaption>
<br/><br/>
</figure>
<p>As shown in Figure 5, each call to <code>adder(..)</code> still creates a new BLUE(2) scope containing a <code>num1</code> variable, as well as an instance of the GREEN(3) <code>addTo(..)</code> scope. But what's different from Figure 4 is, now these GREEN(3) instances remain in place, naturally nested inside of their BLUE(2) scope instances. The <code>addTo10</code> and <code>addTo42</code> references are moved to the RED(1) outer scope, not the function instances themselves.</p>
<p>When <code>addTo10(15)</code> is called, the <code>addTo(..)</code> function instance (still in place in its original BLUE(2) scope environment) is invoked. Since the function instance itself never moved, of course it still has natural access to its scope chain. Same with the <code>addTo42(9)</code> call—nothing special here beyond LEXICAL scope.</p>
<p>So what then <em>is</em> closure, if not the <em>magic</em> that lets a function maintain a link to its original scope chain even as that function moves around in other scopes? In this alternative model, functions stay in place and keep accessing their original scope chain just like they always could.</p>
<p>Closure instead describes the <em>magic</em> of <strong>keeping alive a function instance</strong>, along with its whole scope environment and chain, for as long as there's at least one reference to that function instance floating around in any other part of the program.</p>
<p>That definition of closure is less observational and a bit less familiar-sounding compared to the traditional academic perspective. But it's nonetheless still useful, because the benefit is that we simplify explanation of closure to a straightforward combination of references and in-place function instances.</p>
<p>The previous model (Figure 4) is not <em>wrong</em> at describing closure in JS. It's just more conceptually inspired, an academic perspective on closure. By contrast, the alternative model (Figure 5) could be described as a bit more implementation focused, how JS actually works.</p>
<p>Both perspectives/models are useful in understanding closure, but the reader may find one a little easier to hold than the other. Whichever you choose, the observable outcomes in our program are the same.</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">This alternative model for closure does affect whether we classify synchronous callbacks as examples of closure or not. More on this nuance in Appendix A.</td>
</tr>
</tbody>
</table>
<h2 id="why-closure">Why Closure?<a class="headerlink" href="#why-closure" title="Permanent link">¶</a></h2>
<p>Now that we have a well-rounded sense of what closure is and how it works, let's explore some ways it can improve the code structure and organization of an example program.</p>
<p>Imagine you have a button on a page that when clicked, should retrieve and send some data via an Ajax request. Without using closure:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">APIendpoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="nx">studentIDs</span><span class="o">:</span>
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">        </span><span class="s2">"https://some.api/register-students"</span><span class="p">,</span>
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="p">};</span>
<a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">    </span><span class="nx">studentIDs</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">14</span><span class="p">,</span><span class="w"> </span><span class="mf">73</span><span class="p">,</span><span class="w"> </span><span class="mf">112</span><span class="p">,</span><span class="w"> </span><span class="mf">6</span><span class="w"> </span><span class="p">],</span>
<a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="p">};</span>
<a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a>
<a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="kd">function</span><span class="w"> </span><span class="nx">makeRequest</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">btn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
<a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">recordKind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">btn</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">kind</span><span class="p">;</span>
<a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">    </span><span class="nx">ajax</span><span class="p">(</span>
<a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">        </span><span class="nx">APIendpoints</span><span class="p">[</span><span class="nx">recordKind</span><span class="p">],</span>
<a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="w">        </span><span class="nx">data</span><span class="p">[</span><span class="nx">recordKind</span><span class="p">]</span>
<a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="w">    </span><span class="p">);</span>
<a href="#__codelineno-20-19" id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="p">}</span>
<a href="#__codelineno-20-20" id="__codelineno-20-20" name="__codelineno-20-20"></a>
<a href="#__codelineno-20-21" id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="c1">// &lt;button data-kind="studentIDs"&gt;</span>
<a href="#__codelineno-20-22" id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="c1">//    Register Students</span>
<a href="#__codelineno-20-23" id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="c1">// &lt;/button&gt;</span>
<a href="#__codelineno-20-24" id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="nx">makeRequest</span><span class="p">);</span>
</code></pre></div>
<p>The <code>makeRequest(..)</code> utility only receives an <code>evt</code> object from a click event. From there, it has to retrieve the <code>data-kind</code> attribute from the target button element, and use that value to lookup both a URL for the API endpoint as well as what data should be included in the Ajax request.</p>
<p>This works OK, but it's unfortunate (inefficient, more confusing) that the event handler has to read a DOM attribute each time it's fired. Why couldn't an event handler <em>remember</em> this value? Let's try using closure to improve the code:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">APIendpoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="nx">studentIDs</span><span class="o">:</span>
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">        </span><span class="s2">"https://some.api/register-students"</span><span class="p">,</span>
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="p">};</span>
<a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a>
<a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="nx">studentIDs</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">14</span><span class="p">,</span><span class="w"> </span><span class="mf">73</span><span class="p">,</span><span class="w"> </span><span class="mf">112</span><span class="p">,</span><span class="w"> </span><span class="mf">6</span><span class="w"> </span><span class="p">],</span>
<a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="p">};</span>
<a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a>
<a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="kd">function</span><span class="w"> </span><span class="nx">setupButtonHandler</span><span class="p">(</span><span class="nx">btn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">recordKind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">btn</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">kind</span><span class="p">;</span>
<a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a>
<a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">    </span><span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">        </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="w">        </span><span class="kd">function</span><span class="w"> </span><span class="nx">makeRequest</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
<a href="#__codelineno-21-18" id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="w">            </span><span class="nx">ajax</span><span class="p">(</span>
<a href="#__codelineno-21-19" id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="w">                </span><span class="nx">APIendpoints</span><span class="p">[</span><span class="nx">recordKind</span><span class="p">],</span>
<a href="#__codelineno-21-20" id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="w">                </span><span class="nx">data</span><span class="p">[</span><span class="nx">recordKind</span><span class="p">]</span>
<a href="#__codelineno-21-21" id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="w">            </span><span class="p">);</span>
<a href="#__codelineno-21-22" id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-21-23" id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="w">    </span><span class="p">);</span>
<a href="#__codelineno-21-24" id="__codelineno-21-24" name="__codelineno-21-24"></a><span class="p">}</span>
<a href="#__codelineno-21-25" id="__codelineno-21-25" name="__codelineno-21-25"></a>
<a href="#__codelineno-21-26" id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="c1">// &lt;button data-kind="studentIDs"&gt;</span>
<a href="#__codelineno-21-27" id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="c1">//    Register Students</span>
<a href="#__codelineno-21-28" id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="c1">// &lt;/button&gt;</span>
<a href="#__codelineno-21-29" id="__codelineno-21-29" name="__codelineno-21-29"></a>
<a href="#__codelineno-21-30" id="__codelineno-21-30" name="__codelineno-21-30"></a><span class="nx">setupButtonHandler</span><span class="p">(</span><span class="nx">btn</span><span class="p">);</span>
</code></pre></div>
<p>With the <code>setupButtonHandler(..)</code> approach, the <code>data-kind</code> attribute is retrieved once and assigned to the <code>recordKind</code> variable at initial setup. <code>recordKind</code> is then closed over by the inner <code>makeRequest(..)</code> click handler, and its value is used on each event firing to look up the URL and data that should be sent.</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>evt</code> is still passed to <code>makeRequest(..)</code>, though in this case we're not using it anymore. It's still listed, for consistency with the previous snippet.</td>
</tr>
</tbody>
</table>
<p>By placing <code>recordKind</code> inside <code>setupButtonHandler(..)</code>, we limit the scope exposure of that variable to a more appropriate subset of the program; storing it globally would have been worse for code organization and readability. Closure lets the inner <code>makeRequest()</code> function instance <em>remember</em> this variable and access whenever it's needed.</p>
<p>Building on this pattern, we could have looked up both the URL and data once, at setup:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">setupButtonHandler</span><span class="p">(</span><span class="nx">btn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">recordKind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">btn</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">kind</span><span class="p">;</span>
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">requestURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">APIendpoints</span><span class="p">[</span><span class="nx">recordKind</span><span class="p">];</span>
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">requestData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">[</span><span class="nx">recordKind</span><span class="p">];</span>
<a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a>
<a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">        </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">        </span><span class="kd">function</span><span class="w"> </span><span class="nx">makeRequest</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
<a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">            </span><span class="nx">ajax</span><span class="p">(</span><span class="nx">requestURL</span><span class="p">,</span><span class="nx">requestData</span><span class="p">);</span>
<a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">    </span><span class="p">);</span>
<a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="p">}</span>
</code></pre></div>
<p>Now <code>makeRequest(..)</code> is closed over <code>requestURL</code> and <code>requestData</code>, which is a little bit cleaner to understand, and also slightly more performant.</p>
<p>Two similar techniques from the Functional Programming (FP) paradigm that rely on closure are partial application and currying. Briefly, with these techniques, we alter the <em>shape</em> of functions that require multiple inputs so some inputs are provided up front, and other inputs are provided later; the initial inputs are remembered via closure. Once all inputs have been provided, the underlying action is performed.</p>
<p>By creating a function instance that encapsulates some information inside (via closure), the function-with-stored-information can later be used directly without needing to re-provide that input. This makes that part of the code cleaner, and also offers the opportunity to label partially applied functions with better semantic names.</p>
<p>Adapting partial application, we can further improve the preceding code:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">defineHandler</span><span class="p">(</span><span class="nx">requestURL</span><span class="p">,</span><span class="nx">requestData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">makeRequest</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
<a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">        </span><span class="nx">ajax</span><span class="p">(</span><span class="nx">requestURL</span><span class="p">,</span><span class="nx">requestData</span><span class="p">);</span>
<a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="p">}</span>
<a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>
<a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="kd">function</span><span class="w"> </span><span class="nx">setupButtonHandler</span><span class="p">(</span><span class="nx">btn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">recordKind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">btn</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">kind</span><span class="p">;</span>
<a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defineHandler</span><span class="p">(</span>
<a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">        </span><span class="nx">APIendpoints</span><span class="p">[</span><span class="nx">recordKind</span><span class="p">],</span>
<a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">        </span><span class="nx">data</span><span class="p">[</span><span class="nx">recordKind</span><span class="p">]</span>
<a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">    </span><span class="p">);</span>
<a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">    </span><span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="nx">handler</span><span class="p">);</span>
<a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="p">}</span>
</code></pre></div>
<p>The <code>requestURL</code> and <code>requestData</code> inputs are provided ahead of time, resulting in the <code>makeRequest(..)</code> partially applied function, which we locally label <code>handler</code>. When the event eventually fires, the final input (<code>evt</code>, even though it's ignored) is passed to <code>handler()</code>, completing its inputs and triggering the underlying Ajax request.</p>
<p>Behavior-wise, this program is pretty similar to the previous one, with the same type of closure. But by isolating the creation of <code>makeRequest(..)</code> in a separate utility (<code>defineHandler(..)</code>), we make that definition more reusable across the program. We also explicitly limit the closure scope to only the two variables needed.</p>
<h2 id="closer-to-closure">Closer to Closure<a class="headerlink" href="#closer-to-closure" title="Permanent link">¶</a></h2>
<p>As we close down a dense chapter, take some deep breaths let it all sink in. Seriously, that's a lot of information for anyone to consume!</p>
<p>We explored two models for mentally tackling closure:</p>
<ul>
<li>
<p>Observational: closure is a function instance remembering its outer variables even as that function is passed to and <strong>invoked in</strong> other scopes.</p>
</li>
<li>
<p>Implementational: closure is a function instance and its scope environment preserved in-place while any references to it are passed around and <strong>invoked from</strong> other scopes.</p>
</li>
</ul>
<p>Summarizing the benefits to our programs:</p>
<ul>
<li>
<p>Closure can improve efficiency by allowing a function instance to remember previously determined information instead of having to compute it each time.</p>
</li>
<li>
<p>Closure can improve code readability, bounding scope-exposure by encapsulating variable(s) inside function instances, while still making sure the information in those variables is accessible for future use. The resultant narrower, more specialized function instances are cleaner to interact with, since the preserved information doesn't need to be passed in every invocation.</p>
</li>
</ul>
<p>Before you move on, take some time to restate this summary <em>in your own words</em>, explaining what closure is and why it's helpful in your programs. The main book text concludes with a final chapter that builds on top of closure with the module pattern.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Chapter 6: Limiting Scope Exposure" class="md-footer__link md-footer__link--prev" href="../ch6/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                  Previous
                </span>
                Chapter 6: Limiting Scope Exposure
              </div>
</div>
</a>
<a aria-label="Next: Chapter 8: The Module Pattern" class="md-footer__link md-footer__link--next" href="../ch8/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                  Next
                </span>
                Chapter 8: The Module Pattern
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://shanenull.com/" rel="noopener" target="_blank" title="shanenull.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M256 8C119.3 8 8 119.2 8 256c0 136.7 111.3 248 248 248s248-111.3 248-248C504 119.2 392.7 8 256 8zM33 256c0-32.3 6.9-63 19.3-90.7l106.4 291.4C84.3 420.5 33 344.2 33 256zm223 223c-21.9 0-43-3.2-63-9.1l66.9-194.4 68.5 187.8c.5 1.1 1 2.1 1.6 3.1-23.1 8.1-48 12.6-74 12.6zm30.7-327.5c13.4-.7 25.5-2.1 25.5-2.1 12-1.4 10.6-19.1-1.4-18.4 0 0-36.1 2.8-59.4 2.8-21.9 0-58.7-2.8-58.7-2.8-12-.7-13.4 17.7-1.4 18.4 0 0 11.4 1.4 23.4 2.1l34.7 95.2L200.6 393l-81.2-241.5c13.4-.7 25.5-2.1 25.5-2.1 12-1.4 10.6-19.1-1.4-18.4 0 0-36.1 2.8-59.4 2.8-4.2 0-9.1-.1-14.4-.3C109.6 73 178.1 33 256 33c58 0 110.9 22.2 150.6 58.5-1-.1-1.9-.2-2.9-.2-21.9 0-37.4 19.1-37.4 39.6 0 18.4 10.6 33.9 21.9 52.3 8.5 14.8 18.4 33.9 18.4 61.5 0 19.1-7.3 41.2-17 72.1l-22.2 74.3-80.7-239.6zm81.4 297.2 68.1-196.9c12.7-31.8 17-57.2 17-79.9 0-8.2-.5-15.8-1.5-22.9 17.4 31.8 27.3 68.2 27.3 107 0 82.3-44.6 154.1-110.9 192.7z"></path></svg>
</a>
<a class="md-social__link" href="https://shane0.pythonanywhere.com/" rel="noopener" target="_blank" title="shane0.pythonanywhere.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"></path></svg>
</a>
<a class="md-social__link" href="http://www.youtube.com/c/ShaneNull" rel="noopener" target="_blank" title="www.youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg>
</a>
<a class="md-social__link" href="https://www.instagram.com/nullshane/" rel="noopener" target="_blank" title="www.instagram.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg>
</a>
<a class="md-social__link" href="https://earmassagetherapist.bandcamp.com/releases" rel="noopener" target="_blank" title="earmassagetherapist.bandcamp.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8Zm48.2 326.1h-181L207.9 178h181Z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/shane0" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://gitlab.com/shane0" rel="noopener" target="_blank" title="gitlab.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/shane_null" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/in/shanenull" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.action.edit", "content.action.view", "navigation.footer"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": 2023, "provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js?tex"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>