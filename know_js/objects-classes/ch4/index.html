
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../ch3/" rel="prev"/>
<link href="../ch5/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.6" name="generator"/>
<title>Chapter 4: This Works - shane0 learning_js</title>
<link href="../../../assets/stylesheets/main.558e4712.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#chapter-4-this-works">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="shane0 learning_js" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="shane0 learning_js">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            shane0 learning_js
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Chapter 4: This Works
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/shane0/learning_js" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="shane0 learning_js" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="shane0 learning_js">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    shane0 learning_js
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/shane0/learning_js" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../todocli/">
        todo cli
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_3" tabindex="0">
          Bujo
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Bujo" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Bujo
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../bujo/2023/">
        2023
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label aria-expanded="true" class="md-nav__link" for="__nav_4" tabindex="0">
          Know js
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Know js" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Know js
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../">
        Index
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_2" tabindex="0">
          Es next beyond
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Es next beyond" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Es next beyond
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../es-next-beyond/">
        TOC: ES.Next &amp; Beyond - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../es-next-beyond/ch1/">
        Chapter 1: TODO
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_3" tabindex="0">
          Get started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Get started" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Get started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/">
        Table of Contents
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/apA/">
        Appendix A: Exploring Further
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/apB/">
        Appendix B: Practice, Practice, Practice!
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch1/">
        Chapter 1: What *Is* JavaScript?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch2/">
        Chapter 2: Surveying JS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch3/">
        Chapter 3: Digging to the Roots of JS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch4/">
        Chapter 4: The Bigger Picture
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" id="__nav_4_4" type="checkbox"/>
<label aria-expanded="true" class="md-nav__link" for="__nav_4_4" tabindex="0">
          Objects classes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Objects classes" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
          Objects classes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        You Don't Know JS Yet: Objects &amp; Classes - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch1/">
        Chapter 1: Object Foundations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch2/">
        Chapter 2: How Objects Work
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch3/">
        Chapter 3: Classy Objects
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 4: This Works
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Chapter 4: This Works
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#this-aware">
    This Aware
  </a>
<nav aria-label="This Aware" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#this-confuses-me">
    This Confuses Me
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#so-what-is-this">
    So What Is This?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-is-this-so-implicit">
    Why Is This So Implicit?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#can-we-get-on-with-this">
    Can We Get On With This?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this-is-it">
    This Is It!
  </a>
<nav aria-label="This Is It!" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#implicit-context-invocation">
    Implicit Context Invocation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#default-context-invocation">
    Default Context Invocation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#explicit-context-invocation">
    Explicit Context Invocation
  </a>
<nav aria-label="Explicit Context Invocation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#revisiting-implicit-context-invocation">
    Revisiting Implicit Context Invocation
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#new-context-invocation">
    New Context Invocation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#review-this">
    Review This
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#an-arrow-points-somewhere">
    An Arrow Points Somewhere
  </a>
<nav aria-label="An Arrow Points Somewhere" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#wheres-the-call-site">
    Where's The Call-site?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hidden-from-sight">
    Hidden From Sight
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this-is-wrong">
    This Is Wrong
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fixing-this">
    Fixing this
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lexical-this">
    Lexical This
  </a>
<nav aria-label="Lexical This" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#back-to-the-button">
    Back To The... Button
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#confession-time">
    Confession Time
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#find-the-right-call-site">
    Find The Right Call-Site
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this-is-bound-to-come-up">
    This Is Bound To Come Up
  </a>
<nav aria-label="This Is Bound To Come Up" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#hardly-new">
    Hardly New
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#losing-this-battle">
    Losing This Battle
  </a>
<nav aria-label="Losing This Battle" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pre-binding-function-contexts">
    Pre-Binding Function Contexts
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#take-a-more-critical-look">
    Take A More Critical Look
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#variations">
    Variations
  </a>
<nav aria-label="Variations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#indirect-function-calls">
    Indirect Function Calls
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#accessing-globalthis">
    Accessing globalThis
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#template-tag-functions">
    Template Tag Functions
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stay-aware">
    Stay Aware
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch5/">
        Chapter 5: Delegation
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" id="__nav_4_5" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_5" tabindex="0">
          Scope closures
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Scope closures" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
          Scope closures
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/">
        Scope &amp; Closures - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/apA/">
        Appendix A: Exploring Further
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/apB/">
        Appendix B: Practice
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch1/">
        Chapter 1: What's the Scope?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch2/">
        Chapter 2: Illustrating Lexical Scope
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch3/">
        Chapter 3: The Scope Chain
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch4/">
        Chapter 4: Around the Global Scope
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch5/">
        Chapter 5: The (Not So) Secret Lifecycle of Variables
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch6/">
        Chapter 6: Limiting Scope Exposure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch7/">
        Chapter 7: Using Closures
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch8/">
        Chapter 8: The Module Pattern
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/closures_bard/">
        closures bard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/scope_bard/">
        scope: bard version
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" id="__nav_4_6" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_6" tabindex="0">
          Sync async
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Sync async" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
          Sync async
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sync-async/">
        TOC: Sync &amp; Async - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sync-async/ch1/">
        Chapter 1: TODO
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7" id="__nav_4_7" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_7" tabindex="0">
          Types grammar
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Types grammar" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_7">
<span class="md-nav__icon md-icon"></span>
          Types grammar
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/">
        TOC: Types &amp; Grammar - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/ch1/">
        Chapter 1: Primitive Values
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/ch2/">
        Chapter 2: Primitive Behaviors
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/ch3/">
        Chapter 3: Object Values
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../types-grammar/ch4/">
        Chapter 4: Coercing Values
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_5" tabindex="0">
          Nucamp
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Nucamp" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Nucamp
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../nucamp/">
        nucamp notes
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#this-aware">
    This Aware
  </a>
<nav aria-label="This Aware" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#this-confuses-me">
    This Confuses Me
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#so-what-is-this">
    So What Is This?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-is-this-so-implicit">
    Why Is This So Implicit?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#can-we-get-on-with-this">
    Can We Get On With This?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this-is-it">
    This Is It!
  </a>
<nav aria-label="This Is It!" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#implicit-context-invocation">
    Implicit Context Invocation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#default-context-invocation">
    Default Context Invocation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#explicit-context-invocation">
    Explicit Context Invocation
  </a>
<nav aria-label="Explicit Context Invocation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#revisiting-implicit-context-invocation">
    Revisiting Implicit Context Invocation
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#new-context-invocation">
    New Context Invocation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#review-this">
    Review This
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#an-arrow-points-somewhere">
    An Arrow Points Somewhere
  </a>
<nav aria-label="An Arrow Points Somewhere" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#wheres-the-call-site">
    Where's The Call-site?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hidden-from-sight">
    Hidden From Sight
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this-is-wrong">
    This Is Wrong
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fixing-this">
    Fixing this
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lexical-this">
    Lexical This
  </a>
<nav aria-label="Lexical This" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#back-to-the-button">
    Back To The... Button
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#confession-time">
    Confession Time
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#find-the-right-call-site">
    Find The Right Call-Site
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#this-is-bound-to-come-up">
    This Is Bound To Come Up
  </a>
<nav aria-label="This Is Bound To Come Up" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#hardly-new">
    Hardly New
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#losing-this-battle">
    Losing This Battle
  </a>
<nav aria-label="Losing This Battle" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pre-binding-function-contexts">
    Pre-Binding Function Contexts
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#take-a-more-critical-look">
    Take A More Critical Look
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#variations">
    Variations
  </a>
<nav aria-label="Variations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#indirect-function-calls">
    Indirect Function Calls
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#accessing-globalthis">
    Accessing globalThis
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#template-tag-functions">
    Template Tag Functions
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stay-aware">
    Stay Aware
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/shane0/learning_js/edit/main/docs/know_js/objects-classes/ch4.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/shane0/learning_js/raw/main/docs/know_js/objects-classes/ch4.md" title="View source of this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"></path></svg>
</a>
<h1 id="chapter-4-this-works">Chapter 4: This Works<a class="headerlink" href="#chapter-4-this-works" title="Permanent link">¶</a></h1>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Work in progress</td>
</tr>
</tbody>
</table>
<p>We've seen the <code>this</code> keyword used quite a bit so far, but haven't really dug in to understand exactly how it works in JS. It's time we do so.</p>
<p>But to properly understand <code>this</code> in JS, you need to set aside any preconceptions you may have, especially assumptions from how <code>this</code> works in other programming languages you may have experience in.</p>
<p>Here's the most important thing to understand about <code>this</code>: the determination of what value (usually, object) <code>this</code> points at is not made at author time, but rather determined at runtime. That means you cannot simply look at a <code>this</code>-aware function (even a method in a <code>class</code> definition) and know for sure what <code>this</code> will hold while that function runs.</p>
<p>Instead, you have to find each place the function is invoked, and look at <em>how</em> it's invoked (not even <em>where</em> matters). That's the only way to fully answer what <code>this</code> will point to.</p>
<p>In fact, a single <code>this</code>-aware function can be invoked at least four different ways, and any of those approaches will end up assigning a different <code>this</code> for that particular function invocation.</p>
<p>So the typical question we might ask when reading code -- "What does <code>this</code> point to the function?" -- is not actually a valid question. The question you really have to ask is, "When the function is invoked a certain way, what <code>this</code> will be assigned for that invocation?"</p>
<p>If your brain is already twisting around just reading this chapter intro... good! Settle in for a rewiring of how you think about <code>this</code> in JS.</p>
<h2 id="this-aware">This Aware<a class="headerlink" href="#this-aware" title="Permanent link">¶</a></h2>
<p>I used the phrase <code>this</code>-aware just a moment ago. But what exactly do I mean by that?</p>
<p>Any function that has a <code>this</code> keyword in it.</p>
<p>If a function does not have <code>this</code> in it anywhere, then the rules of how <code>this</code> behaves don't affect that function in any way. But if it <em>does</em> have even a single <code>this</code> in it, then you absolutely cannot determine how the function will behave without figuring out, for each invocation of the function, what <code>this</code> will point to.</p>
<p>It's sort of like the <code>this</code> keyword is a placeholder in a template. That placeholder's value-replacement doesn't get determined when we author the code; it gets determined while the code is running.</p>
<p>You might think I'm just playing word games here. Of course, when you write the program, you write out all the calls to each function, so you've already determined what the <code>this</code> is going to be when you authored the code, right? Right!?</p>
<p>Not so fast!</p>
<p>First of all, you don't always write all the code that invokes your function(s). Your <code>this</code>-aware function(s) might be passed as a callback(s) to some other code, either in your code base, or in a third-party framework/utility, or even inside a native built-in mechanism of the language or environment that's hosting your program.</p>
<p>But even aside from passing functions as callbacks, several mechanisms in JS allow for conditional runtime behaviors to determine which value (again, usually object) will be set for the <code>this</code> of a particular function invocation. So even though you may have written all that code, you <em>at best</em> will have to mentally execute the different conditions/paths that end up affecting the function invocation.</p>
<p>And why does all this matter?</p>
<p>Because it's not just you, the author of the code, that needs to figure this stuff out. It's <em>every single reader</em> of your code, forever. If anyone (even your future self) wants to read a piece of code that defines a <code>this</code>-aware function, that inevitably means that, to fully understand and predict its behavior, that person will have to find, read, and understand every single invocation of that function.</p>
<h3 id="this-confuses-me">This Confuses Me<a class="headerlink" href="#this-confuses-me" title="Permanent link">¶</a></h3>
<p>Now, in fairness, that's already partially true if we consider a function's parameters. To understand how a function is going to work, we need to know what is being passed into it. So any function with at least one parameter is, in a similar sense, <em>argument</em>-aware -- meaning, what argument(s) is/are passed in and assigned to the parameter(s) of the function.</p>
<p>But with parameters, we often have a bit more of a hint from the function itself what the parameters will do and hold.</p>
<p>We often see the names of the parameters declared right in the function header, which goes a long way to explaining their nature/purpose. And if there are defaults for the parameters, we often see them declared inline with <code>= whatever</code> clauses. Moreover, depending on the code style of the author, we may see in the first several lines of the function a set of logic that applies to these parameters; this could be assertions about the values (disallowed values, etc), or even modifications (type conversion, formatting, etc).</p>
<p>Actually, <code>this</code> is very much like a parameter to a function, but it's an implicit parameter rather than an explicit one. You don't see any signal that <code>this</code> is going to be used, in the function header anywhere. You have to read the entire function body to see if <code>this</code> appears anywhere.</p>
<p>The "parameter" name is always <code>this</code>, so we don't get much of a hint as to its nature/purpose from such a general name. In fact, there's historically a lot of confusion of what "this" even is supposed to mean. And we rarely see much if anything done to validate/convert/etc the <code>this</code> value applied to a function invocation. In fact, virtually all <code>this</code>-aware code I've seen just neatly assumes the <code>this</code> "parameter" is holding exactly what value is expected. Talk about <strong>a trap for unexpected bugs!</strong></p>
<h3 id="so-what-is-this">So What Is This?<a class="headerlink" href="#so-what-is-this" title="Permanent link">¶</a></h3>
<p>If <code>this</code> is an implicit parameter, what's its purpose? What's being passed in?</p>
<p>Hopefully you have already read the "Scope &amp; Closures" book of this series. If not, I strongly encourage you to circle back and read that one once you've finished this one. In that book, I explained at length how scopes (and closures!) work, an especially important characteristic of functions.</p>
<p>Lexical scope (including all the variables closed over) represents a <em>static</em> context for the function's LEXICAL identifier references to be evaluated against. It's fixed/static because at author time, when you place functions and variable declarations in various (nested) scopes, those decisions are fixed, and unaffected by any runtime conditions.</p>
<p>By contrast, a different programming language might offer <em>dynamic</em> scope, where the context for a function's variable references is not determined by author-time decisions but by runtime conditions. Such a system would be undoubtedly more flexible than static context -- though with flexibility often comes complexity.</p>
<p>To be clear: JS scope is always and only LEXICAL and <em>static</em> (if we ignore non-strict mode cheats like <code>eval(..)</code> and <code>with</code>). However, one of the truly powerful things about JS is that it offers another mechanism with similar flexibility and capabilities to <em>dynamic</em> scope.</p>
<p>The <code>this</code> mechanism is, effectively, <em>dynamic</em> context (not scope); it's how a <code>this</code>-aware function can be dynamically invoked against different contexts -- something that's impossible with closure and LEXICAL scope identifiers!</p>
<h3 id="why-is-this-so-implicit">Why Is This So Implicit?<a class="headerlink" href="#why-is-this-so-implicit" title="Permanent link">¶</a></h3>
<p>You might wonder why something as important as a <em>dynamic</em> context is handled as an implicit input to a function, rather than being an explicit argument passed in.</p>
<p>That's a very important question, but it's not one we can quite answer, yet. Hold onto that question though.</p>
<h3 id="can-we-get-on-with-this">Can We Get On With This?<a class="headerlink" href="#can-we-get-on-with-this" title="Permanent link">¶</a></h3>
<p>So why have I belabored <em>this</em> subject for a couple of pages now? You get it, right!? You're ready to move on.</p>
<p>My point is, you the author of code, and all other readers of the code even years or decades in the future, need to be <code>this</code>-aware. That's the choice, the burden, you place on the reading of such code. And yes, that goes for the choice to use <code>class</code> (see Chapter 3), as most class methods will be <code>this</code>-aware out of necessity.</p>
<p>Be aware of <em>this</em> <code>this</code> choice in code you write. Do it intentionally, and do it in such a way as to produce more outcome benefit than burden. Make sure <code>this</code> usage in your code <em>carries its own weight</em>.</p>
<p>Let me put it <em>this</em> way: don't use <code>this</code>-aware code unless you really can justify it, and you've carefully weighed the costs. Just because you've seen a lot of code examples slinging around <code>this</code> in others' code, doesn't mean that <code>this</code> belongs in <em>this</em> code you're writing.</p>
<p>The <code>this</code> mechanism in JS, paired with <code>[[Prototype]]</code> delegation, is an extremely powerful pillar of the language. But as the cliche goes: "with great power comes great responsibility". Anecdotally, even though I really like and appreciate <em>this</em> pillar of JS, probably less than 5% of the JS code I ever write uses it. And when I do, it's with restraint. It's not my default, go-to JS capability.</p>
<h2 id="this-is-it">This Is It!<a class="headerlink" href="#this-is-it" title="Permanent link">¶</a></h2>
<p>OK, enough of the wordy lecture. You're ready to dive into <code>this</code> code, right?</p>
<p>Let's revisit (and extend) <code>Point2d</code> from Chapter 3, but just as an object with data properties and functions on it, instead of using <code>class</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="nx">init</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="nx">rotate</span><span class="p">(</span><span class="nx">angleRadians</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">rotatedX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">angleRadians</span><span class="p">)</span><span class="w"> </span><span class="o">-</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">angleRadians</span><span class="p">);</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">rotatedY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">angleRadians</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">angleRadians</span><span class="p">);</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rotatedX</span><span class="p">;</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rotatedY</span><span class="p">;</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sb">`(</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">,</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="p">};</span>
</code></pre></div>
<p>As you can see, the <code>init(..)</code>, <code>rotate(..)</code>, and <code>toString()</code> functions are <code>this</code>-aware. You might be in the habit of assuming that the <code>this</code> reference will obviously always hold the <code>point</code> object. But that's not guaranteed in any way.</p>
<p>Keep reminding yourself as you go through the rest of this chapter: the <code>this</code> value for a function is determined by <em>how</em> the function is invoked. That means you can't look at the function's definition, nor where the function is defined (not even the enclosing <code>class</code>!). In fact, it doesn't even matter where the function is called from.</p>
<p>We only need to look at <em>how</em> the functions are called; that's the only factor that matters.</p>
<h3 id="implicit-context-invocation">Implicit Context Invocation<a class="headerlink" href="#implicit-context-invocation" title="Permanent link">¶</a></h3>
<p>Consider this call:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
</code></pre></div>
<p>We're invoking the <code>init(..)</code> function, but notice the <code>point.</code> in front of it? This is an <em>implicit context</em> binding. It says to JS: invoke the <code>init(..)</code> function with <code>this</code> referencing <code>point</code>.</p>
<p>That is the <em>normal</em> way we'd expect a <code>this</code> to work, and that's also one of the most common ways we invoke functions. So the typical invocation gives us the intuitive outcome. That's a good thing!</p>
<h3 id="default-context-invocation">Default Context Invocation<a class="headerlink" href="#default-context-invocation" title="Permanent link">¶</a></h3>
<p>But what happens if we do this?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">;</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nx">init</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
</code></pre></div>
<p>You might assume that we'd get the same outcome as the previous snippet. But that's not how JS <code>this</code> assignment works.</p>
<p>The <em>call-site</em> for the function is <code>init(3,4)</code>, which is different than <code>point.init(3,4)</code>. When there's no <em>implicit context</em> (<code>point.</code>), nor any other kind of <code>this</code> assignment mechanism, the <em>default context</em> assignment occurs.</p>
<p>What will <code>this</code> reference when <code>init(3,4)</code> is invoked like that?</p>
<p><em>It depends.</em></p>
<p>Uh oh. Depends? That sounds confusing.</p>
<p>Don't worry, it's not as bad as it sounds. The <em>default context</em> assignment depends on whether the code is in strict-mode or not. But thankfully, virtually all JS code these days is running in strict-mode; for example, ESM (ES Modules) always run in strict-mode, as does code inside a <code>class</code> block. And virtually all transpiled JS code (via Babel, TypeScript, etc) is written to declare strict-mode.</p>
<p>So almost all of the time, modern JS code will be running in strict-mode, and thus the <em>default assignment</em> context won't "depend" on anything; it's pretty straightforward: <code>undefined</code>. That's it!</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Keep in mind: <code>undefined</code> does not mean "not defined"; it means, "defined with the special empty <code>undefined</code> value". I know, I know... the name and meaning are mismatched. That's language legacy baggage, for you. (shrugging shoulders)</td>
</tr>
</tbody>
</table>
<p>That means <code>init(3,4)</code>, if run in strict-mode, would throw an exception. Why? Because the <code>this.x</code> reference in <code>init(..)</code> is a <code>.x</code> property access on <code>undefined</code> (i.e., <code>undefined.x</code>), which is not allowed:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="s2">"use strict"</span><span class="p">;</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">;</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="nx">init</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="c1">// TypeError: Cannot set properties of</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="c1">// undefined (setting 'x')</span>
</code></pre></div>
<p>Stop for a moment and consider: why would JS choose to default the context to <code>undefined</code>, so that any <em>default context</em> invocation of a <code>this</code>-aware function will fail with such an exception?</p>
<p>Because a <code>this</code>-aware function <strong>always needs a <code>this</code></strong>. The invocation <code>init(3,4)</code> isn't providing a <code>this</code>, so that <em>is</em> a mistake, and <em>should</em> raise an exception so the mistake can be corrected. The lesson: never invoke a <code>this</code>-aware function without providing it a <code>this</code>!</p>
<p>Just for completeness sake: in the less common non-strict mode, the <em>default context</em> is the global object -- JS defines it as <code>globalThis</code>, which in browser JS is essentially an alias to <code>window</code>, and in Node it's <code>global</code>. So, when <code>init(3,4)</code> runs in non-strict mode, the <code>this.x</code> expression is <code>globalThis.x</code> -- also known as <code>window.x</code> in the browser, or <code>global.x</code> in Node. Thus, <code>globalThis.x</code> gets set as <code>3</code> and <code>globalThis.y</code> gets set as <code>4</code>.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1">// no strict-mode here, beware!</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">;</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="nx">init</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="nb">globalThis</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span><span class="w">   </span><span class="c1">// 3</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="nb">globalThis</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span><span class="w">   </span><span class="c1">// 4</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span><span class="w">        </span><span class="c1">// null</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span><span class="w">        </span><span class="c1">// null</span>
</code></pre></div>
<p>That's unfortunate, because it's almost certainly <em>not</em> the intended outcome. Not only is it bad if it's a global variable, but it's also <em>not</em> changing the property on our <code>point</code> object, so program bugs are guaranteed.</p>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Ouch! Nobody wants accidental global variables implicitly created from all over the code. The lesson: always make sure your code is running in strict-mode!</td>
</tr>
</tbody>
</table>
<h3 id="explicit-context-invocation">Explicit Context Invocation<a class="headerlink" href="#explicit-context-invocation" title="Permanent link">¶</a></h3>
<p>Functions can alternately be invoked with <em>explicit context</em>, using the built-in <code>call(..)</code> or <code>apply(..)</code> utilities:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">;</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="nx">init</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="w"> </span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="p">);</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="c1">// or: init.apply( point, [ 3, 4 ] )</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span><span class="w">        </span><span class="c1">// 3</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span><span class="w">        </span><span class="c1">// 4</span>
</code></pre></div>
<p><code>init.call(point,3,4)</code> is effectively the same as <code>point.init(3,4)</code>, in that both of them assign <code>point</code> as the <code>this</code> context for the <code>init(..)</code> invocation.</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Both <code>call(..)</code> and <code>apply(..)</code> utilities take as their first argument a <code>this</code> context value; that's almost always an object, but can technically can be any value (number, string, etc). The <code>call(..)</code> utility takes subsequent arguments and passes them through to the invoked function, whereas <code>apply(..)</code> expects its second argument to be an array of values to pass as arguments.</td>
</tr>
</tbody>
</table>
<p>It might seem awkward to contemplate invoking a function with the <em>explicit context</em> assignment (<code>call(..)</code> / <code>apply(..)</code>) style in your program. But it's more useful than might be obvious at first glance.</p>
<p>Let's recall the original snippet:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="nx">init</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="nx">rotate</span><span class="p">(</span><span class="nx">angleRadians</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sb">`(</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">,</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="p">};</span>
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a>
<a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="kd">var</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="mf">6</span><span class="w"> </span><span class="p">);</span>
<a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a>
<a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span><span class="w">                </span><span class="c1">// 3</span>
<a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span><span class="w">                </span><span class="c1">// 4</span>
<a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span><span class="w">         </span><span class="c1">// 5</span>
<a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span><span class="w">         </span><span class="c1">// 6</span>
</code></pre></div>
<p>Are you seeing what I did there?</p>
<p>I wanted to define <code>anotherPoint</code>, but I didn't want to repeat the definitions of those <code>init(..)</code> / <code>rotate(..)</code> / <code>toString()</code> functions from <code>point</code>. So I "borrowed" a function reference, <code>point.init</code>, and explicitly set the empty object <code>anotherPoint</code> as the <code>this</code> context, via <code>call(..)</code>.</p>
<p>When <code>init(..)</code> is running at that moment, <code>this</code> inside it will reference <code>anotherPoint</code>, and that's why the <code>x</code> / <code>y</code> properties (values <code>5</code> / <code>6</code>, respectively) get set there.</p>
<p>Any <code>this</code>-aware functions can be borrowed like this: <code>point.rotate.call(anotherPoint, ..)</code>, <code>point.toString.call(anotherPoint)</code>.</p>
<h4 id="revisiting-implicit-context-invocation">Revisiting Implicit Context Invocation<a class="headerlink" href="#revisiting-implicit-context-invocation" title="Permanent link">¶</a></h4>
<p>Another approach to share behavior between <code>point</code> and <code>anotherPoint</code> would have been:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="nx">init</span><span class="o">:</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">,</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="nx">rotate</span><span class="o">:</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">rotate</span><span class="p">,</span>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="nx">toString</span><span class="o">:</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">toString</span><span class="p">,</span>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="p">};</span>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">);</span>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span><span class="w">         </span><span class="c1">// 5</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span><span class="w">         </span><span class="c1">// 6</span>
</code></pre></div>
<p>This is another way of "borrowing" the functions, by adding shared references to the functions on any target object (e.g., <code>anotherPoint</code>). The call-site invocation <code>anotherPoint.init(5,6)</code> is the more natural/ergonomic style that relies on <em>implicit context</em> assignment.</p>
<p>It may seem this approach is a little cleaner, comparing <code>anotherPoint.init(5,6)</code> to <code>point.init.call(anotherPoint,5,6)</code>.</p>
<p>But the main downside is having to modify any target object with such shared function references, which can be verbose, manual, and error-prone. Sometimes such an approach is acceptable, but many other times, <em>explicit context</em> assignment with <code>call(..)</code> / <code>apply(..)</code> is more preferable.</p>
<h3 id="new-context-invocation">New Context Invocation<a class="headerlink" href="#new-context-invocation" title="Permanent link">¶</a></h3>
<p>We've so far seen three different ways of context assignment at the function call-site: <em>default</em>, <em>implicit</em>, and <em>explicit</em>.</p>
<p>A fourth way to call a function, and assign the <code>this</code> for that invocation, is with the <code>new</code> keyword:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="nx">init</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="p">};</span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a>
<a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span><span class="w">     </span><span class="c1">// 3</span>
<a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span><span class="w">     </span><span class="c1">// 4</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">TIP:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">This example has a bit of nuance to be explained. The <code>init: function() { .. }</code> form shown here -- specifically, a function expression assigned to a property -- is required for the function to be validly called with the <code>new</code> keyword. From previous snippets, the concise method form of <code>init() { .. }</code> defines a function that <em>cannot</em> be called with <code>new</code>.</td>
</tr>
</tbody>
</table>
<p>You've typically seen <code>new</code> used with <code>class</code> for creating instances. But as an underlying mechanism of the JS language, <code>new</code> is not inherently a <code>class</code> operation.</p>
<p>In a sense, the <code>new</code> keyword hijacks a function and forces its behavior into a different mode than a normal invocation. Here are the 4 special steps that JS performs when a function is invoked with <code>new</code>:</p>
<ol>
<li>
<p>create a brand new empty object, out of thin air.</p>
</li>
<li>
<p>link the <code>[[Prototype]]</code> of that new empty object to the function's <code>.prototype</code> object (see Chapter 2).</p>
</li>
<li>
<p>invoke the function with the <code>this</code> context set to that new empty object.</p>
</li>
<li>
<p>if the function doesn't return its own object value explicitly (with a <code>return ..</code> statement), assume the function call should instead return the new object (from steps 1-3).</p>
</li>
</ol>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Step 4 implies that if you <code>new</code> invoke a function that <em>does</em> return its own object -- like <code>return { .. }</code>, etc -- then the new object from steps 1-3 is <em>not</em> returned. That's a tricky gotcha to be aware of, in that it effectively discards that new object before the program has a chance to receive and store a reference to it. Essentially, <code>new</code> should never be used to invoke a function that has explicit <code>return ..</code> statement(s) in it.</td>
</tr>
</tbody>
</table>
<p>To understand these 4 <code>new</code> steps more concretely, I'm going to illustrate them in code, as an alternate to using the <code>new</code> keyword:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1">// alternative to:</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="c1">//   var anotherPoint = new point.init(3,4)</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="p">;</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="c1">// this is a bare block to hide local</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="c1">// `let` declarations</span>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="p">{</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">    </span><span class="c1">// (Step 1)</span>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">tmpObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">    </span><span class="c1">// (Step 2)</span>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">setPrototypeOf</span><span class="p">(</span>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">        </span><span class="nx">tmpObj</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">prototype</span>
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">    </span><span class="p">);</span>
<a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">    </span><span class="c1">// or: tmpObj.__proto__ = point.init.prototype</span>
<a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a>
<a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="w">    </span><span class="c1">// (Step 3)</span>
<a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">tmpObj</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
<a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a>
<a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="w">    </span><span class="c1">// (Step 4)</span>
<a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="w">    </span><span class="nx">anotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="w">        </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s2">"object"</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">tmpObj</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">res</span>
<a href="#__codelineno-9-23" id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="w">    </span><span class="p">);</span>
<a href="#__codelineno-9-24" id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="p">}</span>
</code></pre></div>
<p>Clearly, the <code>new</code> invocation streamlines that set of manual steps!</p>
<table>
<thead>
<tr>
<th align="left">TIP:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">The <code>Object.setPrototypeOf(..)</code> in step 2 could also have been done via the <code>__proto__</code> property, such as <code>tmpObj.__proto__ = point.init.prototype</code>, or even as part of the object literal (step 1) with <code>tmpObj = { __proto__: point.init.prototype }</code>.</td>
</tr>
</tbody>
</table>
<p>Skipping some of the formality of these steps, let's recall an earlier snippet and see how <code>new</code> approximates a similar outcome:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="c1">// this approach:</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">anotherPoint</span><span class="p">,</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">);</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="c1">// can instead be approximated as:</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">yetAnotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">);</span>
</code></pre></div>
<p>That's a bit nicer! But there's a caveat here.</p>
<p>Using the other functions that <code>point</code> holds against <code>anotherPoint</code> / <code>yetAnotherPoint</code>, we won't want to do with <code>new</code>. Why? Because <code>new</code> is creating a <em>new</em> object, but that's not what we want if we intend to invoke a function against an existing object.</p>
<p>Instead, we'll likely use <em>explicit context</em> assignment:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nx">point</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="p">,</span><span class="w"> </span><span class="cm">/*angleRadians=*/</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="p">);</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="nx">point</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="w"> </span><span class="nx">yetAnotherPoint</span><span class="w"> </span><span class="p">);</span>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="c1">// (5,6)</span>
</code></pre></div>
<h3 id="review-this">Review This<a class="headerlink" href="#review-this" title="Permanent link">¶</a></h3>
<p>We've seen four rules for <code>this</code> context assignment in function calls. Let's put them in order of precedence:</p>
<ol>
<li>
<p>Is the function invoked with <code>new</code>, creating and setting a <em>new</em> <code>this</code>?</p>
</li>
<li>
<p>Is the function invoked with <code>call(..)</code> or <code>apply(..)</code>, <em>explicitly</em> setting <code>this</code>?</p>
</li>
<li>
<p>Is the function invoked with an object reference at the call-site (e.g., <code>point.init(..)</code>), <em>implicitly</em> setting <code>this</code>?</p>
</li>
<li>
<p>If none of the above... are we in non-strict mode? If so, <em>default</em> the <code>this</code> to <code>globalThis</code>. But if in strict-mode, <em>default</em> the <code>this</code> to <code>undefined</code>.</p>
</li>
</ol>
<p>These rules, <em>in this order</em>, are how JS determines the <code>this</code> for a function invocation. If multiple rules match a call-site (e.g., <code>new point.init.call(..)</code>), the first rule from the list to match wins.</p>
<p>That's it, you're now master over the <code>this</code> keyword. Well, not quite. There's a bunch more nuance to cover. But you're well on your way!</p>
<h2 id="an-arrow-points-somewhere">An Arrow Points Somewhere<a class="headerlink" href="#an-arrow-points-somewhere" title="Permanent link">¶</a></h2>
<p>Everything I've asserted so far about <code>this</code> in functions, and how its determined based on the call-site, makes one giant assumption: that you're dealing with a <em>regular</em> function (or method).</p>
<p>So what's an <em>irregular</em> function?!? It looks like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Yes, I'm being a tad sarcastic and unfair to call an arrow function "irregular" and to use such a contrived example. It's a joke, ok?</td>
</tr>
</tbody>
</table>
<p>Here's a real example of an <code>=&gt;</code> arrow function:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clickHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">evt</span><span class="w"> </span><span class="p">=&gt;</span>
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="s2">"button"</span><span class="p">)</span><span class="w"> </span><span class="o">?</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theFormElem</span><span class="p">.</span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">        </span><span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
</code></pre></div>
<p>For comparison sake, let me also show the non-arrow equivalent:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clickHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="s2">"button"</span><span class="p">)</span><span class="w"> </span><span class="o">?</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theFormElem</span><span class="p">.</span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">        </span><span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="p">};</span>
</code></pre></div>
<p>Or if we went a bit old-school about it -- this is my jam! -- we could try the standalone function declaration form:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">clickHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="s2">"button"</span><span class="p">)</span><span class="w"> </span><span class="o">?</span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theFormElem</span><span class="p">.</span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">        </span><span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="p">}</span>
</code></pre></div>
<p>Or if the function appeared as a method in a <code>class</code> definition, or as a concise method in an object literal, it would look like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1">// ..</span>
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nx">clickHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="s2">"button"</span><span class="p">)</span><span class="w"> </span><span class="o">?</span>
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theFormElem</span><span class="p">.</span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">        </span><span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="p">}</span>
</code></pre></div>
<p>What I really want to focus on is how each of these forms of the function will behave with respect to their <code>this</code> reference, and whether the first <code>=&gt;</code> form differs from the others (hint: it does!). But let's start with a little quiz to see if you've been paying attention.</p>
<p>For each of those function forms just shown, how do we know what each <code>this</code> will reference?</p>
<h3 id="wheres-the-call-site">Where's The Call-site?<a class="headerlink" href="#wheres-the-call-site" title="Permanent link">¶</a></h3>
<p>Hopefully, you responded with something like: "first, we need to see how the functions are called."</p>
<p>Fair enough.</p>
<p>Let's say our program looks like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">infoForm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="nx">theFormElem</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="nx">theSubmitBtn</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theFormElem</span><span class="w"> </span><span class="o">=</span>
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"the-info-form"</span><span class="p">);</span>
<a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theSubmitBtn</span><span class="w"> </span><span class="o">=</span>
<a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">            </span><span class="nx">theFormElem</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"button[type=submit]"</span><span class="p">);</span>
<a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a>
<a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">        </span><span class="c1">// is *this* the call-site?</span>
<a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theSubmitBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">            </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">,</span>
<a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">            </span><span class="kc">false</span>
<a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w">        </span><span class="p">);</span>
<a href="#__codelineno-17-17" id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-17-18" id="__codelineno-17-18" name="__codelineno-17-18"></a>
<a href="#__codelineno-17-19" id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-17-20" id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="p">}</span>
</code></pre></div>
<p>Ah, interesting. Half of you readers have never seen actual DOM API code like <code>getElementById(..)</code>, <code>querySelector(..)</code>, and <code>addEventListener(..)</code> before. I heard the confusion bells whistle just now!</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Sorry, I'm dating myself, here. I've been doing this stuff long enough that I remember when we did that kind of code long before we had utilities like jQuery cluttering up the code with <code>$</code> everywhere. And after many years of front-end evolution, we seem to have landed somewhere quite a bit more "modern" -- at least, that's the prevailing presumption.</td>
</tr>
</tbody>
</table>
<p>I'm guessing many of you these days are used to seeing component-framework code (React, etc) somewhat like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a>// ..
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>infoForm(props) {
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a>    return (
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a>        &lt;form ref={this.theFormElem}&gt;
<a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a>            &lt;button type=submit onClick=this.clickHandler&gt;
<a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a>                Click Me
<a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a>            &lt;/button&gt;
<a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a>        &lt;/form&gt;
<a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a>    );
<a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a>}
<a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a>
<a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a>// ..
</code></pre></div>
<p>Of course, there's a bunch of other ways that code might be shaped, depending on if you're using one framework or another, etc.</p>
<p>Or maybe you're not even using <code>class</code> / <code>this</code> style components anymore, because you've moved everything to hooks and closures. In any case, for our discussion purposes, <em>this</em> chapter is all about <code>this</code>, so we need to stick to a coding style like the above, to have code related to the discussion.</p>
<p>And neither of those two previous code snippets show the <code>clickHandler</code> function being defined. But I've said repeatedly so far, that doesn't matter; all that matters is ... what? say it with me... all that matters is <em>how</em> the function is invoked.</p>
<p>So how is <code>clickHandler</code> being invoked? What's the call-site, and which context assignment rule does it match?</p>
<h3 id="hidden-from-sight">Hidden From Sight<a class="headerlink" href="#hidden-from-sight" title="Permanent link">¶</a></h3>
<p>If you're stuck, don't worry. I'm deliberately making this difficult, to point something very important out.</p>
<p>When the <code>"click"</code> or <code>onClick=</code> event handler bindings happen, in both cases, we specified <code>this.clickHandler</code>, which implies that there is a <code>this</code> context object with a property on it called <code>clickHandler</code>, which is holding our function definition.</p>
<p>So, is <code>this.clickHandler</code> the call-site? If it was, what assignment rule applies? The <em>implicit context</em> rule (#3)?</p>
<p>Unfortunately, no.</p>
<p>The problem is, <strong>we cannot actually see the call-site</strong> in this program. Uh oh.</p>
<p>If we can't see the call-site, how do we know <em>how</em> the function is going to actually get called?</p>
<p><em>That's</em> the exact point I'm making.</p>
<p>It doesn't matter that we passed in <code>this.clickHandler</code>. That is merely a reference to a function object value. It's not a call-site.</p>
<p>Under the covers, somewhere inside a framework, library, or even the JS environment itself, when a user clicks the button, a reference to the <code>clickHandler(..)</code> function is going to be invoked. And as we've implied, that call-site is even going to pass in the DOM event object as the <code>evt</code> argument.</p>
<p>Since we can't see the call-site, we have to <em>imagine</em> it. Might it look like...?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1">// ..</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="nx">eventCallback</span><span class="p">(</span><span class="w"> </span><span class="nx">domEventObj</span><span class="w"> </span><span class="p">);</span>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="c1">// ..</span>
</code></pre></div>
<p>If it did, which <code>this</code> rule would apply? The <em>default context</em> rule (#4)?</p>
<p>Or, what if the call-site looked like this...?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1">// ..</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="nx">eventCallback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="w"> </span><span class="nx">domElement</span><span class="p">,</span><span class="w"> </span><span class="nx">domEventObj</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>Now which <code>this</code> rule would apply? The <em>explicit context</em> rule (#2)?</p>
<p>Unless you open and view the source code for the framework/library, or read the documentation/specification, you won't <em>know</em> what to expect of that call-site. Which means that predicting, ultimately, what <code>this</code> points to in the <code>clickHandler</code> function you write, is... to put it mildly... a bit convoluted.</p>
<h3 id="this-is-wrong"><em>This</em> Is Wrong<a class="headerlink" href="#this-is-wrong" title="Permanent link">¶</a></h3>
<p>To spare you any more pain here, I'll cut to the chase.</p>
<p>Pretty much all implementations of a click-handler mechanism are going to do something like the <code>.call(..)</code>, and they're going to set the DOM element (e.g., button) the event listener is bound to, as the <em>explicit context</em> for the invocation.</p>
<p>Hmmm... is that ok, or is that going to be a problem?</p>
<p>Recall that our <code>clickHandler(..)</code> function is <code>this</code>-aware, and that its <code>this.theFormElem</code> reference implies referencing an object with a <code>theFormElem</code> property, which in turn is pointing at the parent <code>&lt;form&gt;</code> element. DOM buttons do not, by default, have a <code>theFormElem</code> property on them.</p>
<p>In other words, the <code>this</code> reference that our event handler will have set for it is almost certainly wrong. Oops.</p>
<p>Unless we want to rewrite the <code>clickHandler</code> function, we're going to need to fix that.</p>
<h3 id="fixing-this">Fixing <code>this</code><a class="headerlink" href="#fixing-this" title="Permanent link">¶</a></h3>
<p>Let's consider some options to address the mis-assignment. To keep things focused, I'll stick to this style of event binding for the discussion:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">submitBtnaddEventListener</span><span class="p">(</span>
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">,</span>
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="kc">false</span>
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="p">);</span>
</code></pre></div>
<p>Here's one way to address it:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1">// store a fixed reference to the current</span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="c1">// `this` context</span>
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a>
<a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="k">this</span><span class="p">.</span><span class="nx">submitBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
<a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
<a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">    </span><span class="kc">false</span>
<a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="p">);</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">TIP:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Most older JS code that uses this approach will say something like <code>var self = this</code> instead of the <code>context</code> name I'm giving it here. "Self" is a shorter word, and sounds cooler. But it's also entirely the wrong semantic meaning. The <code>this</code> keyword is not a "self" reference to the function, but rather the context for that current function invocation. Those may seem like the same thing at a glance, but they're completely different concepts, as different as apples and a Beatles song. So... to paraphrase them, "Hey developer, don't make it bad. Take a sad <code>self</code> and make it better <code>context</code>."</td>
</tr>
</tbody>
</table>
<p>What's going on here? I recognized that the enclosing code, where the <code>addEventListener</code> call is going to run, has a current <code>this</code> context that is correct, and we need to ensure that same <code>this</code> context is applied when <code>clickHandler(..)</code> gets invoked.</p>
<p>I defined a surrounding function (<code>handler(..)</code>) and then forced the call-site to look like:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="nx">context</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">TIP:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Which <code>this</code> context assignment rule is applied here? That's right, the <em>implicit context</em> rule (#3).</td>
</tr>
</tbody>
</table>
<p>Now, it doesn't matter what the internal call-site of the library/framework/environment looks like. But, why?</p>
<p>Because we're now <em>actually</em> in control of the call-site. It doesn't matter how <code>handler(..)</code> gets invoked, or what its <code>this</code> is assigned. It only matters than when <code>clickHandler(..)</code> is invoked, the <code>this</code> context is set to what we wanted.</p>
<p>I pulled off that trick not only by defining a surrounding function (<code>handler(..)</code>) so I can control the call-site, but... and this is important, so don't miss it... I defined <code>handler(..)</code> as a NON-<code>this</code>-aware function! There's no <code>this</code> keyword inside of <code>handler(..)</code>, so whatever <code>this</code> gets set (or not) by the library/framework/environment, is completely irrelevant.</p>
<p>The <code>var context = this</code> line is critical to the trick. It defines a LEXICAL variable <code>context</code>, which is not some special keyword, holding a snapshot of the value in the outer <code>this</code>. Then inside <code>clickHandler</code>, we merely reference a LEXICAL variable (<code>context</code>), no relative/magic <code>this</code> keyword.</p>
<h3 id="lexical-this">Lexical This<a class="headerlink" href="#lexical-this" title="Permanent link">¶</a></h3>
<p>The name for this pattern, by the way, is "LEXICAL this", meaning a <code>this</code> that behaves like a LEXICAL scope variable instead of like a dynamic context binding.</p>
<p>But it turns out JS has an easier way of performing the "LEXICAL this" magic trick. Are you ready for the trick reveal!?</p>
<p>...</p>
<p>The <code>=&gt;</code> arrow function! Tada!</p>
<p>That's right, the <code>=&gt;</code> function is, unlike all other function forms, special, in that it's not special at all. Or, rather, that it doesn't define anything special for <code>this</code> behavior whatsoever.</p>
<p>In an <code>=&gt;</code> function, the <code>this</code> keyword... <strong>is not a keyword</strong>. It's absolutely no different from any other variable, like <code>context</code> or <code>happyFace</code> or <code>foobarbaz</code>.</p>
<p>Let me illustrate <em>this</em> point more directly:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">outer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="c1">// define a return an "inner"</span>
<a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">    </span><span class="c1">// function</span>
<a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">inner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a>
<a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">inner</span><span class="p">;</span>
<a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="p">}</span>
<a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a>
<a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="kd">var</span><span class="w"> </span><span class="nx">one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="mf">42</span><span class="p">,</span>
<a href="#__codelineno-24-15" id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="p">};</span>
<a href="#__codelineno-24-16" id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="kd">var</span><span class="w"> </span><span class="nx">two</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-24-17" id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">"sad face"</span><span class="p">,</span>
<a href="#__codelineno-24-18" id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="p">};</span>
<a href="#__codelineno-24-19" id="__codelineno-24-19" name="__codelineno-24-19"></a>
<a href="#__codelineno-24-20" id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="kd">var</span><span class="w"> </span><span class="nx">innerFn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">outer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">one</span><span class="p">);</span>
<a href="#__codelineno-24-21" id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="c1">// 42</span>
<a href="#__codelineno-24-22" id="__codelineno-24-22" name="__codelineno-24-22"></a>
<a href="#__codelineno-24-23" id="__codelineno-24-23" name="__codelineno-24-23"></a><span class="nx">innerFn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">two</span><span class="p">);</span>
<a href="#__codelineno-24-24" id="__codelineno-24-24" name="__codelineno-24-24"></a><span class="c1">// 42   &lt;-- not "sad face"</span>
</code></pre></div>
<p>The <code>innerFn.call(two)</code> would, for any <em>regular</em> function definition, have resulted in <code>"sad face"</code> here. But since the <code>inner</code> function we defined and returned (and assigned to <code>innerFn</code>) was an <em>irregular</em> <code>=&gt;</code> arrow function, it has no special <code>this</code> behavior, but instead has "LEXICAL this" behavior.</p>
<p>When the <code>innerFn(..)</code> (aka <code>inner(..)</code>) function is invoked, even with an <em>explicit context</em> assignment via <code>.call(..)</code>, that assignment is ignored.</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">I'm not sure why <code>=&gt;</code> arrow functions even have a <code>call(..)</code> / <code>apply(..)</code> on them, since they are silent no-op functions. I guess it's for consistency with normal functions. But as we'll see later, there are other inconsistencies between <em>regular</em> functions and <em>irregular</em> <code>=&gt;</code> arrow functions.</td>
</tr>
</tbody>
</table>
<p>When a <code>this</code> is encountered (<code>this.value</code>) inside an <code>=&gt;</code> arrow function, <code>this</code> is treated like a normal LEXICAL variable, not a special keyword. And since there is no <code>this</code> variable in that function itself, JS does what it always does with LEXICAL variables: it goes up one level of LEXICAL scope -- in this case, to the surrounding <code>outer(..)</code> function, and it checks to see if there's any registered <code>this</code> in that scope.</p>
<p>Luckily, <code>outer(..)</code> is a <em>regular</em> function, which means it has a normal <code>this</code> keyword. And the <code>outer.call(one)</code> invocation assigned <code>one</code> to its <code>this</code>.</p>
<p>So, <code>innerFn.call(two)</code> is invoking <code>inner()</code>, but when <code>inner()</code> looks up a value for <code>this</code>, it gets... <code>one</code>, not <code>two</code>.</p>
<h4 id="back-to-the-button">Back To The... Button<a class="headerlink" href="#back-to-the-button" title="Permanent link">¶</a></h4>
<p>You thought I was going to make a pun joke and say "future" there, didn't you!?</p>
<p>A more direct and appropriate way of solving our earlier issue, where we had done <code>var context = this</code> to get a sort of faked "LEXICAL this" behavior, is to use the <code>=&gt;</code> arrow function, since its primary design feature is... "LEXICAL this".</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">submitBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">    </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">    </span><span class="nx">evt</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">),</span>
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="kc">false</span>
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="p">);</span>
</code></pre></div>
<p>Boom! Problem solved! Mic drop!</p>
<p>Hear me on <em>this</em>: the <code>=&gt;</code> arrow function is <em>not</em> -- I repeat, <em>not</em> -- about typing fewer characters. The primary point of the <code>=&gt;</code> function being added to JS was to give us "LEXICAL this" behavior without having to resort to <code>var context = this</code> (or worse, <code>var self = this</code>) style hacks.</p>
<table>
<thead>
<tr>
<th align="left">TIP:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">If you need "LEXICAL this", always prefer an <code>=&gt;</code> arrow function. If you don't need "LEXICAL this", well... the <code>=&gt;</code> arrow function might not be the best tool for the job.</td>
</tr>
</tbody>
</table>
<h4 id="confession-time">Confession Time<a class="headerlink" href="#confession-time" title="Permanent link">¶</a></h4>
<p>I've said all along in this chapter, that how you write a function, and where you write the function, has <em>nothing</em> to do with how its <code>this</code> will be assigned.</p>
<p>For regular functions, that's true. But when we consider an irregular <code>=&gt;</code> arrow function, it's not entirely accurate anymore.</p>
<p>Recall the original <code>=&gt;</code> form of <code>clickHandler</code> from earlier in the chapter?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clickHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">evt</span><span class="w"> </span><span class="p">=&gt;</span>
<a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">    </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="s2">"button"</span><span class="p">)</span><span class="w"> </span><span class="o">?</span>
<a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theFormElem</span><span class="p">.</span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">        </span><span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
</code></pre></div>
<p>If we use that form, in the same context as our event binding, it could look like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clickHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">evt</span><span class="w"> </span><span class="p">=&gt;</span>
<a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">    </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="s2">"button"</span><span class="p">)</span><span class="w"> </span><span class="o">?</span>
<a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theFormElem</span><span class="p">.</span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">        </span><span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
<a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a>
<a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="k">this</span><span class="p">.</span><span class="nx">submitBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="nx">clickHandler</span><span class="p">,</span><span class="kc">false</span><span class="p">);</span>
</code></pre></div>
<p>A lot of developers prefer to even further reduce it, to an inline <code>=&gt;</code> arrow function:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">submitBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">    </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="nx">evt</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="s2">"button"</span><span class="p">)</span><span class="w"> </span><span class="o">?</span>
<a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">theFormElem</span><span class="p">.</span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">        </span><span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">(),</span>
<a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">    </span><span class="kc">false</span>
<a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="p">);</span>
</code></pre></div>
<p>When we write an <code>=&gt;</code> arrow function, we know for sure that its <code>this</code> binding will exactly be the current <code>this</code> binding of whatever surrounding function is running, regardless of what the call-site of the <code>=&gt;</code> arrow function looks like. So in other words, <em>how</em> we wrote the <code>=&gt;</code> arrow function, and <em>where</em> we wrote it, does matter.</p>
<p>That doesn't fully answer the <code>this</code> question, though. It just shifts the question to <em>how the enclosing function was invoked</em>. Actually, the focus on the call-site is still the only thing that matters.</p>
<p>But the nuance I'm confessing to having omitted until <em>this</em> moment is: it matters <em>which</em> call-site we consider, not just <em>any</em> call-site in the current call stack. The call-site that matters is, the nearest function-invocation in the current call stack <strong><em>that actually assigns a <code>this</code> context</em></strong>.</p>
<p>Since an <code>=&gt;</code> arrow function never has a <code>this</code>-assigning call-site (no matter what), that call-site isn't relevant to the question. We have to keep stepping up the call stack until we find a function invocation that <em>is</em> <code>this</code>-assigning -- even if such invoked function is not itself <code>this</code>-aware.</p>
<p><strong>THAT</strong> is the only call-site that matters.</p>
<h4 id="find-the-right-call-site">Find The Right Call-Site<a class="headerlink" href="#find-the-right-call-site" title="Permanent link">¶</a></h4>
<p>Let me illustrate, with a convoluted mess of a bunch of nested functions/calls:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="nb">globalThis</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">result</span><span class="o">:</span><span class="w"> </span><span class="s2">"Sad face"</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a>
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="kd">function</span><span class="w"> </span><span class="nx">one</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">two</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">three</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="w">            </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">result</span><span class="o">:</span><span class="w"> </span><span class="s2">"Hmmm"</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a>
<a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="w">            </span><span class="nx">fn</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">four</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">four</span><span class="p">.</span><span class="nx">call</span><span class="p">({</span>
<a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">                    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">result</span><span class="o">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="p">,</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-29-12" id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">                </span><span class="p">});</span>
<a href="#__codelineno-29-13" id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="w">            </span><span class="p">},</span>
<a href="#__codelineno-29-14" id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">        </span><span class="p">};</span>
<a href="#__codelineno-29-15" id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">three</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>
<a href="#__codelineno-29-16" id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-29-17" id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">two</span><span class="p">();</span>
<a href="#__codelineno-29-18" id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="p">}</span>
<a href="#__codelineno-29-19" id="__codelineno-29-19" name="__codelineno-29-19"></a>
<a href="#__codelineno-29-20" id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="ow">new</span><span class="w"> </span><span class="nx">one</span><span class="p">();</span><span class="w">          </span><span class="c1">// ???</span>
</code></pre></div>
<p>Can you run through that (nightmare) in your head and determine what will be returned from the <code>new one()</code> invocation?</p>
<p>It could be any of these:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1">// from `four.call(..)`:</span>
<a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="p">{</span><span class="w"> </span><span class="nx">result</span><span class="o">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a>
<a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="c1">// or, from `three` object:</span>
<a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="p">{</span><span class="w"> </span><span class="nx">result</span><span class="o">:</span><span class="w"> </span><span class="s2">"Hmmm"</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a>
<a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="c1">// or, from the `globalThis.value`:</span>
<a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="p">{</span><span class="w"> </span><span class="nx">result</span><span class="o">:</span><span class="w"> </span><span class="s2">"Sad face"</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a>
<a href="#__codelineno-30-10" id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="c1">// or, empty object from the `new` call:</span>
<a href="#__codelineno-30-11" id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="p">{}</span>
</code></pre></div>
<p>The call-stack for that <code>new one()</code> invocation is:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a>four         |
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>three.fn     |
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a>two          | (this = globalThis)
<a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a>one          | (this = {})
<a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a>[ global ]   | (this = globalThis)
</code></pre></div>
<p>Since <code>four()</code> and <code>fn()</code> are both <code>=&gt;</code> arrow functions, the <code>three.fn()</code> and <code>four.call(..)</code> call-sites are not <code>this</code>-assigning; thus, they're irrelvant for our query. What's the next invocation to consider in the call-stack? <code>two()</code>. That's a regular function (it can accept <code>this</code>-assignment), and the call-site matches the <em>default context</em> assignment rule (#4). Since we're not in strict-mode, <code>this</code> is assigned <code>globalThis</code>.</p>
<p>When <code>four()</code> is running, <code>this</code> is just a normal variable. It looks then to its containing function (<code>three.fn()</code>), but it again finds a function with no <code>this</code>. So it goes up another level, and finds a <code>two()</code> <em>regular</em> function that has a <code>this</code> defined. And that <code>this</code> is <code>globalThis</code>. So the <code>this.value</code> expression resolves to <code>globalThis.value</code>, which returns us... <code>{ result: "Sad face" }</code>.</p>
<p>...</p>
<p>Take a deep breath. I know that's a lot to mentally process. And in fairness, that's a super contrived example. You'll almost never see all that complexity mixed in one call-stack.</p>
<p>But you absolutely will find mixed call-stacks in real programs. You need to get comfortable with the analysis I just illustrated, to be able to unwind the call-stack until you find the most recent <code>this</code>-assigning call-site.</p>
<p>Remember the addage I quoted earlier: "with great power comes great responsibility". Choosing <code>this</code>-oriented code (even <code>class</code>es) means choosing both the flexibility it affords us, as well as needing to be comfortable navigating the call-stack to understand how it will behave.</p>
<p>That's the only way to effectively write (and later read!) <code>this</code>-aware code.</p>
<h3 id="this-is-bound-to-come-up">This Is Bound To Come Up<a class="headerlink" href="#this-is-bound-to-come-up" title="Permanent link">¶</a></h3>
<p>Backing up a bit, there's another option if you don't want to use an <code>=&gt;</code> arrow function's "LEXICAL this" behavior to address the button event handler functionality.</p>
<p>In addition to <code>call(..)</code> / <code>apply(..)</code> -- these invoke functions, remember! -- JS functions also have a third utility built in, called <code>bind(..)</code> -- which does <em>not</em> invoke the function, just to be clear.</p>
<p>The <code>bind(..)</code> utility defines a <em>new</em> wrapped/bound version of a function, where its <code>this</code> is preset and fixed, and cannot be overridden with a <code>call(..)</code> or <code>apply(..)</code>, or even an <em>implicit context</em> object at the call-site:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">submitBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">    </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
<a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">    </span><span class="kc">false</span>
<a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="p">);</span>
</code></pre></div>
<p>Since I'm passing in a <code>this</code>-bound function as the event handler, it similarly doesn't matter how that utility tries to set a <code>this</code>, because I've already forced the <code>this</code> to be what I wanted: the value of <code>this</code> from the surrounding function invocation context.</p>
<h4 id="hardly-new">Hardly New<a class="headerlink" href="#hardly-new" title="Permanent link">¶</a></h4>
<p>This pattern is often referred to as "hard binding", since we're creating a function reference that is strongly bound to a particular <code>this</code>. A lot of JS writings have claimed that the <code>=&gt;</code> arrow function is essentially just syntax for the <code>bind(this)</code> hard-binding. It's not. Let's dig in.</p>
<p>If you were going to create a <code>bind(..)</code> utility, it might look kinda like <em>this</em>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">bind</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span><span class="nx">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">bound</span><span class="p">(...</span><span class="nx">args</span><span class="p">){</span>
<a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span><span class="nx">args</span><span class="p">);</span>
<a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="p">}</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">This is not actually how <code>bind(..)</code> is implemented. The behavior is more sophisticated and nuanced. I'm only illustrating one portion of its behavior in this snippet.</td>
</tr>
</tbody>
</table>
<p>Does that look familiar? It's using the good ol' fake "LEXICAL this" hack. And under the covers, it's an <em>explicit context</em> assignment, in this case via <code>apply(..)</code>.</p>
<p>So wait... doesn't that mean we could just do it with an <code>=&gt;</code> arrow function?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">bind</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span><span class="nx">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span><span class="nx">args</span><span class="p">);</span>
<a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="p">}</span>
</code></pre></div>
<p>Eh... not quite. As with most things in JS, there's a bit of nuance. Let me illustrate:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1">// candidate implementation, for comparison</span>
<a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="kd">function</span><span class="w"> </span><span class="nx">fakeBind</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span><span class="nx">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span><span class="nx">args</span><span class="p">);</span>
<a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="p">}</span>
<a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a>
<a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="c1">// test subject</span>
<a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="kd">function</span><span class="w"> </span><span class="nx">thisAwareFn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Value: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="p">}</span>
<a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a>
<a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="c1">// control data</span>
<a href="#__codelineno-35-12" id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="kd">var</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-35-13" id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="w">    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="mf">42</span><span class="p">,</span>
<a href="#__codelineno-35-14" id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="p">};</span>
<a href="#__codelineno-35-15" id="__codelineno-35-15" name="__codelineno-35-15"></a>
<a href="#__codelineno-35-16" id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="c1">// experiment</span>
<a href="#__codelineno-35-17" id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">thisAwareFn</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<a href="#__codelineno-35-18" id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="kd">var</span><span class="w"> </span><span class="nx">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fakeBind</span><span class="p">(</span><span class="nx">thisAwareFn</span><span class="p">,</span><span class="nx">obj</span><span class="p">);</span>
<a href="#__codelineno-35-19" id="__codelineno-35-19" name="__codelineno-35-19"></a>
<a href="#__codelineno-35-20" id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="nx">f</span><span class="p">();</span><span class="w">            </span><span class="c1">// Value: 42</span>
<a href="#__codelineno-35-21" id="__codelineno-35-21" name="__codelineno-35-21"></a><span class="nx">g</span><span class="p">();</span><span class="w">            </span><span class="c1">// Value: 42</span>
<a href="#__codelineno-35-22" id="__codelineno-35-22" name="__codelineno-35-22"></a>
<a href="#__codelineno-35-23" id="__codelineno-35-23" name="__codelineno-35-23"></a><span class="ow">new</span><span class="w"> </span><span class="nx">f</span><span class="p">();</span><span class="w">        </span><span class="c1">// Value: undefined</span>
<a href="#__codelineno-35-24" id="__codelineno-35-24" name="__codelineno-35-24"></a><span class="ow">new</span><span class="w"> </span><span class="nx">g</span><span class="p">();</span><span class="w">        </span><span class="c1">// &lt;--- ???</span>
</code></pre></div>
<p>First, look at the <code>new f()</code> call. That's admittedly a strange usage, to call <code>new</code> on a hard-bound function. It's probably quite rare that you'd ever do so. But it shows something kind of interesting. Even though <code>f()</code> was hard-bound to a <code>this</code> context of <code>obj</code>, the <code>new</code> operator was able to hijack the hard-bound function's <code>this</code> and re-bind it to the newly created and empty object. That object has no <code>value</code> property, which is why we see <code>"Value: undefined"</code> printed out.</p>
<p>If that feels strange, I agree. It's a weird corner nuance. It's not something you'd likely ever exploit. But I point it out not just for trivia. Refer back to the four rules presented earlier in this chapter. Remember how I asserted their order-of-precedence, and <code>new</code> was at the top (#1), ahead of <em>explicit</em> <code>call(..)</code> / <code>apply(..)</code> assignment rule (#2)?</p>
<p>Since we can sort of think of <code>bind(..)</code> as a variation of that rule, we now see that order-of-precedence proven. <code>new</code> is more precedent than, and can override, even a hard-bound function. Sort of makes you think the hard-bound function is maybe not so "hard"-bound, huh?!</p>
<p>But... what's going to happen with the <code>new g()</code> call, which is invoking <code>new</code> on the returned <code>=&gt;</code> arrow function? Do you predict the same outcome as <code>new f()</code>?</p>
<p>Sorry to disappoint.</p>
<p>That line will actually throw an exception, because an <code>=&gt;</code> function cannot be used with the <code>new</code> keyword.</p>
<p>But why? My best answer, not being authoritative on TC39 myself, is that conceptually and actually, an <code>=&gt;</code> arrow function is not a function with a hard-bound <code>this</code>, it's a function that has no <code>this</code> at all. As such, <code>new</code> makes no sense against such a function, so JS just disallows it.</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Recall earlier, when I pointed out that <code>=&gt;</code> arrow functions have <code>call(..)</code>, <code>apply(..)</code>, and indeed even a <code>bind(..)</code>. But we've see that such functions basically ignore these utilities as no-ops. It's a bit strange, in my opinion, that <code>=&gt;</code> arrow functions have all those utilties as pass-through no-ops, but for the <code>new</code> keyword, that's not just, again, a no-op pass-through, but rather disallowed with an exception.</td>
</tr>
</tbody>
</table>
<p>But the main point is: an <code>=&gt;</code> arrow function is <em>not</em> a syntactic form of <code>bind(this)</code>.</p>
<h3 id="losing-this-battle">Losing This Battle<a class="headerlink" href="#losing-this-battle" title="Permanent link">¶</a></h3>
<p>Returning once again to our button event handler example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">submitBtnaddEventListener</span><span class="p">(</span>
<a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="w">    </span><span class="s2">"click"</span><span class="p">,</span>
<a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">clickHandler</span><span class="p">,</span>
<a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">    </span><span class="kc">false</span>
<a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="p">);</span>
</code></pre></div>
<p>There's a deeper concern we haven't yet addressed.</p>
<p>We've seen several different approaches to construct a different callback function reference to pass in there, in place of <code>this.clickHandler</code>.</p>
<p>But whichever of those ways we choose, they are producing literally a different function, not just an in-place modification to our existing <code>clickHandler</code> function.</p>
<p>Why does that matter?</p>
<p>Well, first of all, the more functions we create (and re-create), the more processing time (very slight) and the more memory (pretty small, usually) we're chewing up. And when we're re-creating a function reference, and throwing an old one away, that's also leaving un-reclaimed memory sitting around, which puts pressure on the garbage collector (GC) to more often, pause the universe of our program momentarily while it cleans up and reclaims that memory.</p>
<p>If hooking up this event listening is a one-time operation, no big deal. But if it's happening over and over again, the system-level performance effects <em>can</em> start to add up. Ever had an otherwise smooth animation jitter? That was probably the GC kicking in, cleaning up a bunch of reclaimable memory.</p>
<p>But another concern is, for things like event handlers, if we're going to remove an event listener at some later time, we need to keep a reference to the exact same function we attached originally. If we're using a library/framework, often (but not always!) they take care of that little dirty-work detail for you. But otherwise, it's on us to make sure that whatever function we plan to attach, we hold onto a reference just in case we need it later.</p>
<p>So the point I'm making is: presetting a <code>this</code> assignment, no matter how you do it, so that it's predictable, comes with a cost. A system level cost and a program maintenance/complexity cost. It is <em>never</em> free.</p>
<p>One way of reacting to that fact is to decide, OK, we're just going to manufacture all those <code>this</code>-assigned function references once, ahead of time, up-front. That way, we're sure to reduce both the system pressure, and the code pressure, to a minimum.</p>
<p>Sounds reasonable, right? Not so fast.</p>
<h4 id="pre-binding-function-contexts">Pre-Binding Function Contexts<a class="headerlink" href="#pre-binding-function-contexts" title="Permanent link">¶</a></h4>
<p>If you have a one-off function reference that needs to be <code>this</code>-bound, and you use an <code>=&gt;</code> arrow or a <code>bind(this)</code> call, I don't see any problems with that.</p>
<p>But if most or all of the <code>this</code>-aware functions in a segment of your code invoked in ways where the <code>this</code> isn't the predictable context you expect, and so you decide you need to hard-bind them all... I think that's a big warning signal that you're going about things the wrong way.</p>
<p>Please recall the discussion in the "Avoid This" section from Chapter 3, which started with this snippet of code:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="kd">class</span><span class="w"> </span><span class="nx">Point2d</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w">    </span><span class="nx">getDoubleX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span>
<a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a>
<a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-37-9" id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="w">    </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-37-10" id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="p">}</span>
<a href="#__codelineno-37-11" id="__codelineno-37-11" name="__codelineno-37-11"></a>
<a href="#__codelineno-37-12" id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point2d</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
</code></pre></div>
<p>Now imagine we did this with that code:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">getX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">getDoubleX</span><span class="p">;</span>
<a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a>
<a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="c1">// later, elsewhere</span>
<a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a>
<a href="#__codelineno-38-5" id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="nx">getX</span><span class="p">();</span><span class="w">         </span><span class="c1">// 6</span>
</code></pre></div>
<p>As you can see, the problem we were trying to solve is the same as we've been dealing with here in this chapter. It's that we wanted to be able to invoke a function reference like <code>getX()</code>, and have that <em>mean</em> and <em>behave like</em> <code>point.getDoubleX()</code>. But <code>this</code> rules on <em>regular</em> functions don't work that way.</p>
<p>So we used an <code>=&gt;</code> arrow function. No big deal, right!?</p>
<p>Wrong.</p>
<p>The real root problem is that we <em>want</em> two conflicting things out of our code, and we're trying to use the same <em>hammer</em> for both <em>nails</em>.</p>
<p>We want to have a <code>this</code>-aware method stored on the <code>class</code> prototype, so that there's only one definition for the function, and all our subclasses and instances nicely share that same function. And the way they all share is through the power of the dynamic <code>this</code> binding.</p>
<p>But at the same time, we <em>also</em> want those function references to magically stay <code>this</code>-assinged to our instance when we pass those function references around and other code is in charge of the call-site.</p>
<p>In other words, sometimes we want something like <code>point.getDoubleX</code> to mean, "give me a reference that's <code>this</code>-assigned to <code>point</code>", and other times we want the same expression <code>point.getDoubleX</code> to mean, give me a dynamic <code>this</code>-assignable function reference so it can properly get the context I need it to at this moment.</p>
<p>Perhaps JS could offer a different operator besides <code>.</code>, like <code>::</code> or <code>-&gt;</code> or something like that, which would let you distinguish what kind of function reference you're after. In fact, there's a long-standing proposal for a <code>this</code>-binding operator (<code>::</code>), that picks up attention from time to time, and then seems to stall out. Who knows, maybe someday such an operator will finally land, and we'll have better options.</p>
<p>But I strongly suspect that even if it does land someday, it's going to vend a whole new function reference, exactly as the <code>=&gt;</code> or <code>bind(this)</code> approaches we've already talked about. It won't come as a free and perfect solution. There will always be a tension between wanting the same function to sometimes be <code>this</code>-flexible and sometimes be <code>this</code>-predictable.</p>
<p>What JS authors of <code>class</code>-oriented code often run up against, sooner or later, is this exact tension. And you know what they do?</p>
<p>They don't consider the <em>costs</em> of simply pre-binding all the class's <code>this</code>-aware methods as instead <code>=&gt;</code> arrow functions in member properties. They don't realize that it's completely defeated the entire purpose of the <code>[[Prototype]]</code> chain. And they don't realize that if fixed-context is what they <em>really need</em>, there's an entirely different mechanism in JS that is better suited for that purpose.</p>
<h4 id="take-a-more-critical-look">Take A More Critical Look<a class="headerlink" href="#take-a-more-critical-look" title="Permanent link">¶</a></h4>
<p>So when you do this sort of thing:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="kd">class</span><span class="w"> </span><span class="nx">Point2d</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">    </span><span class="nx">getDoubleX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span>
<a href="#__codelineno-39-5" id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">    </span><span class="nx">toString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`(</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">,</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">)`</span>
<a href="#__codelineno-39-6" id="__codelineno-39-6" name="__codelineno-39-6"></a>
<a href="#__codelineno-39-7" id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-39-8" id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<a href="#__codelineno-39-9" id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<a href="#__codelineno-39-10" id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-39-11" id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="p">}</span>
<a href="#__codelineno-39-12" id="__codelineno-39-12" name="__codelineno-39-12"></a>
<a href="#__codelineno-39-13" id="__codelineno-39-13" name="__codelineno-39-13"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point2d</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
<a href="#__codelineno-39-14" id="__codelineno-39-14" name="__codelineno-39-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point2d</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">);</span>
<a href="#__codelineno-39-15" id="__codelineno-39-15" name="__codelineno-39-15"></a>
<a href="#__codelineno-39-16" id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">getDoubleX</span><span class="p">;</span>
<a href="#__codelineno-39-17" id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="kd">var</span><span class="w"> </span><span class="nx">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>
<a href="#__codelineno-39-18" id="__codelineno-39-18" name="__codelineno-39-18"></a>
<a href="#__codelineno-39-19" id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="nx">f</span><span class="p">();</span><span class="w">            </span><span class="c1">// 6</span>
<a href="#__codelineno-39-20" id="__codelineno-39-20" name="__codelineno-39-20"></a><span class="nx">g</span><span class="p">();</span><span class="w">            </span><span class="c1">// (5,6)</span>
</code></pre></div>
<p>I say, "ick!", to the hard-bound <code>this</code>-aware methods <code>getDoubleX()</code> and <code>toString()</code> there. To me, that's a code smell. But here's an even <em>worse</em> approach that has been favored by many developers in the past:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="kd">class</span><span class="w"> </span><span class="nx">Point2d</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a>
<a href="#__codelineno-40-5" id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-40-6" id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<a href="#__codelineno-40-7" id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<a href="#__codelineno-40-8" id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">getDoubleX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getDoubleX</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a href="#__codelineno-40-9" id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a href="#__codelineno-40-10" id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-40-11" id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="w">    </span><span class="nx">getDoubleX</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-40-12" id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="w">    </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`(</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">,</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-40-13" id="__codelineno-40-13" name="__codelineno-40-13"></a><span class="p">}</span>
<a href="#__codelineno-40-14" id="__codelineno-40-14" name="__codelineno-40-14"></a>
<a href="#__codelineno-40-15" id="__codelineno-40-15" name="__codelineno-40-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point2d</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
<a href="#__codelineno-40-16" id="__codelineno-40-16" name="__codelineno-40-16"></a><span class="kd">var</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Point2d</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">);</span>
<a href="#__codelineno-40-17" id="__codelineno-40-17" name="__codelineno-40-17"></a>
<a href="#__codelineno-40-18" id="__codelineno-40-18" name="__codelineno-40-18"></a><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">getDoubleX</span><span class="p">;</span>
<a href="#__codelineno-40-19" id="__codelineno-40-19" name="__codelineno-40-19"></a><span class="kd">var</span><span class="w"> </span><span class="nx">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>
<a href="#__codelineno-40-20" id="__codelineno-40-20" name="__codelineno-40-20"></a>
<a href="#__codelineno-40-21" id="__codelineno-40-21" name="__codelineno-40-21"></a><span class="nx">f</span><span class="p">();</span><span class="w">            </span><span class="c1">// 6</span>
<a href="#__codelineno-40-22" id="__codelineno-40-22" name="__codelineno-40-22"></a><span class="nx">g</span><span class="p">();</span><span class="w">            </span><span class="c1">// (5,6)</span>
</code></pre></div>
<p>Double ick.</p>
<p>In both cases, you're using a <code>this</code> mechanism but completely betraying/neutering it, by taking away all the powerful dynamicism of <code>this</code>.</p>
<p>You really should at least be contemplating this alternate approach, which skips the whole <code>this</code> mechanism altogether:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">Point2d</span><span class="p">(</span><span class="nx">px</span><span class="p">,</span><span class="nx">py</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">px</span><span class="p">;</span>
<a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">py</span><span class="p">;</span>
<a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a>
<a href="#__codelineno-41-5" id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-41-6" id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">        </span><span class="nx">getDoubleX</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-41-7" id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">        </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="sb">`(</span><span class="si">${</span><span class="nx">x</span><span class="si">}</span><span class="sb">,</span><span class="si">${</span><span class="nx">y</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-41-8" id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-41-9" id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="p">}</span>
<a href="#__codelineno-41-10" id="__codelineno-41-10" name="__codelineno-41-10"></a>
<a href="#__codelineno-41-11" id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Point2d</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
<a href="#__codelineno-41-12" id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="kd">var</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Point2d</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">);</span>
<a href="#__codelineno-41-13" id="__codelineno-41-13" name="__codelineno-41-13"></a>
<a href="#__codelineno-41-14" id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">getDoubleX</span><span class="p">;</span>
<a href="#__codelineno-41-15" id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">anotherPoint</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>
<a href="#__codelineno-41-16" id="__codelineno-41-16" name="__codelineno-41-16"></a>
<a href="#__codelineno-41-17" id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="nx">f</span><span class="p">();</span><span class="w">            </span><span class="c1">// 6</span>
<a href="#__codelineno-41-18" id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="nx">g</span><span class="p">();</span><span class="w">            </span><span class="c1">// (5,6)</span>
</code></pre></div>
<p>You see? No ugly or complex <code>this</code> to clutter up that code or worry about corner cases for. Lexical scope is super straightforward and intuitive.</p>
<p>When all we want is for most/all of our function behaviors to have a fixed and predictable context, the most appropriate solution, the most straightfoward and even performant solution, is LEXICAL variables and scope closure.</p>
<p>When you go to all to the trouble of sprinkling <code>this</code> references all over a piece of code, and then you cut off the whole mechanism at the knees with <code>=&gt;</code> "LEXICAL this" or <code>bind(this)</code>, you chose to make the code more verbose, more complex, more overwrought. And you got nothing out of it that was more beneficial, except to follow the <code>this</code> (and <code>class</code>) bandwagon.</p>
<p>...</p>
<p>Deep breath. Collect yourself.</p>
<p>I'm talking to myself, not you. But if what I just said bothers you, I'm talking to you, too!</p>
<p>OK, listen. That's just my opinion. If you don't agree, that's fine. But apply the same level of rigor to thinking about how these mechanisms work, as I have, when you decide what conclusions you want to arrive at.</p>
<h2 id="variations">Variations<a class="headerlink" href="#variations" title="Permanent link">¶</a></h2>
<p>Before we close out our lengthy discussion of <code>this</code>, there's a few irregular variations on function calls that we should discuss.</p>
<h3 id="indirect-function-calls">Indirect Function Calls<a class="headerlink" href="#indirect-function-calls" title="Permanent link">¶</a></h3>
<p>Recall this example from earlier in the chapter?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="w">    </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">    </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a>
<a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">    </span><span class="nx">init</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span>
<a href="#__codelineno-42-8" id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-42-9" id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="w">    </span><span class="nx">rotate</span><span class="p">(</span><span class="nx">angleRadians</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-42-10" id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="w">    </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-42-11" id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="p">};</span>
<a href="#__codelineno-42-12" id="__codelineno-42-12" name="__codelineno-42-12"></a>
<a href="#__codelineno-42-13" id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="kd">var</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">;</span>
<a href="#__codelineno-42-14" id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="nx">init</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span><span class="w">                  </span><span class="c1">// broken!</span>
</code></pre></div>
<p>This is broken because the <code>init(3,4)</code> call-site doesn't provide the necessary <code>this</code>-assignment signal. But there's other ways to observe a similar breakage. For example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">)(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span><span class="w">        </span><span class="c1">// broken!</span>
</code></pre></div>
<p>This strange looking syntax is first evaluating an expression <code>(1,point.init)</code>, which is a comma series expression. The result of such an expression is the final evaluated value, which in this case is the function reference (held by <code>point.init</code>).</p>
<p>So the outcome puts that function reference onto the expression stack, and then invokes that value with <code>(3,4)</code>. That's an indirect invocation of the function. And what's the result? It actually matches the <em>default context</em> assignment rule (#4) we looked at earlier in the chapter.</p>
<p>Thus, in non-strict mode, the <code>this</code> for the <code>point.init(..)</code> call will be <code>globalThis</code>. Had we been in strict-mode, it would have been <code>undefined</code>, and the <code>this.x = x</code> operation would then have thrown an exception for invalidly accessing the <code>x</code> property on the <code>undefined</code> value.</p>
<p>There's several different ways to get an indirect function invocation. For example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="p">(()=&gt;</span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">)()(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span><span class="w">    </span><span class="c1">// broken!</span>
</code></pre></div>
<p>And another example of indirect function invocation is the Immediately Invoked Function Expression (IIFE) pattern:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">    </span><span class="c1">// `this` assigned via "default" rule</span>
<a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="p">})();</span>
</code></pre></div>
<p>As you can see, the function expression value is put onto the expression stack, and then it's invoked with the <code>()</code> on the end.</p>
<p>But what about this code:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">init</span><span class="p">)(</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span>
</code></pre></div>
<p>What will be the outcome of that code?</p>
<p>By the same reasoning we've seen in the previous examples, it stands to reason that the <code>point.init</code> expression puts the function value onto the expression stack, and then invoked indirectly with <code>(3,4)</code>.</p>
<p>Not quite, though! JS grammar has a special rule to handle the invocation form <code>(someIdentifier)(..)</code> as if it had been <code>someIdentifier(..)</code> (without the <code>(..)</code> around the identifier name).</p>
<p>Wondering why you might want to ever force the <em>default context</em> for <code>this</code> assignment via an indirect function invocation?</p>
<h3 id="accessing-globalthis">Accessing <code>globalThis</code><a class="headerlink" href="#accessing-globalthis" title="Permanent link">¶</a></h3>
<p>Before we answer that, let's introduce another way of performing indirect function <code>this</code> assignment. Thus far, the indirect function invocation patterns shown are sensitive to strict-mode. But what if we wanted an indirect function <code>this</code> assignment that doesn't respect strict-mode.</p>
<p>The <code>Function(..)</code> constructor takes a string of code and dynamically defines the equivalent function. However, it always does so as if that function had been declared in the global scope. And furthermore, it ensures such function <em>does not</em> run in strict-mode, no matter the strict-mode status of the program. That's the same outcome as running an indirect</p>
<p>One niche usage of such strict-mode agnostic indirect function <code>this</code> assignment is for getting a reliable reference to the true global object prior to when the JS specification actually defined the <code>globalThis</code> identifier (for example, in a polyfill for it):</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="s2">"use strict"</span><span class="p">;</span>
<a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a>
<a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">gt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Function</span><span class="p">(</span><span class="s2">"return this"</span><span class="p">)();</span>
<a href="#__codelineno-47-4" id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="nx">gt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">globalThis</span><span class="p">;</span><span class="w">                      </span><span class="c1">// true</span>
</code></pre></div>
<p>In fact, a similar outcome, using the comma operator trick (see previous section) and <code>eval(..)</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="s2">"use strict"</span><span class="p">;</span>
<a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a>
<a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getGlobalThis</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="nb">eval</span><span class="p">)(</span><span class="s2">"this"</span><span class="p">);</span>
<a href="#__codelineno-48-5" id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="p">}</span>
<a href="#__codelineno-48-6" id="__codelineno-48-6" name="__codelineno-48-6"></a>
<a href="#__codelineno-48-7" id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="nx">getGlobalThis</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">globalThis</span><span class="p">;</span><span class="w">      </span><span class="c1">// true</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>eval("this")</code> would be sensitive to strict-mode, but <code>(1,eval)("this")</code> is not, and therefor reliably gives us the <code>globalThis</code> in any program.</td>
</tr>
</tbody>
</table>
<p>Unfortunately, the <code>new Function(..)</code> and <code>(1,eval)(..)</code> approaches both have an important limitation: that code will be blocked in browser-based JS code if the app is served with certain Content-Security-Policy (CSP) restrictions, disallowing dynamic code evaluation (for security reasons).</p>
<p>Can we get around this? Yes, mostly. <sup id="fnref:globalThisPolyfill"><a class="footnote-ref" href="#fn:globalThisPolyfill">1</a></sup></p>
<p>The JS specification says that a getter function defined on the global object, or on any object that inherits from it (like <code>Object.prototype</code>), runs the getter function with <code>this</code> context assigned to <code>globalThis</code>, regardless of the program's strict-mode.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c1">// Adapted from: https://mathiasbynens.be/notes/globalthis#robust-polyfill</span>
<a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getGlobalThis</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-49-3" id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="w">    </span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="s2">"__get_globalthis__"</span><span class="p">,{</span>
<a href="#__codelineno-49-4" id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">        </span><span class="nx">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-49-5" id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="w">        </span><span class="nx">configurable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<a href="#__codelineno-49-6" id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="w">    </span><span class="p">});</span>
<a href="#__codelineno-49-7" id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">gt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">__get_globalthis__</span><span class="p">;</span>
<a href="#__codelineno-49-8" id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="w">    </span><span class="ow">delete</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__get_globalthis__</span><span class="p">;</span>
<a href="#__codelineno-49-9" id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">gt</span><span class="p">;</span>
<a href="#__codelineno-49-10" id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="p">}</span>
<a href="#__codelineno-49-11" id="__codelineno-49-11" name="__codelineno-49-11"></a>
<a href="#__codelineno-49-12" id="__codelineno-49-12" name="__codelineno-49-12"></a><span class="nx">getGlobalThis</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">globalThis</span><span class="p">;</span><span class="w">      </span><span class="c1">// true</span>
</code></pre></div>
<p>Yeah, that's super gnarly. But that's JS <code>this</code> for you!</p>
<h3 id="template-tag-functions">Template Tag Functions<a class="headerlink" href="#template-tag-functions" title="Permanent link">¶</a></h3>
<p>There's one more unusual variation of function invocation we should cover: tagged template functions.</p>
<p>Template strings -- what I prefer to call interpolated literals -- can be "tagged" with a prefix function, which is invoked with the parsed contents of the template literal:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">tagFn</span><span class="p">(</span><span class="cm">/* .. */</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-50-3" id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="p">}</span>
<a href="#__codelineno-50-4" id="__codelineno-50-4" name="__codelineno-50-4"></a>
<a href="#__codelineno-50-5" id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="nx">tagFn</span><span class="sb">`actually a function invocation!`</span><span class="p">;</span>
</code></pre></div>
<p>As you can see, there's no <code>(..)</code> invocation syntax, just the tag function (<code>tagFn</code>) appearing before the <code>`template literal`</code>; whitespace is allowed between them, but is very uncommon.</p>
<p>Despite the strange appearance, the function <code>tagFn(..)</code> will be invoked. It's passed the list of one or more string literals that were parsed from the template literal, along with any interpolated expression values that were encountered.</p>
<p>We're not going to cover all the ins and outs of tagged template functions -- they're seriously one of the most powerful and interesting features ever added to JS -- but since we're talking about <code>this</code> assignment in function invocations, for completeness sake we need to talk about how <code>this</code> will be assigned.</p>
<p>The other form for tag functions you may encounter is:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">someObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="w">    </span><span class="nx">tagFn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* .. */</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-51-3" id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="p">};</span>
<a href="#__codelineno-51-4" id="__codelineno-51-4" name="__codelineno-51-4"></a>
<a href="#__codelineno-51-5" id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="nx">someObj</span><span class="p">.</span><span class="nx">tagFn</span><span class="sb">`also a function invocation!`</span><span class="p">;</span>
</code></pre></div>
<p>Here's the easy explanation: <code>tagFn`..`</code> and <code>someObj.tagFn`..`</code> will each have <code>this</code>-assignment behavior corresponding to call-sites as <code>tagFn(..)</code> and <code>someObj.tagFn(..)</code>, respectively. In other words, <code>tagFn`..`</code> behaves by the <em>default context</em> assignment rule (#4), and <code>someObj.tagFn`..`</code> behaves by the <em>implicit context</em> assignment rule (#3).</p>
<p>Luckily for us, we don't need to worry about the <code>new</code> or <code>call(..)</code> / <code>apply(..)</code> assignment rules, as those forms aren't possible with tag functions.</p>
<p>It should be pointed out that it's pretty rare for a tagged template literal function to be defined as <code>this</code>-aware, so it's fairly unlikely you'll need to apply these rules. But just in case, now you're in the <em>know</em>.</p>
<h2 id="stay-aware">Stay Aware<a class="headerlink" href="#stay-aware" title="Permanent link">¶</a></h2>
<p>So, that's <code>this</code>. I'm willing to bet for many of you, it was a bit more... shall we say, involved... than you might have been expecting.</p>
<p>The good news, perhaps, is that in practice you don't often trip over all these different complexities. But the more you use <code>this</code>, the more it requires you, and the readers of your code, to understand how it actually works.</p>
<p>The lesson here is that you should be intentional and aware of all aspects of <code>this</code> before you go sprinkling it about your code. Make sure you're using it most effectively and taking full advantage of this important pillar of JS.</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:globalThisPolyfill">
<p>"A horrifying globalThis polyfill in universal JavaScript"; Mathias Bynens; April 18 2019; https://mathiasbynens.be/notes/globalthis#robust-polyfill ; Accessed July 2022 <a class="footnote-backref" href="#fnref:globalThisPolyfill" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
<script async="" crossorigin="anonymous" data-category="General" data-category-id="DIC_kwDOKciK6s4CZ5Xs" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-mapping="pathname" data-reactions-enabled="1" data-repo="shane0/learning_js" data-repo-id="R_kgDOKciK6g" data-strict="0" data-theme="noborder_dark" src="https://giscus.app/client.js">
</script>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Chapter 3: Classy Objects" class="md-footer__link md-footer__link--prev" href="../ch3/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                  Previous
                </span>
                Chapter 3: Classy Objects
              </div>
</div>
</a>
<a aria-label="Next: Chapter 5: Delegation" class="md-footer__link md-footer__link--next" href="../ch5/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                  Next
                </span>
                Chapter 5: Delegation
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://shanenull.com/" rel="noopener" target="_blank" title="shanenull.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M256 8C119.3 8 8 119.2 8 256c0 136.7 111.3 248 248 248s248-111.3 248-248C504 119.2 392.7 8 256 8zM33 256c0-32.3 6.9-63 19.3-90.7l106.4 291.4C84.3 420.5 33 344.2 33 256zm223 223c-21.9 0-43-3.2-63-9.1l66.9-194.4 68.5 187.8c.5 1.1 1 2.1 1.6 3.1-23.1 8.1-48 12.6-74 12.6zm30.7-327.5c13.4-.7 25.5-2.1 25.5-2.1 12-1.4 10.6-19.1-1.4-18.4 0 0-36.1 2.8-59.4 2.8-21.9 0-58.7-2.8-58.7-2.8-12-.7-13.4 17.7-1.4 18.4 0 0 11.4 1.4 23.4 2.1l34.7 95.2L200.6 393l-81.2-241.5c13.4-.7 25.5-2.1 25.5-2.1 12-1.4 10.6-19.1-1.4-18.4 0 0-36.1 2.8-59.4 2.8-4.2 0-9.1-.1-14.4-.3C109.6 73 178.1 33 256 33c58 0 110.9 22.2 150.6 58.5-1-.1-1.9-.2-2.9-.2-21.9 0-37.4 19.1-37.4 39.6 0 18.4 10.6 33.9 21.9 52.3 8.5 14.8 18.4 33.9 18.4 61.5 0 19.1-7.3 41.2-17 72.1l-22.2 74.3-80.7-239.6zm81.4 297.2 68.1-196.9c12.7-31.8 17-57.2 17-79.9 0-8.2-.5-15.8-1.5-22.9 17.4 31.8 27.3 68.2 27.3 107 0 82.3-44.6 154.1-110.9 192.7z"></path></svg>
</a>
<a class="md-social__link" href="https://shane0.pythonanywhere.com/" rel="noopener" target="_blank" title="shane0.pythonanywhere.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"></path></svg>
</a>
<a class="md-social__link" href="http://www.youtube.com/c/ShaneNull" rel="noopener" target="_blank" title="www.youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg>
</a>
<a class="md-social__link" href="https://www.instagram.com/nullshane/" rel="noopener" target="_blank" title="www.instagram.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg>
</a>
<a class="md-social__link" href="https://earmassagetherapist.bandcamp.com/releases" rel="noopener" target="_blank" title="earmassagetherapist.bandcamp.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8Zm48.2 326.1h-181L207.9 178h181Z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/shane0" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://gitlab.com/shane0" rel="noopener" target="_blank" title="gitlab.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/shane_null" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/in/shanenull" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.action.edit", "content.action.view", "navigation.footer"], "search": "../../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": 2023, "provider": "mike"}}</script>
<script src="../../../assets/javascripts/bundle.51d95adb.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js?tex"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>