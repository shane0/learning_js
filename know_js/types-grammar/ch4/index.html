
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../ch3/" rel="prev"/>
<link href="../../../nucamp/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.6" name="generator"/>
<title>Chapter 4: Coercing Values - shane0 learning_js</title>
<link href="../../../assets/stylesheets/main.558e4712.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#chapter-4-coercing-values">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="shane0 learning_js" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="shane0 learning_js">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            shane0 learning_js
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Chapter 4: Coercing Values
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="shane0 learning_js" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="shane0 learning_js">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    shane0 learning_js
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../todocli/">
        todo cli
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_3" tabindex="0">
          Bujo
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Bujo" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Bujo
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../bujo/2023/">
        2023
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label aria-expanded="true" class="md-nav__link" for="__nav_4" tabindex="0">
          Know js
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Know js" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Know js
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../">
        Index
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_2" tabindex="0">
          Es next beyond
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Es next beyond" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Es next beyond
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../es-next-beyond/">
        TOC: ES.Next &amp; Beyond - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../es-next-beyond/ch1/">
        Chapter 1: TODO
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_3" tabindex="0">
          Get started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Get started" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Get started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/">
        Table of Contents
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/apA/">
        Appendix A: Exploring Further
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/apB/">
        Appendix B: Practice, Practice, Practice!
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch1/">
        Chapter 1: What *Is* JavaScript?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch2/">
        Chapter 2: Surveying JS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch3/">
        Chapter 3: Digging to the Roots of JS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../get-started/ch4/">
        Chapter 4: The Bigger Picture
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" id="__nav_4_4" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_4" tabindex="0">
          Objects classes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Objects classes" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
          Objects classes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/">
        You Don't Know JS Yet: Objects &amp; Classes - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch1/">
        Chapter 1: Object Foundations
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch2/">
        Chapter 2: How Objects Work
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch3/">
        Chapter 3: Classy Objects
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch4/">
        Chapter 4: This Works
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../objects-classes/ch5/">
        Chapter 5: Delegation
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" id="__nav_4_5" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_5" tabindex="0">
          Scope closures
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Scope closures" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
          Scope closures
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/">
        Scope &amp; Closures - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/apA/">
        Appendix A: Exploring Further
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/apB/">
        Appendix B: Practice
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch1/">
        Chapter 1: What's the Scope?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch2/">
        Chapter 2: Illustrating Lexical Scope
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch3/">
        Chapter 3: The Scope Chain
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch4/">
        Chapter 4: Around the Global Scope
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch5/">
        Chapter 5: The (Not So) Secret Lifecycle of Variables
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch6/">
        Chapter 6: Limiting Scope Exposure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch7/">
        Chapter 7: Using Closures
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/ch8/">
        Chapter 8: The Module Pattern
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/closures_bard/">
        closures bard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../scope-closures/scope_bard/">
        scope: bard version
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" id="__nav_4_6" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_4_6" tabindex="0">
          Sync async
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Sync async" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
          Sync async
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sync-async/">
        TOC: Sync &amp; Async - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sync-async/ch1/">
        Chapter 1: TODO
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7" id="__nav_4_7" type="checkbox"/>
<label aria-expanded="true" class="md-nav__link" for="__nav_4_7" tabindex="0">
          Types grammar
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Types grammar" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_7">
<span class="md-nav__icon md-icon"></span>
          Types grammar
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        TOC: Types &amp; Grammar - 2nd Edition
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch1/">
        Chapter 1: Primitive Values
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch2/">
        Chapter 2: Primitive Behaviors
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ch3/">
        Chapter 3: Object Values
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 4: Coercing Values
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Chapter 4: Coercing Values
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#coercion-explicit-vs-implicit">
    Coercion: Explicit vs Implicit
  </a>
<nav aria-label="Coercion: Explicit vs Implicit" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#implicit-bad-or">
    Implicit: Bad or ...?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#abstracts">
    Abstracts
  </a>
<nav aria-label="Abstracts" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#toboolean">
    ToBoolean
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#toprimitive">
    ToPrimitive
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tostring">
    ToString
  </a>
<nav aria-label="ToString" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#default-tostring">
    Default toString()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tonumber">
    ToNumber
  </a>
<nav aria-label="ToNumber" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#other-abstract-numeric-conversions">
    Other Abstract Numeric Conversions
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#default-valueof">
    Default valueOf()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#equality-comparison">
    Equality Comparison
  </a>
<nav aria-label="Equality Comparison" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#higher-abstracted-equality">
    Higher-Abstracted Equality
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#relational-comparison">
    Relational Comparison
  </a>
<nav aria-label="Relational Comparison" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#string-comparison">
    String Comparison
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#numeric-comparison">
    Numeric Comparison
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#concrete-coercions">
    Concrete Coercions
  </a>
<nav aria-label="Concrete Coercions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#to-boolean">
    To Boolean
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#to-string">
    To String
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#to-number">
    To Number
  </a>
<nav aria-label="To Number" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#mathematical-operations">
    Mathematical Operations
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bitwise-operations">
    Bitwise Operations
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#property-access">
    Property Access
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#to-primitive">
    To Primitive
  </a>
<nav aria-label="To Primitive" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#no-primitive-found">
    No Primitive Found?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#object-to-boolean">
    Object To Boolean
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unboxing-wrapper-to-primitive">
    Unboxing: Wrapper To Primitive
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overriding-default-tostring">
    Overriding Default toString()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overriding-toprimitive">
    Overriding ToPrimitive
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#equality">
    Equality
  </a>
<nav aria-label="Equality" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#equality-operators-vs">
    Equality Operators: == vs ===
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nullish-coercion">
    Nullish Coercion
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#boolean-gotcha">
    == Boolean Gotcha
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coercion-corner-cases">
    Coercion Corner Cases
  </a>
<nav aria-label="Coercion Corner Cases" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#strings">
    Strings
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#numbers">
    Numbers
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coercion-absurdity">
    Coercion Absurdity
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-awareness">
    Type Awareness
  </a>
<nav aria-label="Type Awareness" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#uhh-typescript">
    Uhh... TypeScript?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-awareness-without-typescript">
    Type-Awareness Without TypeScript
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-awareness-with-typescript">
    Type-Awareness With TypeScript
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#typescript-intelligence">
    TypeScript Intelligence
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-bar-above-typescript">
    The Bar Above TypeScript
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-aware-equality">
    Type Aware Equality
  </a>
<nav aria-label="Type Aware Equality" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#2-unknown-types">
    (2) Unknown Types
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-known-types">
    (1) Known Types
  </a>
<nav aria-label="(1) Known Types" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1a-known-matching-types">
    (1a) Known Matching Types
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1b-known-mismatched-types">
    (1b) Known Mismatched Types
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summarizing-type-sensitive-equality-comparison">
    Summarizing Type-Sensitive Equality Comparison
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#typescripts-inconsistency-problem">
    TypeScript's Inconsistency Problem
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#whats-left">
    What's Left?
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label aria-expanded="false" class="md-nav__link" for="__nav_5" tabindex="0">
          Nucamp
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Nucamp" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Nucamp
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../nucamp/">
        nucamp notes
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#coercion-explicit-vs-implicit">
    Coercion: Explicit vs Implicit
  </a>
<nav aria-label="Coercion: Explicit vs Implicit" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#implicit-bad-or">
    Implicit: Bad or ...?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#abstracts">
    Abstracts
  </a>
<nav aria-label="Abstracts" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#toboolean">
    ToBoolean
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#toprimitive">
    ToPrimitive
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tostring">
    ToString
  </a>
<nav aria-label="ToString" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#default-tostring">
    Default toString()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tonumber">
    ToNumber
  </a>
<nav aria-label="ToNumber" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#other-abstract-numeric-conversions">
    Other Abstract Numeric Conversions
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#default-valueof">
    Default valueOf()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#equality-comparison">
    Equality Comparison
  </a>
<nav aria-label="Equality Comparison" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#higher-abstracted-equality">
    Higher-Abstracted Equality
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#relational-comparison">
    Relational Comparison
  </a>
<nav aria-label="Relational Comparison" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#string-comparison">
    String Comparison
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#numeric-comparison">
    Numeric Comparison
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#concrete-coercions">
    Concrete Coercions
  </a>
<nav aria-label="Concrete Coercions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#to-boolean">
    To Boolean
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#to-string">
    To String
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#to-number">
    To Number
  </a>
<nav aria-label="To Number" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#mathematical-operations">
    Mathematical Operations
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bitwise-operations">
    Bitwise Operations
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#property-access">
    Property Access
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#to-primitive">
    To Primitive
  </a>
<nav aria-label="To Primitive" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#no-primitive-found">
    No Primitive Found?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#object-to-boolean">
    Object To Boolean
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unboxing-wrapper-to-primitive">
    Unboxing: Wrapper To Primitive
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overriding-default-tostring">
    Overriding Default toString()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overriding-toprimitive">
    Overriding ToPrimitive
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#equality">
    Equality
  </a>
<nav aria-label="Equality" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#equality-operators-vs">
    Equality Operators: == vs ===
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nullish-coercion">
    Nullish Coercion
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#boolean-gotcha">
    == Boolean Gotcha
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coercion-corner-cases">
    Coercion Corner Cases
  </a>
<nav aria-label="Coercion Corner Cases" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#strings">
    Strings
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#numbers">
    Numbers
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coercion-absurdity">
    Coercion Absurdity
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-awareness">
    Type Awareness
  </a>
<nav aria-label="Type Awareness" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#uhh-typescript">
    Uhh... TypeScript?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-awareness-without-typescript">
    Type-Awareness Without TypeScript
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-awareness-with-typescript">
    Type-Awareness With TypeScript
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#typescript-intelligence">
    TypeScript Intelligence
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-bar-above-typescript">
    The Bar Above TypeScript
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#type-aware-equality">
    Type Aware Equality
  </a>
<nav aria-label="Type Aware Equality" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#2-unknown-types">
    (2) Unknown Types
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-known-types">
    (1) Known Types
  </a>
<nav aria-label="(1) Known Types" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1a-known-matching-types">
    (1a) Known Matching Types
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1b-known-mismatched-types">
    (1b) Known Mismatched Types
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summarizing-type-sensitive-equality-comparison">
    Summarizing Type-Sensitive Equality Comparison
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#typescripts-inconsistency-problem">
    TypeScript's Inconsistency Problem
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#whats-left">
    What's Left?
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="chapter-4-coercing-values">Chapter 4: Coercing Values<a class="headerlink" href="#chapter-4-coercing-values" title="Permanent link">¶</a></h1>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Work in progress</td>
</tr>
</tbody>
</table>
<p>We've thouroughly covered all of the different <em>types</em> of values in JS. And along the way, more than a few times, we mentioned the notion of converting -- actually, coercing -- from one type of value to another.</p>
<p>In this chapter, we'll dive deep into coercion and uncover all its mysteries.</p>
<h2 id="coercion-explicit-vs-implicit">Coercion: Explicit vs Implicit<a class="headerlink" href="#coercion-explicit-vs-implicit" title="Permanent link">¶</a></h2>
<p>Some developers assert that when you explicitly indicate a type change in an operation, this doesn't qualify as a <em>coercion</em> but just a type-cast or type-conversion. In other words, the claim is that coercion is only implicit.</p>
<p>I disagree with this characterization. I use <em>coercion</em> to label any type conversion in a dynamically-typed language, whether it's plainly obvious in the code or not. Here's why: the line between <em>explicit</em> and <em>implicit</em> is not clear and objective, it's fairly subjective. If you think a type conversion is implicit (and thus <em>coercion</em>), but I think it's explicit (and thus not a <em>coercion</em>), the distinction becomes irrelevant.</p>
<p>Keep that subjectivity in mind as we explore various <em>explicit</em> and <em>implicit</em> forms of coercion. In fact, here's a spoiler: most of the coercions could be argued as either, so we'll be looking at them with such balanced perspective.</p>
<h3 id="implicit-bad-or">Implicit: Bad or ...?<a class="headerlink" href="#implicit-bad-or" title="Permanent link">¶</a></h3>
<p>An extremely common opinion among JS developers is that <em>coercion is bad</em>, specifically, that <em>implicit coercion is bad</em>; the rise in popularity of type-aware tooling like TypeScript speaks loudly to this sentiment.</p>
<p>But that feeling is not new. 14+ years ago, Douglas Crockford's book "The Good Parts" also famously decried <em>implicit coercion</em> as one of the <em>bad parts</em>. Even Brendan Eich, creator of JS, regularly claims that <em>implicit coercion</em> was a mistake<sup id="fnref:EichCoercion"><a class="footnote-ref" href="#fn:EichCoercion">1</a></sup> in the early design of the language that he now regrets.</p>
<p>If you've been around JS for more than a few months, you've almost certainly heard these opinions voiced strongly and predominantly. And if you've been around JS for years or more, you probably have your mind already made up.</p>
<p>In fact, I think you'd be hard pressed to name hardly any other well-known source of JS teaching that strongly endorses coercion (in virtually all its forms); I do -- and this book definitely does! -- but I feel mostly like a lone voice shouting futilely in the wilderness.</p>
<p>However, here's an observation I've made over the years: most of the folks who publicly condemn <em>implicit coercion</em>, actually use <em>implicit coercion</em> in their own code. Hmmmm...</p>
<p>Douglas Crockford says to avoid the mistake of <em>implicit coercion</em><sup id="fnref:CrockfordCoercion"><a class="footnote-ref" href="#fn:CrockfordCoercion">2</a></sup>, but his code uses <code>if (..)</code> statements with non-boolean values evaluated. <sup id="fnref:CrockfordIfs"><a class="footnote-ref" href="#fn:CrockfordIfs">3</a></sup> Many have dismissed my pointing that out in the past, with the claim that conversion-to-booelan isn't <em>really</em> coercion. Ummm... ok?</p>
<p>Brendan Eich says he regrets <em>implicit coercion</em>, but yet he openly endorses<sup id="fnref:BrendanToString"><a class="footnote-ref" href="#fn:BrendanToString">4</a></sup> idioms like <code>x + ""</code> (and others!) to coerce the value in <code>x</code> to a string (we'll cover this later); and that's most definitely an <em>implicit coercion</em>.</p>
<p>So what do we make of this dissonance? Is it merely a, "do as I say, not as I do" minor self-contradiction? Or is there more to it?</p>
<p>I am not going to pass a final judgement here yet, but I want you the reader to deeply ponder that question, as you continue throughout this chapter and book.</p>
<h2 id="abstracts">Abstracts<a class="headerlink" href="#abstracts" title="Permanent link">¶</a></h2>
<p>Now that I've challenged you to examine coercion in more depth than you may have ever previously indulged, let's first look at the foundations of how coercion occurs, according to the JS specification.</p>
<p>The specification details a number of <em>abstract operations</em><sup id="fnref:AbstractOperations"><a class="footnote-ref" href="#fn:AbstractOperations">5</a></sup> that dictate internal conversion from one value-type to another. It's important to be aware of these operations, as coercive mechanics in the language mix and match them in various ways.</p>
<p>These operations <em>look</em> as if they're real functions that could be called, such as <code>ToString(..)</code> or <code>ToNumber(..)</code>. But by <em>abstract</em>, we mean they only exist conceptually by these names; they aren't functions we can <em>directly</em> invoke in our programs. Instead, we activate them implicitly/indirectly depending on the statements/expressions in our programs.</p>
<h3 id="toboolean">ToBoolean<a class="headerlink" href="#toboolean" title="Permanent link">¶</a></h3>
<p>Decision making (conditional branching) always requires a boolean <code>true</code> or <code>false</code> value. But it's extremely common to want to make these decisions based on non-boolean value conditions, such as whether a string is empty or has anything in it.</p>
<p>When non-boolean values are encountered in a context that requires a boolean -- such as the condition clause of an <code>if</code> statement or <code>for</code> loop -- the <code>ToBoolean(..)</code><sup id="fnref:ToBoolean"><a class="footnote-ref" href="#fn:ToBoolean">6</a></sup> abstract operation is activated to facilitate the coercion.</p>
<p>All values in JS are in one of two buckets: <em>truthy</em> or <em>falsy</em>. Truthy values coerce via the <code>ToBoolean()</code> operation to <code>true</code>, whereas falsy values coerce to <code>false</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>// ToBoolean() is abstract
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>ToBoolean(undefined);               // false
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>ToBoolean(null);                    // false
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>ToBoolean("");                      // false
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>ToBoolean(0);                       // false
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>ToBoolean(-0);                      // false
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>ToBoolean(0n);                      // false
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>ToBoolean(NaN);                     // false
</code></pre></div>
<p>Simple rule: <em>any other value</em> that's not in the above list is truthy and coerces via <code>ToBoolean()</code> to <code>true</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>ToBoolean("hello");                 // true
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>ToBoolean(42);                      // true
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>ToBoolean([ 1, 2, 3 ]);             // true
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>ToBoolean({ a: 1 });                // true
</code></pre></div>
<p>Even values like <code>"   "</code> (string with only whitespace), <code>[]</code> (empty array), and <code>{}</code> (empty object), which may seem intuitively like they're more "false" than "true", nevertheless coerce to <code>true</code>.</p>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">There <em>are</em> narrow, tricky exceptions to this truthy rule. For example, the web platform has deprecated the long-standing <code>document.all</code> collection/array feature, though it cannot be removed entirely -- that would break too many sites. Even where <code>document.all</code> is still defined, it behaves as a "falsy object"<sup id="fnref3:ExoticFalsyObjects"><a class="footnote-ref" href="#fn:ExoticFalsyObjects">7</a></sup> -- <code>undefined</code> which then coerces to <code>false</code>; this means legacy conditional checks like <code>if (document.all) { .. }</code> no longer pass.</td>
</tr>
</tbody>
</table>
<p>The <code>ToBoolean()</code> coercion operation is basically a lookup table rather than an algorithm of steps to use in coercions a non-boolean to a boolean. Thus, some developers assert that this isn't <em>really</em> coercion the way other abstract coercion operations are. I think that's bogus. <code>ToBoolean()</code> converts from non-boolean value-types to a boolean, and that's clear cut type coercion (even if it's a very simple lookup instead of an algorithm).</p>
<p>Keep in mind: these rules of boolean coercion only apply when <code>ToBoolean()</code> is actually activated. There are constructs/idioms in the JS language that may appear to involve boolean coercion but which don't actually do so. More on these later.</p>
<h3 id="toprimitive">ToPrimitive<a class="headerlink" href="#toprimitive" title="Permanent link">¶</a></h3>
<p>Any value that's not already a primitive can be reduced to a primitive using the <code>ToPrimitive()</code> (specifically, <code>OrdinaryToPrimitive()</code><sup id="fnref:OrdinaryToPrimitive"><a class="footnote-ref" href="#fn:OrdinaryToPrimitive">8</a></sup>) abstract operation.  Generally, the <code>ToPrimitive()</code> is given a <em>hint</em> to tell it whether a <code>number</code> or <code>string</code> is preferred.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>// ToPrimitive() is abstract
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>ToPrimitive({ a: 1 },"string");          // "[object Object]"
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>ToPrimitive({ a: 1 },"number");          // NaN
</code></pre></div>
<p>The <code>ToPrimitive()</code> operation will look on the object provided, for either a <code>toString()</code> method or a <code>valueOf()</code> method; the order it looks for those is controlled by the <em>hint</em>. <code>"string"</code> means check in <code>toString()</code> / <code>valueOf()</code> order, whereas <code>"number"</code> (or no <em>hint</em>) means check in <code>valueOf()</code> / <code>toString()</code> order.</p>
<p>If the method returns a value matching the <em>hinted</em> type, the operation is finished. But if the method doesn't return a value of the <em>hinted</em> type, <code>ToPrimitive()</code> will then look for and invoke the other method (if found).</p>
<p>If the attempts at method invocation fail to produce a value of the <em>hinted</em> type, the final return value is forcibly coerced via the corresponding abstract operation: <code>ToString()</code> or <code>ToNumber()</code>.</p>
<h3 id="tostring">ToString<a class="headerlink" href="#tostring" title="Permanent link">¶</a></h3>
<p>Pretty much any value that's not already a string can be coerced to a string representation, via <code>ToString()</code>. <sup id="fnref:ToString"><a class="footnote-ref" href="#fn:ToString">9</a></sup> This is usually quite intuitive, especially with primitive values:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>// ToString() is abstract
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>ToString(42.0);                 // "42"
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>ToString(-3);                   // "-3"
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>ToString(Infinity);             // "Infinity"
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>ToString(NaN);                  // "NaN"
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>ToString(42n);                  // "42"
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>ToString(true);                 // "true"
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>ToString(false);                // "false"
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>ToString(null);                 // "null"
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>ToString(undefined);            // "undefined"
</code></pre></div>
<p>There are <em>some</em> results that may vary from common intuition. As mentioned in Chapter 2, very large or very small numbers will be represented using scientific notation:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>ToString(Number.MAX_VALUE);     // "1.7976931348623157e+308"
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>ToString(Math.EPSILON);         // "2.220446049250313e-16"
</code></pre></div>
<p>Another counter-intuitive result comes from <code>-0</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>ToString(-0);                   // "0" -- wtf?
</code></pre></div>
<p>This isn't a bug, it's just an intentional behavior from the earliest days of JS, based on the assumption that developers generally wouldn't want to ever see a negative-zero output.</p>
<p>One primitive value-type that is <em>not allowed</em> to be coerced (implicitly, at least) to string is <code>symbol</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>ToString(Symbol("ok"));         // TypeError exception thrown
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Calling the <code>String()</code><sup id="fnref:StringFunction"><a class="footnote-ref" href="#fn:StringFunction">11</a></sup> concrete function (without <code>new</code> operator) is generally thought of as <em>merely</em> invoking the <code>ToString()</code> abstract operation. While that's mostly true, it's not entirely so. <code>String(Symbol("ok"))</code> works, whereas the abstract <code>ToString(Symbol(..))</code> itself throws an exception. More on <code>String(..)</code> later in this chapter.</td>
</tr>
</tbody>
</table>
<h4 id="default-tostring">Default <code>toString()</code><a class="headerlink" href="#default-tostring" title="Permanent link">¶</a></h4>
<p>When <code>ToString()</code> is activated with an object value-type, it delegates to the <code>ToPrimitive()</code> operation (as explained earlier), with <code>"string"</code> as its <em>hinted</em> type:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>ToString(new String("abc"));        // "abc"
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>ToString(new Number(42));           // "42"
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>ToString({ a: 1 });                 // "[object Object]"
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>ToString([ 1, 2, 3 ]);              // "1,2,3"
</code></pre></div>
<p>By virtue of <code>ToPrimitive(..,"string")</code> delegation, these objects all have their default <code>toString()</code> method (inherited via <code>[[Prototype]]</code>) invoked.</p>
<h3 id="tonumber">ToNumber<a class="headerlink" href="#tonumber" title="Permanent link">¶</a></h3>
<p>Non-number values <em>that resemble</em> numbers, such as numeric strings, can generally be coerced to a numeric representation, using <code>ToNumber()</code>: <sup id="fnref:ToNumber"><a class="footnote-ref" href="#fn:ToNumber">12</a></sup></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>// ToNumber() is abstract
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>ToNumber("42");                     // 42
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>ToNumber("-3");                     // -3
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>ToNumber("1.2300");                 // 1.23
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>ToNumber("   8.0    ");             // 8
</code></pre></div>
<p>If the full value doesn't <em>completely</em> (other than whitespace) resemble a valid number, the result will be <code>NaN</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>ToNumber("123px");                  // NaN
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>ToNumber("hello");                  // NaN
</code></pre></div>
<p>Other primitive values have certain designated numeric equivalents:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>ToNumber(true);                     // 1
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>ToNumber(false);                    // 0
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a>ToNumber(null);                     // 0
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a>ToNumber(undefined);                // NaN
</code></pre></div>
<p>There are some rather surprising designations for <code>ToNumber()</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>ToNumber("");                       // 0
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>ToNumber("       ");                // 0
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">I call these "surprising" because I think it would have made much more sense for them to coerce to <code>NaN</code>, the way <code>undefined</code> does.</td>
</tr>
</tbody>
</table>
<p>Some primitive values are <em>not allowed</em> to be coerced to numbers, and result in exceptions rather than <code>NaN</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>ToNumber(42n);                      // TypeError exception thrown
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>ToNumber(Symbol("42"));             // TypeError exception thrown
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Calling the <code>Number()</code><sup id="fnref:NumberFunction"><a class="footnote-ref" href="#fn:NumberFunction">15</a></sup> concrete function (without <code>new</code> operator) is generally thought of as <em>merely</em> invoking the <code>ToNumber()</code> abstract operation to coerce a value to a number. While that's mostly true, it's not entirely so. <code>Number(42n)</code> works, whereas the abstract <code>ToNumber(42n)</code> itself throws an exception.</td>
</tr>
</tbody>
</table>
<h4 id="other-abstract-numeric-conversions">Other Abstract Numeric Conversions<a class="headerlink" href="#other-abstract-numeric-conversions" title="Permanent link">¶</a></h4>
<p>In addition to <code>ToNumber()</code>, the specification defines <code>ToNumeric()</code>, which activates <code>ToPrimitive()</code> on a value, then conditionally delegates to <code>ToNumber()</code> if the value is <em>not</em> already a <code>bigint</code> value-type.</p>
<p>There are also a wide variety of abstract operations related to converting values to very specific subsets of the general <code>number</code> type:</p>
<ul>
<li><code>ToIntegerOrInfinity()</code></li>
<li><code>ToInt32()</code></li>
<li><code>ToUint32()</code></li>
<li><code>ToInt16()</code></li>
<li><code>ToUint16()</code></li>
<li><code>ToInt8()</code></li>
<li><code>ToUint8()</code></li>
<li><code>ToUint8Clamp()</code></li>
</ul>
<p>Other operations related to <code>bigint</code>:</p>
<ul>
<li><code>ToBigInt()</code></li>
<li><code>StringToBigInt()</code></li>
<li><code>ToBigInt64()</code></li>
<li><code>ToBigUint64()</code></li>
</ul>
<p>You can probably infer the purpose of these operations from their names, and/or from consulting their algorithms in the specification. For most JS operations, it's more likely that a higher-level operation like <code>ToNumber()</code> is activated, rather than these specific ones.</p>
<h4 id="default-valueof">Default <code>valueOf()</code><a class="headerlink" href="#default-valueof" title="Permanent link">¶</a></h4>
<p>When <code>ToNumber()</code> is activated on an object value-type, it instead delegates to the <code>ToPrimitive()</code> operation (as explained earlier), with <code>"number"</code> as its <em>hinted</em> type:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>ToNumber(new String("abc"));        // NaN
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>ToNumber(new Number(42));           // 42
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>ToNumber({ a: 1 });                 // NaN
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>ToNumber([ 1, 2, 3 ]);              // NaN
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a>ToNumber([]);                       // 0
</code></pre></div>
<p>By virtue of <code>ToPrimitive(..,"number")</code> delegation, these objects all have their default <code>valueOf()</code> method (inherited via <code>[[Prototype]]</code>) invoked.</p>
<h3 id="equality-comparison">Equality Comparison<a class="headerlink" href="#equality-comparison" title="Permanent link">¶</a></h3>
<p>When JS needs to determine if two values are the <em>same value</em>, it activates the <code>SameValue()</code><sup id="fnref:SameValue"><a class="footnote-ref" href="#fn:SameValue">16</a></sup> operation, which delegates to a variety of related sub-operations.</p>
<p>This operation is very narrow and strict, and performs no coercion or any other special case exceptions. If two values are <em>exactly</em> the same, the result is <code>true</code>, otherwise it's <code>false</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a>// SameValue() is abstract
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>SameValue("hello","\x68ello");          // true
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a>SameValue("\u{1F4F1}","\uD83D\uDCF1");  // true
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a>SameValue(42,42);                       // true
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a>SameValue(NaN,NaN);                     // true
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a>SameValue("\u00e9","\u0065\u0301");     // false
<a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a>SameValue(0,-0);                        // false
<a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a>SameValue([1,2,3],[1,2,3]);             // false
</code></pre></div>
<p>A variation of these operations is <code>SameValueZero()</code> and its associated sub-operations. The main difference is that these operations treat <code>0</code> and <code>-0</code> as indistinguishable.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>// SameValueZero() is abstract
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>SameValueZero(0,-0);                    // true
</code></pre></div>
<p>If the values are numeric (<code>number</code> or <code>bigint</code>), <code>SameValue()</code> and <code>SameValueZero()</code> both delegate to sub-operations of the same names, specialized for each <code>number</code> and <code>bigint</code> type, respectively.</p>
<p>Otherwise, <code>SameValueNonNumeric()</code> is the sub-operation delegated to if the values being compared are both non-numeric:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>// SameValueNonNumeric() is abstract
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a>SameValueNonNumeric("hello","hello");   // true
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>SameValueNonNumeric([1,2,3],[1,2,3]);   // false
</code></pre></div>
<h4 id="higher-abstracted-equality">Higher-Abstracted Equality<a class="headerlink" href="#higher-abstracted-equality" title="Permanent link">¶</a></h4>
<p>Different from <code>SameValue()</code> and its variations, the specification also defines two important higher-abstraction abstract equality comparison operations:</p>
<ul>
<li><code>IsStrictlyEqual()</code><sup id="fnref2:StrictEquality"><a class="footnote-ref" href="#fn:StrictEquality">17</a></sup></li>
<li><code>IsLooselyEqual()</code><sup id="fnref3:LooseEquality"><a class="footnote-ref" href="#fn:LooseEquality">18</a></sup></li>
</ul>
<p>The <code>IsStrictlyEqual()</code> operation immediately returns <code>false</code> if the value-types being compared are different.</p>
<p>If the value-types are the same, <code>IsStrictlyEqual()</code> delegates to sub-operations for comparing <code>number</code> or <code>bigint</code> values. <sup id="fnref:NumericAbstractOps"><a class="footnote-ref" href="#fn:NumericAbstractOps">19</a></sup> You might logically expect these delegated sub-operations to be the aforementioned numeric-specialized <code>SameValue()</code> / <code>SameValueZero()</code> operations. However, <code>IsStrictlyEqual()</code> instead delegates to <code>Number:equal()</code><sup id="fnref:NumberEqual"><a class="footnote-ref" href="#fn:NumberEqual">20</a></sup> or <code>BigInt:equal()</code><sup id="fnref:BigIntEqual"><a class="footnote-ref" href="#fn:BigIntEqual">21</a></sup>.</p>
<p>The difference between <code>Number:SameValue()</code> and <code>Number:equal()</code> is that the latter defines corner cases for <code>0</code> vs <code>-0</code> comparison:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a>// all of these are abstract operations
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>Number:SameValue(0,-0);             // false
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>Number:SameValueZero(0,-0);         // true
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>Number:equal(0,-0);                 // true
</code></pre></div>
<p>These operations also differ in <code>NaN</code> vs <code>NaN</code> comparison:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a>Number:SameValue(NaN,NaN);          // true
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>Number:equal(NaN,NaN);              // false
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">So in other words, despite its name, <code>IsStrictlyEqual()</code> is not quite as "strict" as <code>SameValue()</code>, in that it <em>lies</em> when comparisons of <code>-0</code> or <code>NaN</code> are involved.</td>
</tr>
</tbody>
</table>
<p>The <code>IsLooselyEqual()</code> operation also inspects the value-types being compared; if they're the same, it immediately delegates to <code>IsStrictlyEqual()</code>.</p>
<p>But if the value-types being compared are different, <code>IsLooselyEqual()</code> performs a variety of <em>coercive equality</em> steps. It's important to note that this algorithm is always trying to reduce the comparison down to where both value-types are the same (and it tends to prefer <code>number</code> / <code>bigint</code>).</p>
<p>The steps of the <em>coercive equality</em> portion of the algorithm can roughly be summarized as follows:</p>
<ol>
<li>
<p>If either value is <code>null</code> and the other is <code>undefined</code>, <code>IsLooselyEqual()</code> returns <code>true</code>. In other words, this algorithm applies <em>nullish</em> equality, in that <code>null</code> and <code>undefined</code> are coercively equal to each other (and to no other values).</p>
</li>
<li>
<p>If either value is a <code>number</code> and the other is a <code>string</code>, the <code>string</code> value is coerced to a <code>number</code> via <code>ToNumber()</code>.</p>
</li>
<li>
<p>If either value is a <code>bigint</code> and the other is a <code>string</code>, the <code>string</code> value is coerced to a <code>bigint</code> via <code>StringToBigInt()</code>.</p>
</li>
<li>
<p>If either value is a <code>boolean</code>, it's coerced to a <code>number</code>.</p>
</li>
<li>
<p>If either value is a non-primitive (object, etc), it's coerced to a primitive with <code>ToPrimitive()</code>; though a <em>hint</em> is not explicitly provided, the default behavior will be as if <code>"number"</code> was the hint.</p>
</li>
</ol>
<p>Each time a coercion is performed in the above steps, the algorithm is <em>recursively</em> reactivated with the new value(s). That process continues until the types are the same, and then the comparison is delegated to the <code>IsStrictlyEqual()</code> operation.</p>
<p>What can we take from this algorithm? First, we see there is a bias toward <code>number</code> (or <code>bigint</code>) comparison; it nevers coerce values to <code>string</code> or <code>boolean</code> value-types.</p>
<p>Importantly, we see that both <code>IsLooselyEqual()</code> and <code>IsStrictlyEqual()</code> are type-sensitive. <code>IsStrictlyEqual()</code> immediately bails if the types mismatch, whereas <code>IsLooselyEqual()</code> performs the extra work to coerce mismatching value-types to be the same value-types (again, ideally, <code>number</code> or <code>bigint</code>).</p>
<p>Moreover, if/once the types are the same, both operations are identical -- <code>IsLooselyEqual()</code> delegates to <code>IsStrictlyEqual()</code>.</p>
<h3 id="relational-comparison">Relational Comparison<a class="headerlink" href="#relational-comparison" title="Permanent link">¶</a></h3>
<p>When values are compared relationally -- that is, is one value "less than" another? -- there's one specific abstract operation that is activated: <code>IsLessThan()</code>. <sup id="fnref:LessThan"><a class="footnote-ref" href="#fn:LessThan">22</a></sup></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>// IsLessThan() is abstract
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>IsLessThan(1,2, /*LeftFirst=*/ true );            // true
</code></pre></div>
<p>There is no <code>IsGreaterThan()</code> operation; instead, the first two arguments to <code>IsLessThan()</code> can be reversed to accomplish a "greater than" comparison. To preserve left-to-right evaluation semantics (in the case of nuanced side-effects), <code>isLessThan()</code> also takes a third argument (<code>LeftFirst</code>); if <code>false</code>, this indicates a comparison was reversed and the second parameter should be evaluated before the first.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a>IsLessThan(1,2, /*LeftFirst=*/ true );            // true
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>// equivalent of a fictional "IsGreaterThan()"
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a>IsLessThan(2,1, /*LeftFirst=*/ false );          // false
</code></pre></div>
<p>Similar to <code>IsLooselyEqual()</code>, the <code>IsLessThan()</code> operation is <em>coercive</em>, meaning that it first ensures that the value-types of its two values match, and prefers numeric comparisons. There is no <code>IsStrictLessThan()</code> for non-coercive relational comparison.</p>
<p>As an example of coercive relational comparison, if the type of one value is <code>string</code> and the type of the other is <code>bigint</code>, the <code>string</code> is coerced to a <code>bigint</code> with the aforementioned <code>StringToBigInt()</code> operation. Once the types are the same, <code>IsLessThan()</code> proceeds as described in the following sections.</p>
<h4 id="string-comparison">String Comparison<a class="headerlink" href="#string-comparison" title="Permanent link">¶</a></h4>
<p>When both value are type <code>string</code>, <code>IsLessThan()</code> checks to see if the lefthand value is a prefix (the first <em>n</em> characters<sup id="fnref:StringPrefix"><a class="footnote-ref" href="#fn:StringPrefix">23</a></sup>) of the righthand; if so, <code>true</code> is returned.</p>
<p>If neither string is a prefix of the other, the first character position (start-to-end direction, not left-to-right) that's different between the two strings, is compared for their respective code-unit (numeric) values; the result is then returned.</p>
<p>Generally, code-units follow intuitive lexicographic (aka, dictionary) order:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>IsLessThan("a","b", /*LeftFirst=*/ true );        // true
</code></pre></div>
<p>Even digits are treated as characters (not numbers):</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a>IsLessThan("101","12", /*LeftFirst=*/ true );     // true
</code></pre></div>
<p>There's even a bit of embedded <em>humor</em> in the unicode code-unit ordering:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a>IsLessThan("🐔","🥚", /*LeftFirst=*/ true );      // true
</code></pre></div>
<p>At least now we've answered the age old question of <em>which comes first</em>?!</p>
<h4 id="numeric-comparison">Numeric Comparison<a class="headerlink" href="#numeric-comparison" title="Permanent link">¶</a></h4>
<p>For numeric comparisons, <code>IsLessThan()</code> defers to either the <code>Number:lessThan()</code> or <code>BigInt.lessThan()</code> operation<sup id="fnref2:NumericAbstractOps"><a class="footnote-ref" href="#fn:NumericAbstractOps">19</a></sup>, respectively:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>IsLessThan(41,42, /*LeftFirst=*/ true );         // true
<a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>
<a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>IsLessThan(-0,0, /*LeftFirst=*/ true );          // false
<a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a>
<a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a>IsLessThan(NaN,1 /*LeftFirst=*/ true );          // false
<a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a>
<a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a>IsLessThan(41n,42n, /*LeftFirst=*/ true );       // true
</code></pre></div>
<h2 id="concrete-coercions">Concrete Coercions<a class="headerlink" href="#concrete-coercions" title="Permanent link">¶</a></h2>
<p>Now that we've covered all the abstract operations JS defines for handling various coercions, it's time to turn our attention to the concrete statements/expressions we can use in our programs that activate these operations.</p>
<h3 id="to-boolean">To Boolean<a class="headerlink" href="#to-boolean" title="Permanent link">¶</a></h3>
<p>To coerce a value that's not of type <code>boolean</code> into that type, we need the abstract <code>ToBoolean()</code> operation, as described earlier in this chapter.</p>
<p>Before we explore <em>how</em> to activate it, let's discuss <em>why</em> you would want to force a <code>ToBoolean()</code> coercion.</p>
<p>From a code readability perspective, being <em>explicit</em> about type coercions can be preferable (though not universally). But functionally, the most common reason to force a <code>boolean</code> is when you're passing data to an external source -- for example, submitting data as JSON to an API endpoint -- and that location expects <code>true</code> / <code>false</code> without needing to do coercions.</p>
<p>There's several ways that <code>ToBoolean()</code> can be activated. Perhaps the most <em>explicit</em> (obvious) is the <code>Boolean(..)</code> function:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="nb">Boolean</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">);</span><span class="w">               </span><span class="c1">// true</span>
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="nb">Boolean</span><span class="p">(</span><span class="mf">42</span><span class="p">);</span><span class="w">                    </span><span class="c1">// true</span>
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a>
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="nb">Boolean</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span><span class="w">                    </span><span class="c1">// false</span>
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="nb">Boolean</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span><span class="w">                     </span><span class="c1">// false</span>
</code></pre></div>
<p>As mentioned in Chapter 3, keep in mind that <code>Boolean(..)</code> is being called without the <code>new</code> keyword, to activate the <code>ToBoolean()</code> abstract operation.</p>
<p>It's not terribly common to see JS developers use the <code>Boolean(..)</code> function for such explicit coercions. More often, developers will use the double-<code>!</code> idiom:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="o">!!</span><span class="s2">"hello"</span><span class="p">;</span><span class="w">                      </span><span class="c1">// true</span>
<a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="o">!!</span><span class="mf">42</span><span class="p">;</span><span class="w">                           </span><span class="c1">// true</span>
<a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a>
<a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="o">!!</span><span class="s2">""</span><span class="p">;</span><span class="w">                           </span><span class="c1">// false</span>
<a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="o">!!</span><span class="mf">0</span><span class="p">;</span><span class="w">                            </span><span class="c1">// false</span>
</code></pre></div>
<p>The <code>!!</code> is not its own operator, even though it seems that way. It's actually two usages of the unary <code>!</code> operator. This operator first coerces any non-<code>boolean</code>, then negates it. To undo the negation, the second <code>!</code> flips it back.</p>
<p>So... which of the two, <code>Boolean(..)</code> or <code>!!</code>, do you consider to be more of an explicit coercion?</p>
<p>Given the flipping that <code>!</code> does, which must then be undone with another <code>!</code>, I'd say <code>Boolean(..)</code> is <em>more</em> explicit -- at the job of coercing a non-<code>boolean</code> to a <code>boolean</code> -- than <code>!!</code> is. But surveying open-source JS code, the <code>!!</code> is used far more often.</p>
<p>If we're defining <em>explicit</em> as, "most directly and obviously perfoming an action", <code>Boolean(..)</code> edges out <code>!!</code>. But if we're defining <em>explicit</em> as, "most recognizably performing an action", <code>!!</code> might have the edge. Is there a definitive answer here?</p>
<p>While you're pondering that question, let's look at another JS mechanism that activates <code>ToBoolean()</code> under the covers:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="nx">specialNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span>
<a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a>
<a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">specialNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="p">}</span>
</code></pre></div>
<p>The <code>if</code> statement requires a <code>boolean</code> for the conditional to make its control-flow decision. If you pass it a non-<code>boolean</code>, a <code>ToBoolean()</code> <em>coercion</em> is performed.</p>
<p>Unlike previous <code>ToBoolean()</code> coercion expressions, like <code>Boolean(..)</code> or <code>!!</code>, this <code>if</code> coercion is ephemeral, in that our JS program never sees the result of the coercion; it's just used internally by the <code>if</code>. Some may feel it's not <em>really</em> coercion if the program doesn't preserve/use the value. But I strongly disagree, because the coercion most definitely affects the program's behavior.</p>
<p>Many other statement types also activate the <code>ToBoolean()</code> coercion, including the <code>? :</code> ternary conditional, and <code>for</code> / <code>while</code> loops. We also have <code>&amp;&amp;</code> (logical-AND) and <code>||</code> (logical-OR) operators. For example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="nx">isLoggedIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">sessionID</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">cookie</span><span class="p">[</span><span class="s2">"Session-ID"</span><span class="p">];</span>
<a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a>
<a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="nx">isAdmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isLoggedIn</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="s2">"admin"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">permissions</span><span class="p">);</span>
</code></pre></div>
<p>For both operators, the lefthand expression is first evaluated; if it's not already a <code>boolean</code>, a <code>ToBoolean()</code> coercion is activated to produce a value for the conditional decision.</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">To briefly explain these operators: for <code>||</code>, if the lefthand expression value (post-coercion, if necessary) is <code>true</code>, the pre-coercion value is returned; otherwise the righthand expression is evaluated and returned (no coercion). For <code>&amp;&amp;</code>, if the lefthand expression value (post-coercion, if necessary) is <code>false</code>, the pre-coercion value is returned; otherwise, the righthand expression is evaluated and returned (no coercion). In other words, both <code>&amp;&amp;</code> and <code>||</code> force a <code>ToBoolean()</code> coercion of the lefthand operand for making the decision, but neither operator's final result is actually coerced to a <code>boolean</code>.</td>
</tr>
</tbody>
</table>
<p>In the previous snippet, despite the naming implications, it's unlikely that <code>isLoggedIn</code> will actually be a <code>boolean</code>; and if it's truthy, <code>isAdmin</code> also won't be a <code>boolean</code>. That kind of code is quite common, but it's definitely dangerous that the assumed resultant <code>boolean</code> types aren't actually there. We'll revisit this example, and these operators, in the next chapter.</p>
<p>Are these kinds of statements/expressions (e.g., <code>if (..)</code>, <code>||</code>, <code>&amp;&amp;</code>, etc) illustrating <em>explicit</em> coercion or <em>implicit</em> coercion in their conditional decision making?</p>
<p>Again, I think it depends on your perspective. The specification dictates pretty explicitly that they only make their decisions with <code>boolean</code> conditional values, requiring coercion if a non-<code>boolean</code> is received. On the other hand, a strong argument can also be made that any internal coercion is a secondary (implicit) effect to the main job of <code>if</code> / <code>&amp;&amp;</code> / etc.</p>
<p>Further, as mentioned earlier in the <code>ToBoolean()</code> discussion, some folks don't consider <em>any</em> activation of <code>ToBoolean()</code> to be a coercion.</p>
<p>I think that's too much of a stretch, though. My take: <code>Boolean(..)</code> is the most preferable <em>explicit</em> coercion form. I think <code>!!</code>, <code>if</code>, <code>for</code>, <code>while</code>, <code>&amp;&amp;</code>, and <code>||</code> are all <em>implicitly</em> coercing non-<code>boolean</code>s, but I'm OK with that.</p>
<p>Since most developers, including famous names like Doug Crockford, also in practice use implicit (<code>boolean</code>) coercions in their code<sup id="fnref2:CrockfordIfs"><a class="footnote-ref" href="#fn:CrockfordIfs">3</a></sup>, I think we can say that at least <em>some forms</em> of <em>implicit</em> coercion are widely acceptable, regardless of the ubiquitous rhetoric to the contrary.</p>
<h3 id="to-string">To String<a class="headerlink" href="#to-string" title="Permanent link">¶</a></h3>
<p>As with <code>ToBoolean()</code>, there are a number of ways to activate the <code>ToString()</code> coercion (as discussed earlier in the chapter). The decision of which approach is similarly subjective.</p>
<p>Like the <code>Boolean(..)</code> function, the <code>String(..)</code> function (no <code>new</code> keyword) is a primary way of activating <em>explicit</em> <code>ToString()</code> coercion:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="nb">String</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">                   </span><span class="c1">// "true"</span>
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="nb">String</span><span class="p">(</span><span class="mf">42</span><span class="p">);</span><span class="w">                     </span><span class="c1">// "42"</span>
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="nb">String</span><span class="p">(</span><span class="o">-</span><span class="mf">0</span><span class="p">);</span><span class="w">                     </span><span class="c1">// "0"</span>
<a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="nb">String</span><span class="p">(</span><span class="kc">Infinity</span><span class="p">);</span><span class="w">               </span><span class="c1">// "Infinity"</span>
<a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a>
<a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="nb">String</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w">                   </span><span class="c1">// "null"</span>
<a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="nb">String</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span><span class="w">              </span><span class="c1">// "undefined"</span>
</code></pre></div>
<p>However, <code>String(..)</code> is more than <em>just</em> an activation of <code>ToString()</code>. For example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="nb">String</span><span class="p">(</span><span class="nb">Symbol</span><span class="p">(</span><span class="s2">"ok"</span><span class="p">));</span><span class="w">           </span><span class="c1">// "Symbol(ok)"</span>
</code></pre></div>
<p>This works, because <em>explicit</em> coercion of <code>symbol</code> values is allowed. But in cases where a symbol is <em>implicitly</em> coerced to a string (e.g., <code>Symbol("ok") + ""</code>), the underlying <code>ToString()</code> operation throws an exception. That proves that <code>String(..)</code> is more than just an activation of <code>ToString()</code>. More on <em>implicit</em> string coercion of symbols in a bit.</p>
<p>If you call <code>String(..)</code> with an object value (e.g., array, etc), it activates the <code>ToPrimitive()</code> operation (via the <code>ToString()</code> operation), which then looks for an invokes that value's <code>toString()</code> method:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="nb">String</span><span class="p">([</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">]);</span><span class="w">                </span><span class="c1">// "1,2,3"</span>
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="nb">String</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">             </span><span class="c1">// "x =&gt; x + 1"</span>
</code></pre></div>
<p>Aside from <code>String(..)</code>, any primitive, non-nullish value (neither <code>null</code> nor <code>undefined</code>) can be auto-boxed (see Chapter 3) in its respective object wrapper, providing a callable <code>toString()</code> method.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kc">true</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span><span class="w">                </span><span class="c1">// "true"</span>
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="mf">42.</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span><span class="w">                 </span><span class="c1">// "42"</span>
<a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="o">-</span><span class="mf">0.</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span><span class="w">                 </span><span class="c1">// "0"</span>
<a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="kc">Infinity</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span><span class="w">            </span><span class="c1">// "Infinity"</span>
<a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="nb">Symbol</span><span class="p">(</span><span class="s2">"ok"</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span><span class="w">        </span><span class="c1">// "Symbol(ok)"</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Do keep in mind, these <code>toString()</code> methods do <em>not</em> necessarily activate the <code>ToString()</code> operation, they just define their own rules for how to represent the value as a string.</td>
</tr>
</tbody>
</table>
<p>As shown with <code>String(..)</code> just a moment ago, the various object sub-types -- such as arrays, functions, regular expressions, <code>Date</code> and <code>Error</code> instances, etc -- all define their own specific <code>toString()</code> methods, which can be invoked directly:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">].</span><span class="nx">toString</span><span class="p">();</span><span class="w">             </span><span class="c1">// "1,2,3"</span>
<a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span><span class="w">        </span><span class="c1">// "x =&gt; x + 1"</span>
</code></pre></div>
<p>Moreover, any plain object that's (by default) <code>[[Prototype]]</code> linked to <code>Object.prototype</code> has a default <code>toString()</code> method available:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="p">({</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}).</span><span class="nx">toString</span><span class="p">();</span><span class="w">         </span><span class="c1">// "[object Object]"</span>
</code></pre></div>
<p>Is the <code>toString()</code> approach to coercion <em>explicit</em> or <em>implicit</em>? Again, it depends. It's certainly a self-descriptive mechanism, which leans <em>explicit</em>. But it often relies on auto-boxing, which is itself a fairly <em>implicit</em> coercion.</p>
<p>Let's take a look at another common -- and famously endorsed! -- idiom for coercing a value to a string. Recall from "String Concatenation" in Chapter 2, the <code>+</code> operator is overloaded to prefer string concatenation if either operand is already a string, and thus coerces non-string operand to a string if necessary.</p>
<p>Consider:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="kc">true</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">                      </span><span class="c1">// "true"</span>
<a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="mf">42</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">                        </span><span class="c1">// "42"</span>
<a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="kc">null</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">                      </span><span class="c1">// "null"</span>
<a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="kc">undefined</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">                 </span><span class="c1">// "undefined"</span>
</code></pre></div>
<p>The <code>+ ""</code> idiom for string coercion takes advantage of the <code>+</code> overloading, without altering the final coerced string value. By the way, all of these work the same with the operands reversed (i.e., <code>"" + ..</code>).</p>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">An extremely common misconception is that <code>String(x)</code> and <code>x + ""</code> are basically equivalent coercions, respectively just <em>explicit</em> vs <em>implicit</em> in form. But, that's not quite true! We'll revisit this in the "To Primitive" section later in this chapter.</td>
</tr>
</tbody>
</table>
<p>Some feel this is an <em>explicit</em> coercion, but I think it's clearly more <em>implicit</em>, in that it's taking advantage of the <code>+</code> overloading; further, the <code>""</code> is indirectly used to activate the coercion without modifying it. Moreover, consider what happens when this idiom is applied with a symbol value:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="nb">Symbol</span><span class="p">(</span><span class="s2">"ok"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">              </span><span class="c1">// TypeError exception thrown</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Allowing <em>explicit</em> coercion of symbols (<code>String(Symbol("ok"))</code>, but disallowing <em>implicit</em> coercion (<code>Symbol("ok") + ""</code>), is quite intentional by TC39. <sup id="fnref:SymbolString"><a class="footnote-ref" href="#fn:SymbolString">24</a></sup> It was felt that symbols, as primitives often used in places where strings are otherwise used, could too easily be mistaken as strings. As such, they wanted to make sure developers expressed intent to coerce a symbol to a string, hopefully avoiding many of those anticipated confusions. This is one of the <em>extremely rare</em> cases where the language design asserts an opinion on, and actually discriminates between, <em>explicit</em> vs. <em>implicit</em> coercions.</td>
</tr>
</tbody>
</table>
<p>Why the exception? JS treats <code>+ ""</code> as an <em>implicit</em> coercion, which is why when activated with a symbol, an exception is thrown. I think that's a pretty ironclad proof.</p>
<p>Nevertheless, as I mentioned at the start of this chapter, Brendan Eich endorses <code>+ ""</code><sup id="fnref2:BrendanToString"><a class="footnote-ref" href="#fn:BrendanToString">4</a></sup> as the <em>best</em> way to coerce values to strings. I think that carries a lot of weight, in terms of him supporting at least a subset of <em>implicit</em> coercion practices. His views on <em>implicit</em> coercion must be a bit more nuanced than, "it's all bad."</p>
<h3 id="to-number">To Number<a class="headerlink" href="#to-number" title="Permanent link">¶</a></h3>
<p>Numeric coercions are a bit more complicated than string coercions, since we can be talking about either <code>number</code> or <code>bigint</code> as the target type. There's also a much smaller set of values that can be validly represented numerically (everything else becomes <code>NaN</code>).</p>
<p>Let's start with the <code>Number(..)</code> and <code>BigInt(..)</code> functions (no <code>new</code> keywords):</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"42"</span><span class="p">);</span><span class="w">                   </span><span class="c1">// 42</span>
<a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"-3.141596"</span><span class="p">);</span><span class="w">            </span><span class="c1">// -3.141596</span>
<a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"-0"</span><span class="p">);</span><span class="w">                   </span><span class="c1">// -0</span>
<a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a>
<a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="nb">BigInt</span><span class="p">(</span><span class="s2">"42"</span><span class="p">);</span><span class="w">                   </span><span class="c1">// 42n</span>
<a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="nb">BigInt</span><span class="p">(</span><span class="s2">"-0"</span><span class="p">);</span><span class="w">                   </span><span class="c1">// 0n</span>
</code></pre></div>
<p><code>Number</code> coercion which fails (not recognized) results in <code>NaN</code> (see "Invalid Number" in Chapter 1), whereas <code>BigInt</code> throws an exception:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"123px"</span><span class="p">);</span><span class="w">                </span><span class="c1">// NaN</span>
<a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a>
<a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="nb">BigInt</span><span class="p">(</span><span class="s2">"123px"</span><span class="p">);</span>
<a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="c1">// SyntaxError: Cannot convert 123px to a BigInt</span>
</code></pre></div>
<p>Moreover, even though <code>42n</code> is valid syntax as a literal <code>bigint</code>, the string <code>"42n"</code> is never a recognized string representation of a <code>bigint</code>, by either of the coercive function forms:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"42n"</span><span class="p">);</span><span class="w">                  </span><span class="c1">// NaN</span>
<a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a>
<a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="nb">BigInt</span><span class="p">(</span><span class="s2">"42n"</span><span class="p">);</span>
<a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="c1">// SyntaxError: Cannot convert 42n to a BigInt</span>
</code></pre></div>
<p>However, we <em>can</em> coerce numeric strings with other representations of the numbers than typical base-10 decimals (see Chapter 1 for more information):</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"0b101010"</span><span class="p">);</span><span class="w">             </span><span class="c1">// 42</span>
<a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a>
<a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="nb">BigInt</span><span class="p">(</span><span class="s2">"0b101010"</span><span class="p">);</span><span class="w">             </span><span class="c1">// 42n</span>
</code></pre></div>
<p>Typically, <code>Number(..)</code> and <code>BigInt(..)</code> receive string values, but that's not actually required. For example, <code>true</code> and <code>false</code> coerce to their typical numeric equivalents:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="nb">Number</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">                   </span><span class="c1">// 1</span>
<a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="nb">Number</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w">                  </span><span class="c1">// 0</span>
<a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a>
<a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="nb">BigInt</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">                   </span><span class="c1">// 1n</span>
<a href="#__codelineno-41-5" id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="nb">BigInt</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w">                  </span><span class="c1">// 0n</span>
</code></pre></div>
<p>You can also generally coerce between <code>number</code> and <code>bigint</code> types:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="nb">Number</span><span class="p">(</span><span class="mi">42n</span><span class="p">);</span><span class="w">                    </span><span class="c1">// 42</span>
<a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="nb">Number</span><span class="p">(</span><span class="mi">42n</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">1000n</span><span class="p">);</span><span class="w">           </span><span class="c1">// Infinity</span>
<a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a>
<a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="nb">BigInt</span><span class="p">(</span><span class="mf">42</span><span class="p">);</span><span class="w">                     </span><span class="c1">// 42n</span>
</code></pre></div>
<p>We can also use the <code>+</code> unary operator, which is commonly assumed to coerce the same as the <code>Number(..)</code> function:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="o">+</span><span class="s2">"42"</span><span class="p">;</span><span class="w">                          </span><span class="c1">// 42</span>
<a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="o">+</span><span class="s2">"0b101010"</span><span class="p">;</span><span class="w">                    </span><span class="c1">// 42</span>
</code></pre></div>
<p>Be careful though. If the coercions are unsafe/invalid in certain ways, exceptions are thrown:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="nb">BigInt</span><span class="p">(</span><span class="mf">3.141596</span><span class="p">);</span>
<a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="c1">// RangeError: The number 3.141596 cannot be converted to a BigInt</span>
<a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a>
<a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="o">+</span><span class="mi">42n</span><span class="p">;</span>
<a href="#__codelineno-44-5" id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="c1">// TypeError: Cannot convert a BigInt value to a number</span>
</code></pre></div>
<p>Clearly, <code>3.141596</code> does not safely coerce to an integer, let alone a <code>bigint</code>.</p>
<p>But <code>+42n</code> throwing an exception is an interesting case. By contrast, <code>Number(42n)</code> works fine, so it's a bit surprising that <code>+42n</code> fails.</p>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">That surprise is especially palpable since prepending a <code>+</code> in front of a number is typically assumed to just mean a "positive number", the same way <code>-</code> in front a number is assumed to mean a "negative number". As explained in Chapter 1, however, JS numeric syntax (<code>number</code> and <code>bigint</code>) recognize no syntax for "negative values". All numeric literals are parsed as "positive" by default. If a <code>+</code> or <code>-</code> is prepended, those are treated as unary operators applied against the parsed (positive) number.</td>
</tr>
</tbody>
</table>
<p>OK, so <code>+42n</code> is parsed as <code>+(42n)</code>. But still... why is <code>+</code> throwing an exception here?</p>
<p>You might recall earlier when we showed that JS allows <em>explicit</em> string coercion of symbol values, but disallows <em>implicit</em> string coercions? The same thing is going on here. JS language design interprets unary <code>+</code> in front of a <code>bigint</code> value as an <em>implicit</em> <code>ToNumber()</code> coercion (thus disallowed!), but <code>Number(..)</code> is interpreted as an <em>explicit</em> <code>ToNumber()</code> coercion (thus allowed!).</p>
<p>In other words, contrary to popular assumption/assertion, <code>Number(..)</code> and <code>+</code> are not interchangable. I think <code>Number(..)</code> is the safer/more reliable form.</p>
<h4 id="mathematical-operations">Mathematical Operations<a class="headerlink" href="#mathematical-operations" title="Permanent link">¶</a></h4>
<p>Mathematical operators (e.g., <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, and <code>**</code>) expect their operands to be numeric. If you use a non-<code>number</code> with them, that value will be coerced to a <code>number</code> for the purposes of the mathematical computation.</p>
<p>Similar to how <code>x + ""</code> is an idiom for coercing <code>x</code> to a string, an expression like <code>x - 0</code> safely coerces <code>x</code> to a number.</p>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>x + 0</code> isn't quite as safe, since the <code>+</code> operator is overloaded to perform string concatenation if either operand is already a string. The <code>-</code> minus operator isn't overloaded like that, so the only coercion will be to <code>number</code>. Of course, <code>x * 1</code>, <code>x / 1</code>, and even <code>x ** 1</code> would also generally be equivalent mathematicaly, but those are much less common, and probably should be avoided as likely confusing to readers of your code. Even <code>x % 1</code> seems like it should be safe, but it can introduce floating-point skew (see "Floating Point Imprecision" in Chapter 2).</td>
</tr>
</tbody>
</table>
<p>Regardless of what mathematical operator is used, if the coercion fails, a <code>NaN</code> is the result, and all of these operators will propagate the <code>NaN</code> out as their result.</p>
<h4 id="bitwise-operations">Bitwise Operations<a class="headerlink" href="#bitwise-operations" title="Permanent link">¶</a></h4>
<p>Bitwise operators (e.g., <code>|</code>, <code>&amp;</code>, <code>^</code>, <code>&gt;&gt;</code>, <code>&lt;&lt;</code>, and <code>&lt;&lt;&lt;</code>) all expect number operands, but specifically they clamp these values to 32-bit integers.</p>
<p>If you're sure the numbers you're dealing with are safely within the 32-bit integer range, <code>x | 0</code> is another common expression idiom that has the effect of coercing <code>x</code> to a <code>number</code> if necessary.</p>
<p>Moreover, since JS engines know these values will be integers, there's potential for them to optimize for integer-only math if they see <code>x | 0</code>. This is one of several recommended "type annotations" from the ASM.js<sup id="fnref:ASMjs"><a class="footnote-ref" href="#fn:ASMjs">25</a></sup> efforts from years ago.</p>
<h4 id="property-access">Property Access<a class="headerlink" href="#property-access" title="Permanent link">¶</a></h4>
<p>Property access of objects (and index access of arrays) is another place where implicit coercion can occur.</p>
<p>Consider:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="nx">myObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a>
<a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="nx">myObj</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hello"</span><span class="p">;</span>
<a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="nx">myObj</span><span class="p">[</span><span class="s2">"3"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"world"</span><span class="p">;</span>
<a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a>
<a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="w"> </span><span class="nx">myObj</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>What do you expect from the contents of this object? Do you expect two different properties, numeric <code>3</code> (holding <code>"hello"</code>) and string <code>"3"</code> (holding <code>"world"</code>)? Or do you think both properties are in the same location?</p>
<p>If you try that code, you'll see that indeed we get an object with a single property, and it holds the <code>"world"</code> value. That means that JS is internally coercing either the <code>3</code> to <code>"3"</code>, or vice versa, when those properties accesses are made.</p>
<p>Interestingly, the developer console may very well represent the object sort of like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="w"> </span><span class="nx">myObj</span><span class="w"> </span><span class="p">);</span>
<a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="c1">// {3: 'world'}</span>
</code></pre></div>
<p>Does that <code>3</code> there indicate the property is a numeric <code>3</code>? Not quite. Try adding another property to <code>myObj</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="nx">myObj</span><span class="p">.</span><span class="nx">something</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span>
<a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a>
<a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="w"> </span><span class="nx">myObj</span><span class="w"> </span><span class="p">)</span>
<a href="#__codelineno-47-4" id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="c1">// {3: 'world', something: 42}</span>
</code></pre></div>
<p>We can see that this developer console doesn't quote string property keys, so we can't infer anything from <code>3</code> versus if the console had used <code>"3"</code> for the key name.</p>
<p>Let's instead try consulting the specification for the object value[^ObjectValue], where we find:</p>
<blockquote>
<p>A property key value is either an ECMAScript String value or a Symbol value. All String and Symbol values, including the empty String, are valid as property keys. A property name is a property key that is a String value.</p>
</blockquote>
<p>OK! So, in JS, objects only hold string (or symbol) properties. That must mean that the numeric <code>3</code> is coerced to a string <code>"3"</code>, right?</p>
<p>In the same section of the specification, we further read:</p>
<blockquote>
<p>An integer index is a String-valued property key that is a canonical numeric String (see 7.1.21) and whose numeric value is either +0𝔽 or a positive integral Number ≤ 𝔽(253 - 1). An array index is an integer index whose numeric value i is in the range +0𝔽 ≤ i &lt; 𝔽(232 - 1).</p>
</blockquote>
<p>If a property key (like <code>"3"</code>) <em>looks</em> like a number, it's treated as an integer index. Hmmm... that almost seems to suggest the opposite of what we just posited, right?</p>
<p>Nevertheless, we know from the previous quote that property keys are <em>only</em> strings (or symbols). So it must be that "integer index" here is not describing the actual location, but rather the intentional usage of <code>3</code> in JS code, as a developer-expressed "integer index"; JS must still then actually store it at the location of the "canonical numeric String".</p>
<p>Consider attempts to use other value-types, like <code>true</code>, <code>null</code>, <code>undefined</code>, or even non-primitives (other objects):</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="nx">myObj</span><span class="p">[</span><span class="kc">true</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>
<a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="nx">myObj</span><span class="p">[</span><span class="kc">null</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">200</span><span class="p">;</span>
<a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="nx">myObj</span><span class="p">[</span><span class="kc">undefined</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">300</span><span class="p">;</span>
<a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="nx">myObj</span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="nx">a</span><span class="o">:</span><span class="mf">1</span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400</span><span class="p">;</span>
<a href="#__codelineno-48-5" id="__codelineno-48-5" name="__codelineno-48-5"></a>
<a href="#__codelineno-48-6" id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myObj</span><span class="p">);</span>
<a href="#__codelineno-48-7" id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="c1">// {3: 'world', something: 42, true: 100, null: 200,</span>
<a href="#__codelineno-48-8" id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="c1">// undefined: 300, [object Object]: 400}</span>
</code></pre></div>
<p>As you can see, all of those other value-types were coerced to strings for the purposes of object property names.</p>
<p>But before we convince ourselves of this interpretation that everything (even numbers) is coerced to strings, let's look at an array example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="nx">myArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a>
<a href="#__codelineno-49-3" id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="nx">myArr</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hello"</span><span class="p">;</span>
<a href="#__codelineno-49-4" id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="nx">myArr</span><span class="p">[</span><span class="s2">"3"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"world"</span><span class="p">;</span>
<a href="#__codelineno-49-5" id="__codelineno-49-5" name="__codelineno-49-5"></a>
<a href="#__codelineno-49-6" id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="w"> </span><span class="nx">myArr</span><span class="w"> </span><span class="p">);</span>
<a href="#__codelineno-49-7" id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="c1">// [empty × 3, 'world']</span>
</code></pre></div>
<p>The developer console will likely represent an array a bit differently than a plain object. Nevertheless, we still see that this array only has the single <code>"world"</code> value in it, at the numeric index position corresponding to <code>3</code>.</p>
<p>That kind of output sort of implies the opposite of our previous interpretation: that the values of an array are being stored only at numeric positions. If we add another string property-name to <code>myArr</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="nx">myArr</span><span class="p">.</span><span class="nx">something</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span>
<a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="w"> </span><span class="nx">myArr</span><span class="w"> </span><span class="p">);</span>
<a href="#__codelineno-50-3" id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="c1">// [empty × 3, 'world', something: 42]</span>
</code></pre></div>
<p>Now we see that this developer console represents the numerically indexed positions in the array <em>without</em> the property names (locations), but the <code>something</code> property is named in the output.</p>
<p>It's also true that JS engines like v8 tend to, for performance optimization reasons, special-case object properties that are numeric-looking strings as actually being stored in numeric positions as if they were arrays. So even if the JS program acts as if the property name is <code>"3"</code>, in fact under the covers, v8 might be treating it as if coerced to <code>3</code>!</p>
<p>What can take from all this?</p>
<p>The specification clearly tells us that the behavior of object properties is for them to be treated like strings (or symbols). That means we can assume that using <code>3</code> to access a location on an object will have the internal effect of coercing that property name to <code>"3"</code>.</p>
<p>But with arrays, we observe a sort of opposite semantic: using <code>"3"</code> as a property name has the effect of accessing the numerically indexed <code>3</code> position, as if the string was coerced to the number. But that's mostly just an offshot of the fact that arrays always tend to behave as numerically indexed, and/or perhaps a reflection of underlying implementation/optimization details in the JS engine.</p>
<p>The important part is, we need to recognize that objects cannot simply use any value as a property name. If it's anything other than a string or a number, we can expect that there <em>will be</em> a coercion of that value.</p>
<p>We need to expect and plan for that rather than allowing it to surprise us with bugs down the road!</p>
<h3 id="to-primitive">To Primitive<a class="headerlink" href="#to-primitive" title="Permanent link">¶</a></h3>
<p>Most operators in JS, including those we've seen with coercions to <code>string</code> and <code>number</code>, are designed to run against primitive values. When any of these operators is used instead against an object value, the abstract <code>ToPrimitive</code> algorithm (as described earlier) is activated to coerce the object to a primitive.</p>
<p>Let's set up an object we can use to inspect how different operations behave:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="nx">spyObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="w">    </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-51-3" id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"toString() invoked!"</span><span class="p">);</span>
<a href="#__codelineno-51-4" id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s2">"10"</span><span class="p">;</span>
<a href="#__codelineno-51-5" id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-51-6" id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="w">    </span><span class="nx">valueOf</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-51-7" id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"valueOf() invoked!"</span><span class="p">);</span>
<a href="#__codelineno-51-8" id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span>
<a href="#__codelineno-51-9" id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-51-10" id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="p">};</span>
</code></pre></div>
<p>This object defines both the <code>toString()</code> and <code>valueOf()</code> methods, and each one returns a different type of value (<code>string</code> vs <code>number</code>).</p>
<p>Let's try some of the coercion operations we've already seen:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-52-1" id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="nb">String</span><span class="p">(</span><span class="nx">spyObject</span><span class="p">);</span>
<a href="#__codelineno-52-2" id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="c1">// toString() invoked!</span>
<a href="#__codelineno-52-3" id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="c1">// "10"</span>
<a href="#__codelineno-52-4" id="__codelineno-52-4" name="__codelineno-52-4"></a>
<a href="#__codelineno-52-5" id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="nx">spyObject</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span>
<a href="#__codelineno-52-6" id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-52-7" id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="c1">// "42"</span>
</code></pre></div>
<p>Whoa! I bet that surprised a few of you readers; it certainly did me. It's so common for people to assert that <code>String(..)</code> and <code>+ ""</code> are equivalent forms of activating the <code>ToString()</code> operation. But they're clearly not!</p>
<p>The difference comes down to the <em>hint</em> that each operation provides to <code>ToPrimitive()</code>. <code>String(..)</code> clearly provides <code>"string"</code> as the <em>hint</em>, whereas the <code>+ ""</code> idiom provides no <em>hint</em> (similar to <em>hinting</em> <code>"number"</code>). But don't miss this detail: even though <code>+ ""</code> invokes <code>valueOf()</code>, when that returns a <code>number</code> primitive value of <code>42</code>, that value is then coerced to a string (via <code>ToString()</code>), so we get <code>"42"</code> instead of <code>42</code>.</p>
<p>Let's keep going:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-53-1" id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="nb">Number</span><span class="p">(</span><span class="nx">spyObject</span><span class="p">);</span>
<a href="#__codelineno-53-2" id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-53-3" id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="c1">// 42</span>
<a href="#__codelineno-53-4" id="__codelineno-53-4" name="__codelineno-53-4"></a>
<a href="#__codelineno-53-5" id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="o">+</span><span class="nx">spyObject</span><span class="p">;</span>
<a href="#__codelineno-53-6" id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-53-7" id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="c1">// 42</span>
</code></pre></div>
<p>This example implies that <code>Number(..)</code> and the unary <code>+</code> operator both perform the same <code>ToPrimitive()</code> coercion (with <em>hint</em> of <code>"number"</code>), which in our case returns <code>42</code>. Since that's already a <code>number</code> as requested, the value comes out without further ado.</p>
<p>But what if a <code>valueOf()</code> returns a <code>bigint</code>?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-54-1" id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="nx">spyObject2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-54-2" id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="w">    </span><span class="nx">valueOf</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-54-3" id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"valueOf() invoked!"</span><span class="p">);</span>
<a href="#__codelineno-54-4" id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">42n</span><span class="p">;</span><span class="w">  </span><span class="c1">// bigint!</span>
<a href="#__codelineno-54-5" id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-54-6" id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="p">};</span>
<a href="#__codelineno-54-7" id="__codelineno-54-7" name="__codelineno-54-7"></a>
<a href="#__codelineno-54-8" id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="nb">Number</span><span class="p">(</span><span class="nx">spyObject2</span><span class="p">);</span>
<a href="#__codelineno-54-9" id="__codelineno-54-9" name="__codelineno-54-9"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-54-10" id="__codelineno-54-10" name="__codelineno-54-10"></a><span class="c1">// 42     &lt;--- look, not a bigint!</span>
<a href="#__codelineno-54-11" id="__codelineno-54-11" name="__codelineno-54-11"></a>
<a href="#__codelineno-54-12" id="__codelineno-54-12" name="__codelineno-54-12"></a><span class="o">+</span><span class="nx">spyObject2</span><span class="p">;</span>
<a href="#__codelineno-54-13" id="__codelineno-54-13" name="__codelineno-54-13"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-54-14" id="__codelineno-54-14" name="__codelineno-54-14"></a><span class="c1">// TypeError: Cannot convert a BigInt value to a number</span>
</code></pre></div>
<p>We saw this difference earlier in the "To Number" section. JS allows an <em>explicit</em> coercion of the <code>42n</code> bigint value to the <code>42</code> number value, but it disallows what it considers to be an <em>implicit</em> coercion form.</p>
<p>What about the <code>BigInt(..)</code> (no <code>new</code> keyword) coercion function?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-55-1" id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="nb">BigInt</span><span class="p">(</span><span class="nx">spyObject</span><span class="p">);</span>
<a href="#__codelineno-55-2" id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-55-3" id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="c1">// 42n    &lt;--- look, a bigint!</span>
<a href="#__codelineno-55-4" id="__codelineno-55-4" name="__codelineno-55-4"></a>
<a href="#__codelineno-55-5" id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="nb">BigInt</span><span class="p">(</span><span class="nx">spyObject2</span><span class="p">);</span>
<a href="#__codelineno-55-6" id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-55-7" id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="c1">// 42n</span>
<a href="#__codelineno-55-8" id="__codelineno-55-8" name="__codelineno-55-8"></a>
<a href="#__codelineno-55-9" id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="c1">// *******************************</span>
<a href="#__codelineno-55-10" id="__codelineno-55-10" name="__codelineno-55-10"></a>
<a href="#__codelineno-55-11" id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="nx">spyObject3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-55-12" id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="w">    </span><span class="nx">valueOf</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-55-13" id="__codelineno-55-13" name="__codelineno-55-13"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"valueOf() invoked!"</span><span class="p">);</span>
<a href="#__codelineno-55-14" id="__codelineno-55-14" name="__codelineno-55-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">42.3</span><span class="p">;</span>
<a href="#__codelineno-55-15" id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-55-16" id="__codelineno-55-16" name="__codelineno-55-16"></a><span class="p">};</span>
<a href="#__codelineno-55-17" id="__codelineno-55-17" name="__codelineno-55-17"></a>
<a href="#__codelineno-55-18" id="__codelineno-55-18" name="__codelineno-55-18"></a><span class="nb">BigInt</span><span class="p">(</span><span class="nx">spyObject3</span><span class="p">);</span>
<a href="#__codelineno-55-19" id="__codelineno-55-19" name="__codelineno-55-19"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-55-20" id="__codelineno-55-20" name="__codelineno-55-20"></a><span class="c1">// RangeError: The number 42.3 cannot be converted to a BigInt</span>
</code></pre></div>
<p>Again, as we saw in the "To Number" section, <code>42</code> can safely be coerced to <code>42n</code>. On the other hand, <code>42.3</code> cannot safely be coerced to a <code>bigint</code>.</p>
<p>We've seen that <code>toString()</code> and <code>valueOf()</code> are invoked, variously, as certain <code>string</code> and <code>number</code> / <code>bigint</code> coercions are performed.</p>
<h4 id="no-primitive-found">No Primitive Found?<a class="headerlink" href="#no-primitive-found" title="Permanent link">¶</a></h4>
<p>If <code>ToPrimitive()</code> fails to produce a primitive value, an exception will be thrown:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-56-1" id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="nx">spyObject4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-56-2" id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="w">    </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-56-3" id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"toString() invoked!"</span><span class="p">);</span>
<a href="#__codelineno-56-4" id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
<a href="#__codelineno-56-5" id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-56-6" id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="w">    </span><span class="nx">valueOf</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-56-7" id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"valueOf() invoked!"</span><span class="p">);</span>
<a href="#__codelineno-56-8" id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-56-9" id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-56-10" id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="p">};</span>
<a href="#__codelineno-56-11" id="__codelineno-56-11" name="__codelineno-56-11"></a>
<a href="#__codelineno-56-12" id="__codelineno-56-12" name="__codelineno-56-12"></a><span class="nb">String</span><span class="p">(</span><span class="nx">spyObject4</span><span class="p">);</span>
<a href="#__codelineno-56-13" id="__codelineno-56-13" name="__codelineno-56-13"></a><span class="c1">// toString() invoked!</span>
<a href="#__codelineno-56-14" id="__codelineno-56-14" name="__codelineno-56-14"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-56-15" id="__codelineno-56-15" name="__codelineno-56-15"></a><span class="c1">// TypeError: Cannot convert object to primitive value</span>
<a href="#__codelineno-56-16" id="__codelineno-56-16" name="__codelineno-56-16"></a>
<a href="#__codelineno-56-17" id="__codelineno-56-17" name="__codelineno-56-17"></a><span class="nb">Number</span><span class="p">(</span><span class="nx">spyObject4</span><span class="p">);</span>
<a href="#__codelineno-56-18" id="__codelineno-56-18" name="__codelineno-56-18"></a><span class="c1">// valueOf() invoked!</span>
<a href="#__codelineno-56-19" id="__codelineno-56-19" name="__codelineno-56-19"></a><span class="c1">// toString() invoked!</span>
<a href="#__codelineno-56-20" id="__codelineno-56-20" name="__codelineno-56-20"></a><span class="c1">// TypeError: Cannot convert object to primitive value</span>
</code></pre></div>
<p>If you're going to define custom to-primitive coercions via <code>toString()</code> / <code>valueOf()</code>, make sure to return a primitive from at least one of them!</p>
<h4 id="object-to-boolean">Object To Boolean<a class="headerlink" href="#object-to-boolean" title="Permanent link">¶</a></h4>
<p>What about <code>boolean</code> coercions of objects?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-57-1" id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="nb">Boolean</span><span class="p">(</span><span class="nx">spyObject</span><span class="p">);</span>
<a href="#__codelineno-57-2" id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="c1">// true</span>
<a href="#__codelineno-57-3" id="__codelineno-57-3" name="__codelineno-57-3"></a>
<a href="#__codelineno-57-4" id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="o">!</span><span class="nx">spyObject</span><span class="p">;</span>
<a href="#__codelineno-57-5" id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="c1">// false</span>
<a href="#__codelineno-57-6" id="__codelineno-57-6" name="__codelineno-57-6"></a>
<a href="#__codelineno-57-7" id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">spyObject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-57-8" id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"if!"</span><span class="p">);</span>
<a href="#__codelineno-57-9" id="__codelineno-57-9" name="__codelineno-57-9"></a><span class="p">}</span>
<a href="#__codelineno-57-10" id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="c1">// if!</span>
<a href="#__codelineno-57-11" id="__codelineno-57-11" name="__codelineno-57-11"></a>
<a href="#__codelineno-57-12" id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">spyObject</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">"ternary!"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">"nope"</span><span class="p">;</span>
<a href="#__codelineno-57-13" id="__codelineno-57-13" name="__codelineno-57-13"></a><span class="c1">// "ternary!"</span>
<a href="#__codelineno-57-14" id="__codelineno-57-14" name="__codelineno-57-14"></a>
<a href="#__codelineno-57-15" id="__codelineno-57-15" name="__codelineno-57-15"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">spyObject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-57-16" id="__codelineno-57-16" name="__codelineno-57-16"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"while!"</span><span class="p">);</span>
<a href="#__codelineno-57-17" id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="w">    </span><span class="k">break</span><span class="p">;</span>
<a href="#__codelineno-57-18" id="__codelineno-57-18" name="__codelineno-57-18"></a><span class="p">}</span>
<a href="#__codelineno-57-19" id="__codelineno-57-19" name="__codelineno-57-19"></a><span class="c1">// while!</span>
</code></pre></div>
<p>Each of these are activating <code>ToBoolean()</code>. But if you recall from earlier, <em>that</em> algorithm never delegates to <code>ToPrimitive()</code>; thus, we don't see "valueOf() invoked!" being logged out.</p>
<h4 id="unboxing-wrapper-to-primitive">Unboxing: Wrapper To Primitive<a class="headerlink" href="#unboxing-wrapper-to-primitive" title="Permanent link">¶</a></h4>
<p>A special form of objects that are often <code>ToPrimitive()</code> coerced: boxed/wrapped primitives (as seen in Chapter 3). This particular object-to-primitive coercion is often referred to as <em>unboxing</em>.</p>
<p>Consider:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-58-1" id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="nx">hello</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">String</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">);</span>
<a href="#__codelineno-58-2" id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="nb">String</span><span class="p">(</span><span class="nx">hello</span><span class="p">);</span><span class="w">                  </span><span class="c1">// "hello"</span>
<a href="#__codelineno-58-3" id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="nx">hello</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span><span class="w">                     </span><span class="c1">// "hello"</span>
<a href="#__codelineno-58-4" id="__codelineno-58-4" name="__codelineno-58-4"></a>
<a href="#__codelineno-58-5" id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="nx">fortyOne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="mf">41</span><span class="p">);</span>
<a href="#__codelineno-58-6" id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="nb">Number</span><span class="p">(</span><span class="nx">fortyOne</span><span class="p">);</span><span class="w">               </span><span class="c1">// 41</span>
<a href="#__codelineno-58-7" id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="nx">fortyOne</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w">                   </span><span class="c1">// 42</span>
</code></pre></div>
<p>The object wrappers <code>hello</code> and <code>fortyOne</code> above have <code>toString()</code> and <code>valueOf()</code> methods configured on them, to behave similarly to the <code>spyObject</code> / etc objects from our previous examples.</p>
<p>A special case to be careful of with wrapped-object primitives is with <code>Boolean()</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-59-1" id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="nx">nope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a href="#__codelineno-59-2" id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="nb">Boolean</span><span class="p">(</span><span class="nx">nope</span><span class="p">);</span><span class="w">                  </span><span class="c1">// true   &lt;--- oops!</span>
<a href="#__codelineno-59-3" id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="o">!!</span><span class="nx">nope</span><span class="p">;</span><span class="w">                         </span><span class="c1">// true   &lt;--- oops!</span>
</code></pre></div>
<p>Remember, this is because <code>ToBoolean()</code> does <em>not</em> reduce an object to its primitive form with <code>ToPrimitive</code>; it merely looks up the value in its internal table, and since normal (non-exotic<sup id="fnref:ExoticFalsyObjects"><a class="footnote-ref" href="#fn:ExoticFalsyObjects">7</a></sup>) objects are always truthy, <code>true</code> comes out.</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">It's a nasty little gotcha. A case could certainly be made that <code>new Boolean(false)</code> should configure itself internally as an exotic "falsy object". <sup id="fnref2:ExoticFalsyObjects"><a class="footnote-ref" href="#fn:ExoticFalsyObjects">7</a></sup> Unfortunately, that change now, 25 years into JS's history, could easily create breakage in programs. As such, JS has left this gotcha untouched.</td>
</tr>
</tbody>
</table>
<h4 id="overriding-default-tostring">Overriding Default <code>toString()</code><a class="headerlink" href="#overriding-default-tostring" title="Permanent link">¶</a></h4>
<p>As we've seen, you can always define a <code>toString()</code> on an object to have <em>it</em> invoked by the appropriate <code>ToPrimitive()</code> coercion. But another option is to override the <code>Symbol.toStringTag</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-60-1" id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="nx">spyObject5a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<a href="#__codelineno-60-2" id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="nb">String</span><span class="p">(</span><span class="nx">spyObject5a</span><span class="p">);</span>
<a href="#__codelineno-60-3" id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="c1">// "[object Object]"</span>
<a href="#__codelineno-60-4" id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="nx">spyObject5a</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<a href="#__codelineno-60-5" id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="c1">// "[object Object]"</span>
<a href="#__codelineno-60-6" id="__codelineno-60-6" name="__codelineno-60-6"></a>
<a href="#__codelineno-60-7" id="__codelineno-60-7" name="__codelineno-60-7"></a><span class="nx">spyObject5b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-60-8" id="__codelineno-60-8" name="__codelineno-60-8"></a><span class="w">    </span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="s2">"my-spy-object"</span>
<a href="#__codelineno-60-9" id="__codelineno-60-9" name="__codelineno-60-9"></a><span class="p">};</span>
<a href="#__codelineno-60-10" id="__codelineno-60-10" name="__codelineno-60-10"></a><span class="nb">String</span><span class="p">(</span><span class="nx">spyObject5b</span><span class="p">);</span>
<a href="#__codelineno-60-11" id="__codelineno-60-11" name="__codelineno-60-11"></a><span class="c1">// "[object my-spy-object]"</span>
<a href="#__codelineno-60-12" id="__codelineno-60-12" name="__codelineno-60-12"></a><span class="nx">spyObject5b</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<a href="#__codelineno-60-13" id="__codelineno-60-13" name="__codelineno-60-13"></a><span class="c1">// "[object my-spy-object]"</span>
<a href="#__codelineno-60-14" id="__codelineno-60-14" name="__codelineno-60-14"></a>
<a href="#__codelineno-60-15" id="__codelineno-60-15" name="__codelineno-60-15"></a><span class="nx">spyObject5c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-60-16" id="__codelineno-60-16" name="__codelineno-60-16"></a><span class="w">    </span><span class="nx">get</span><span class="w"> </span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-60-17" id="__codelineno-60-17" name="__codelineno-60-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="sb">`myValue:</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">myValue</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<a href="#__codelineno-60-18" id="__codelineno-60-18" name="__codelineno-60-18"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-60-19" id="__codelineno-60-19" name="__codelineno-60-19"></a><span class="w">    </span><span class="nx">myValue</span><span class="o">:</span><span class="w"> </span><span class="mf">42</span>
<a href="#__codelineno-60-20" id="__codelineno-60-20" name="__codelineno-60-20"></a><span class="p">};</span>
<a href="#__codelineno-60-21" id="__codelineno-60-21" name="__codelineno-60-21"></a><span class="nb">String</span><span class="p">(</span><span class="nx">spyObject5c</span><span class="p">);</span>
<a href="#__codelineno-60-22" id="__codelineno-60-22" name="__codelineno-60-22"></a><span class="c1">// "[object myValue:42]"</span>
<a href="#__codelineno-60-23" id="__codelineno-60-23" name="__codelineno-60-23"></a><span class="nx">spyObject5c</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
<a href="#__codelineno-60-24" id="__codelineno-60-24" name="__codelineno-60-24"></a><span class="c1">// "[object myValue:42]"</span>
</code></pre></div>
<p><code>Symbol.toStringTag</code> is intended to define a custom string value to describe the object whenever its default <code>toString()</code> operation is invoked directly, or implicitly via coercion; in its absence, the value used is <code>"Object"</code> in the common <code>"[object Object]"</code> output.</p>
<p>The <code>get ..</code> syntax in <code>spyObject5c</code> is defining a <em>getter</em>. That means when JS tries to access this <code>Symbol.toStringTag</code> as a property (as normal), this gettter code instead causes the function we specify to be invoked to compute the result. We can run any arbitrary logic inside this getter to dynamically determine a string <em>tag</em> for use by the default <code>toString()</code> method.</p>
<h4 id="overriding-toprimitive">Overriding <code>ToPrimitive</code><a class="headerlink" href="#overriding-toprimitive" title="Permanent link">¶</a></h4>
<p>You can alternately override the whole default <code>ToPrimitive()</code> operation for any object, by setting the special symbol property <code>Symbol.toPrimitive</code> to hold a function:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-61-1" id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="nx">spyObject6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-61-2" id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="w">    </span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">toPrimitive</span><span class="p">](</span><span class="nx">hint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-61-3" id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`toPrimitive(</span><span class="si">${</span><span class="nx">hint</span><span class="si">}</span><span class="sb">) invoked!`</span><span class="p">);</span>
<a href="#__codelineno-61-4" id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">25</span><span class="p">;</span>
<a href="#__codelineno-61-5" id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-61-6" id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">    </span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-61-7" id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"toString() invoked!"</span><span class="p">);</span>
<a href="#__codelineno-61-8" id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s2">"10"</span><span class="p">;</span>
<a href="#__codelineno-61-9" id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-61-10" id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="w">    </span><span class="nx">valueOf</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-61-11" id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"valueOf() invoked!"</span><span class="p">);</span>
<a href="#__codelineno-61-12" id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">42</span><span class="p">;</span>
<a href="#__codelineno-61-13" id="__codelineno-61-13" name="__codelineno-61-13"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-61-14" id="__codelineno-61-14" name="__codelineno-61-14"></a><span class="p">};</span>
<a href="#__codelineno-61-15" id="__codelineno-61-15" name="__codelineno-61-15"></a>
<a href="#__codelineno-61-16" id="__codelineno-61-16" name="__codelineno-61-16"></a><span class="nb">String</span><span class="p">(</span><span class="nx">spyObject6</span><span class="p">);</span>
<a href="#__codelineno-61-17" id="__codelineno-61-17" name="__codelineno-61-17"></a><span class="c1">// toPrimitive(string) invoked!</span>
<a href="#__codelineno-61-18" id="__codelineno-61-18" name="__codelineno-61-18"></a><span class="c1">// "25"   &lt;--- not "10"</span>
<a href="#__codelineno-61-19" id="__codelineno-61-19" name="__codelineno-61-19"></a>
<a href="#__codelineno-61-20" id="__codelineno-61-20" name="__codelineno-61-20"></a><span class="nx">spyObject6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">""</span><span class="p">;</span>
<a href="#__codelineno-61-21" id="__codelineno-61-21" name="__codelineno-61-21"></a><span class="c1">// toPrimitive(default) invoked!</span>
<a href="#__codelineno-61-22" id="__codelineno-61-22" name="__codelineno-61-22"></a><span class="c1">// "25"   &lt;--- not "42"</span>
<a href="#__codelineno-61-23" id="__codelineno-61-23" name="__codelineno-61-23"></a>
<a href="#__codelineno-61-24" id="__codelineno-61-24" name="__codelineno-61-24"></a><span class="nb">Number</span><span class="p">(</span><span class="nx">spyObject6</span><span class="p">);</span>
<a href="#__codelineno-61-25" id="__codelineno-61-25" name="__codelineno-61-25"></a><span class="c1">// toPrimitive(number) invoked!</span>
<a href="#__codelineno-61-26" id="__codelineno-61-26" name="__codelineno-61-26"></a><span class="c1">// 25     &lt;--- not 42 or "25"</span>
<a href="#__codelineno-61-27" id="__codelineno-61-27" name="__codelineno-61-27"></a>
<a href="#__codelineno-61-28" id="__codelineno-61-28" name="__codelineno-61-28"></a><span class="o">+</span><span class="nx">spyObject6</span><span class="p">;</span>
<a href="#__codelineno-61-29" id="__codelineno-61-29" name="__codelineno-61-29"></a><span class="c1">// toPrimitive(number) invoked!</span>
<a href="#__codelineno-61-30" id="__codelineno-61-30" name="__codelineno-61-30"></a><span class="c1">// 25</span>
</code></pre></div>
<p>As you can see, if you define this function on an object, it's used entirely in replacement of the default <code>ToPrimitive()</code> abstract operation. Since <code>hint</code> is still provided to this invoked function (<code>[Symbol.toPrimitive](..)</code>), you could in theory implement your own version of the algorithm, invoking a <code>toString()</code>, <code>valueOf()</code>, or any other method on the object (<code>this</code> context reference).</p>
<p>Or you can just manually define a return value as shown above. Regardless, JS will <em>not</em> automatically invoke either <code>toString()</code> or <code>valueOf()</code> methods.</p>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">As discussed prior in "No Primitive Found?", if the defined <code>Symbol.toPrimitive</code> function does not actually return a value that's a primitive, an exception will be thrown about being unable to "...convert object to primitive value". Make sure to always return an actual primitive value from such a function!</td>
</tr>
</tbody>
</table>
<h3 id="equality">Equality<a class="headerlink" href="#equality" title="Permanent link">¶</a></h3>
<p>Thus far, the coercions we've seen have been focused on single values. We turn out attention now to equality comparisons, which inherently involve two values, either or both of which may be subject to coercion.</p>
<p>Earlier in this chapter, we talked about several abstract operations for value equality comparison.</p>
<p>For example, the <code>SameValue()</code> operation<sup id="fnref2:SameValue"><a class="footnote-ref" href="#fn:SameValue">16</a></sup> is the strictest of the equality comparisons, with absolutely no coercion. The most obvious JS operation that relies on <code>SameValue()</code> is:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-62-1" id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="mf">42</span><span class="p">,</span><span class="mf">42</span><span class="p">);</span><span class="w">                   </span><span class="c1">// true</span>
<a href="#__codelineno-62-2" id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="o">-</span><span class="mf">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0</span><span class="p">);</span><span class="w">                   </span><span class="c1">// true</span>
<a href="#__codelineno-62-3" id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="kc">NaN</span><span class="p">,</span><span class="kc">NaN</span><span class="p">);</span><span class="w">                 </span><span class="c1">// true</span>
<a href="#__codelineno-62-4" id="__codelineno-62-4" name="__codelineno-62-4"></a>
<a href="#__codelineno-62-5" id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0</span><span class="p">);</span><span class="w">                    </span><span class="c1">// false</span>
</code></pre></div>
<p>The <code>SameValueZero()</code> operation -- recall, it only differs from <code>SameValue()</code> by treating <code>-0</code> and <code>0</code> as indistinguishable -- is used in quite a few more places, including:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-63-1" id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="p">[</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="kc">NaN</span><span class="w"> </span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="kc">NaN</span><span class="p">);</span><span class="w">        </span><span class="c1">// true</span>
</code></pre></div>
<p>We can see the <code>0</code> / <code>-0</code> misdirection of <code>SameValueZero()</code> here:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-64-1" id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="p">[</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0</span><span class="w"> </span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span><span class="w">           </span><span class="c1">// true  &lt;--- oops!</span>
<a href="#__codelineno-64-2" id="__codelineno-64-2" name="__codelineno-64-2"></a>
<a href="#__codelineno-64-3" id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">([</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">])).</span><span class="nx">has</span><span class="p">(</span><span class="o">-</span><span class="mf">0</span><span class="p">);</span><span class="w">     </span><span class="c1">// true  &lt;--- ugh</span>
<a href="#__codelineno-64-4" id="__codelineno-64-4" name="__codelineno-64-4"></a>
<a href="#__codelineno-64-5" id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">([[</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">"ok"</span><span class="w"> </span><span class="p">]])).</span><span class="nx">has</span><span class="p">(</span><span class="o">-</span><span class="mf">0</span><span class="p">);</span><span class="w">   </span><span class="c1">// true  &lt;--- :(</span>
</code></pre></div>
<p>In these cases, there's a <em>coercion</em> (of sorts!) that treats <code>-0</code> and <code>0</code> as indistinguishable. No, that's not technically a "coercion" in that the type is not being changed, but I'm sort of fudging the definition to <em>include</em> this case in our broader discussion of coercion here.</p>
<p>Contrast the <code>includes()</code> / <code>has()</code> methods here, which activate <code>SameValueZero()</code>, with the good ol' <code>indexOf(..)</code> array utility, which instead activates <code>IsStrictlyEqual()</code> instead. This algorithm is slightly more "coercive" than <code>SameValueZero()</code>, in that it prevents <code>NaN</code> values from ever being treated as equal to each other:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-65-1" id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="p">[</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="kc">NaN</span><span class="w"> </span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="kc">NaN</span><span class="p">);</span><span class="w">         </span><span class="c1">// -1  &lt;--- not found</span>
</code></pre></div>
<p>If these nuanced quirks of <code>includes(..)</code> and <code>indexOf(..)</code> bother you, when searching -- looking for an equality match within -- for a value in an array, you can avoid any "coercive" quicks and <em>force</em> the strictest <code>SameValue()</code> equality matching, via <code>Object.is(..)</code>:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-66-1" id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="nx">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="kc">NaN</span><span class="w"> </span><span class="p">];</span>
<a href="#__codelineno-66-2" id="__codelineno-66-2" name="__codelineno-66-2"></a>
<a href="#__codelineno-66-3" id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="nx">vals</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="o">-</span><span class="mf">0</span><span class="p">));</span><span class="w">            </span><span class="c1">// -0</span>
<a href="#__codelineno-66-4" id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="nx">vals</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="kc">NaN</span><span class="p">));</span><span class="w">           </span><span class="c1">// NaN</span>
<a href="#__codelineno-66-5" id="__codelineno-66-5" name="__codelineno-66-5"></a>
<a href="#__codelineno-66-6" id="__codelineno-66-6" name="__codelineno-66-6"></a><span class="nx">vals</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="o">-</span><span class="mf">0</span><span class="p">));</span><span class="w">       </span><span class="c1">// 3</span>
<a href="#__codelineno-66-7" id="__codelineno-66-7" name="__codelineno-66-7"></a><span class="nx">vals</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="kc">NaN</span><span class="p">));</span><span class="w">      </span><span class="c1">// 4</span>
</code></pre></div>
<h4 id="equality-operators-vs">Equality Operators: <code>==</code> vs <code>===</code><a class="headerlink" href="#equality-operators-vs" title="Permanent link">¶</a></h4>
<p>The most obvious place where <em>coercion</em> is involved in equality checks is with the <code>==</code> operator. Despite any pre-conceived notions you may have about <code>==</code>, it behaves extremely predictably, ensuring that both operands match types before performing its equality check.</p>
<p>To state something that may or may not be super obvious: the <code>==</code> (and <code>===</code>) operators always return a <code>boolean</code> (<code>true</code> or <code>false</code>), indicating the result of the equality check; they never return anything else, regardless of what coercion may happen.</p>
<p>Now, recall and review the steps discussed earlier in the chapter for the <code>IsLooselyEqual()</code> operation. <sup id="fnref:LooseEquality"><a class="footnote-ref" href="#fn:LooseEquality">18</a></sup> Its behavior, and thus how <code>==</code> acts, can be pragmatically intuited with just these two facts in mind:</p>
<ol>
<li>
<p>If the types of both operands are the same, <code>==</code> has the exact same behavior as <code>===</code> -- <code>IsLooselyEqual()</code> immediately delegates to <code>IsStrictlyEqual()</code>. <sup id="fnref:StrictEquality"><a class="footnote-ref" href="#fn:StrictEquality">17</a></sup></p>
<p>For example, when both operands are object references:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-67-1" id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="nx">myObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-67-2" id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="nx">anotherObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">myObj</span><span class="p">;</span>
<a href="#__codelineno-67-3" id="__codelineno-67-3" name="__codelineno-67-3"></a>
<a href="#__codelineno-67-4" id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="nx">myObj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">anotherObj</span><span class="p">;</span><span class="w">                </span><span class="c1">// true</span>
<a href="#__codelineno-67-5" id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="nx">myObj</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">anotherObj</span><span class="p">;</span><span class="w">               </span><span class="c1">// true</span>
</code></pre></div>
<p>Here, <code>==</code> and <code>===</code> determine that both of their respective operands are of the <code>object</code> reference type, so both equality checks behave identically; they compare the object references for equality.</p>
</li>
<li>
<p>But if the operand types differ, <code>==</code> allows coercion until they match, and prefers numeric comparison; it attempts to coerce both operands to numbers, if possible:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-68-1" id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="mf">42</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"42"</span><span class="p">;</span><span class="w">                         </span><span class="c1">// true</span>
</code></pre></div>
<p>Here, the <code>"42"</code> string is coerced to a <code>42</code> number (not vice versa), and thus the comparison is then <code>42 == 42</code>, and must clearly return <code>true</code>.</p>
</li>
</ol>
<p>Armed with this knowledge, we'll now dispell the common myth that only <code>===</code> checks the type and value, while <code>==</code> checks only the value. Not true!</p>
<p>In fact, <code>==</code> and <code>===</code> are both type-sensitive, each checking the types of their operands. The <code>==</code> operator allows coercion of mismatched types, whereas <code>===</code> disallows any coercion.</p>
<p>It's a nearly universally held opinion that <code>==</code> should be avoided in favor of <code>===</code>. I may be one of the only developers who publicly advocates a clear and straight-faced case for the opposite. I think the main reason people instead prefer <code>===</code>, beyond simply conforming to the status quo, is a lack of taking the time to actually understand <code>==</code>.</p>
<p>I'll be revisiting this topic to make the case for preferring <code>==</code> over <code>===</code>, later in this chapter, in "Type Aware Equality". All I ask is, no matter how strongly you currently disagree with me, try to keep an open mindset.</p>
<h4 id="nullish-coercion">Nullish Coercion<a class="headerlink" href="#nullish-coercion" title="Permanent link">¶</a></h4>
<p>We've already seen a number of JS operations that are nullish -- treating <code>null</code> and <code>undefined</code> as coercively equal to each other, including the <code>?.</code> optional-chaining operator and the <code>??</code> nullish-coalescing operator (see "Null'ish" in Chapter 1).</p>
<p>But <code>==</code> is the most obvious place that JS exposes nullish coercive equality:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-69-1" id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span><span class="w">              </span><span class="c1">// true</span>
</code></pre></div>
<p>Neither <code>null</code> nor <code>undefined</code> will ever be coercively equal to any other value in the language, other than to each other. That means <code>==</code> makes it ergonomic to treat these two values as indistinguishable.</p>
<p>You might take advantage of this capability as such:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-70-1" id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">someData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-70-2" id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="w">    </span><span class="c1">// `someData` is "unset" (either null or undefined),</span>
<a href="#__codelineno-70-3" id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="w">    </span><span class="c1">// so set it to some default value</span>
<a href="#__codelineno-70-4" id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="p">}</span>
<a href="#__codelineno-70-5" id="__codelineno-70-5" name="__codelineno-70-5"></a>
<a href="#__codelineno-70-6" id="__codelineno-70-6" name="__codelineno-70-6"></a><span class="c1">// OR:</span>
<a href="#__codelineno-70-7" id="__codelineno-70-7" name="__codelineno-70-7"></a>
<a href="#__codelineno-70-8" id="__codelineno-70-8" name="__codelineno-70-8"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">someData</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-70-9" id="__codelineno-70-9" name="__codelineno-70-9"></a><span class="w">    </span><span class="c1">// `someData` is set (neither null nor undefined),</span>
<a href="#__codelineno-70-10" id="__codelineno-70-10" name="__codelineno-70-10"></a><span class="w">    </span><span class="c1">// so use it somehow</span>
<a href="#__codelineno-70-11" id="__codelineno-70-11" name="__codelineno-70-11"></a><span class="p">}</span>
</code></pre></div>
<p>Remember that <code>!=</code> is the negation of <code>==</code>, whereas <code>!==</code> is the negation of <code>===</code>. Don't match the count of <code>=</code>s unless you want to confuse yourself!</p>
<p>Compare these two approaches:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-71-1" id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">someData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-71-2" id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-71-3" id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="p">}</span>
<a href="#__codelineno-71-4" id="__codelineno-71-4" name="__codelineno-71-4"></a>
<a href="#__codelineno-71-5" id="__codelineno-71-5" name="__codelineno-71-5"></a><span class="c1">// vs:</span>
<a href="#__codelineno-71-6" id="__codelineno-71-6" name="__codelineno-71-6"></a>
<a href="#__codelineno-71-7" id="__codelineno-71-7" name="__codelineno-71-7"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">someData</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">someData</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-71-8" id="__codelineno-71-8" name="__codelineno-71-8"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-71-9" id="__codelineno-71-9" name="__codelineno-71-9"></a><span class="p">}</span>
</code></pre></div>
<p>Both <code>if</code> statements will behave exactly identically. Which one would you rather write, and which one would you rather read later?</p>
<p>To be fair, some of you prefer the more verbose <code>===</code> equivalent. And that's OK. I disagree, I think the <code>==</code> version of this check is <em>much</em> better. And I also maintain that the <code>==</code> version is more consistent in stylistic spirit with how the other nullish operators like <code>?.</code> and <code>??</code> act.</p>
<p>But another minor fact you might consider: in performance benchmarks I've run many times, JS engines can perform the single <code>== null</code> check as shown <em>slightly faster</em> than the combination of two <code>===</code> checks. In other words, there's a tiny but measurable benefit to letting JS's <code>==</code> perform the <em>implicit</em> nullish coercion than in trying to <em>explicitly</em> list out both checks yourself.</p>
<p>I'd observe that even many diehard <code>===</code> fans tend to concede that <code>== null</code> is at least one such case where <code>==</code> is preferable.</p>
<h4 id="boolean-gotcha"><code>==</code> Boolean Gotcha<a class="headerlink" href="#boolean-gotcha" title="Permanent link">¶</a></h4>
<p>Aside from some coercive corner cases we'll address in the next section, probably the biggest gotcha to be aware of with <code>==</code> has to do with booleans.</p>
<p>Pay very close attention here, as it's one of the biggest reasons people get bitten by, and then come to despise, <code>==</code>. If you take my simple advice (at the end of this section), you'll never be a victim!</p>
<p>Consider the following snippet, and let's assume for a minute that <code>isLoggedIn</code> is <em>not</em> holding a <code>boolean</code> value (<code>true</code> or <code>false</code>):</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-72-1" id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoggedIn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-72-2" id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-72-3" id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="p">}</span>
<a href="#__codelineno-72-4" id="__codelineno-72-4" name="__codelineno-72-4"></a>
<a href="#__codelineno-72-5" id="__codelineno-72-5" name="__codelineno-72-5"></a><span class="c1">// vs:</span>
<a href="#__codelineno-72-6" id="__codelineno-72-6" name="__codelineno-72-6"></a>
<a href="#__codelineno-72-7" id="__codelineno-72-7" name="__codelineno-72-7"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isLoggedIn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-72-8" id="__codelineno-72-8" name="__codelineno-72-8"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-72-9" id="__codelineno-72-9" name="__codelineno-72-9"></a><span class="p">}</span>
</code></pre></div>
<p>We've already covered the first <code>if</code> statement form. We know <code>if</code> expects a <code>boolean</code>, so in this case <code>isLoggedIn</code> will be coerced to a <code>boolean</code> using the lookup table in the <code>ToBoolean()</code> abstract operation. Pretty straightforward to predict, right?</p>
<p>But take a look at the <code>isLoggedIn == true</code> expression. Do you think it's going to behave the same way?</p>
<p>If your instinct was <em>yes</em>, you've just fallen into a tricky little trap. Recall early in this chapter when I warned that the rules of <code>ToBoolean()</code> coercion only apply if the JS operation is actually activating that algorithm. Here, it seems like JS must be doing so, because <code>== true</code> seems so clearly a "boolean related" type of comparison.</p>
<p>But nope. Go re-read the <code>IsLooselyEqual()</code> algorithm (for <code>==</code>) earlier in the chapter. Go on, I'll wait. If you don't like my summary, go read the specification algorithm<sup id="fnref2:LooseEquality"><a class="footnote-ref" href="#fn:LooseEquality">18</a></sup> itself.</p>
<p>OK, do you see anything in there that mentions invoking <code>ToBoolean()</code> under any circumstance?</p>
<p>Nope!</p>
<p>Remember: when the types of the two <code>==</code> operands are not the same, it prefers to coerce them both to numbers.</p>
<p>What might be in <code>isLoggedIn</code>, if it's not a <code>boolean</code>? Well, it could be a string value like <code>"yes"</code>, for example. In that form, <code>if ("yes") { .. }</code> would clearly pass the conditional check and execute the block.</p>
<p>But what's going to happen with the <code>==</code> form of the <code>if</code> conditional? It's going to act like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-73-1" id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="c1">// (1)</span>
<a href="#__codelineno-73-2" id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="s2">"yes"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span>
<a href="#__codelineno-73-3" id="__codelineno-73-3" name="__codelineno-73-3"></a>
<a href="#__codelineno-73-4" id="__codelineno-73-4" name="__codelineno-73-4"></a><span class="c1">// (2)</span>
<a href="#__codelineno-73-5" id="__codelineno-73-5" name="__codelineno-73-5"></a><span class="s2">"yes"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span>
<a href="#__codelineno-73-6" id="__codelineno-73-6" name="__codelineno-73-6"></a>
<a href="#__codelineno-73-7" id="__codelineno-73-7" name="__codelineno-73-7"></a><span class="c1">// (3)</span>
<a href="#__codelineno-73-8" id="__codelineno-73-8" name="__codelineno-73-8"></a><span class="kc">NaN</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span>
<a href="#__codelineno-73-9" id="__codelineno-73-9" name="__codelineno-73-9"></a>
<a href="#__codelineno-73-10" id="__codelineno-73-10" name="__codelineno-73-10"></a><span class="c1">// (4)</span>
<a href="#__codelineno-73-11" id="__codelineno-73-11" name="__codelineno-73-11"></a><span class="kc">NaN</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="w">           </span><span class="c1">// false</span>
</code></pre></div>
<p>So in other words, if <code>isLoggedIn</code> holds a value like <code>"yes"</code>, the <code>if (isLoggedIn) { .. }</code> block will pass the conditional check, but the <code>if (isLoggedIn == true)</code> check will not. Ugh!</p>
<p>What if <code>isLoggedIn</code> held the string <code>"true"</code>?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-74-1" id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="c1">// (1)</span>
<a href="#__codelineno-74-2" id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="s2">"true"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span>
<a href="#__codelineno-74-3" id="__codelineno-74-3" name="__codelineno-74-3"></a>
<a href="#__codelineno-74-4" id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="c1">// (2)</span>
<a href="#__codelineno-74-5" id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="s2">"true"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span>
<a href="#__codelineno-74-6" id="__codelineno-74-6" name="__codelineno-74-6"></a>
<a href="#__codelineno-74-7" id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="c1">// (3)</span>
<a href="#__codelineno-74-8" id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="kc">NaN</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span>
<a href="#__codelineno-74-9" id="__codelineno-74-9" name="__codelineno-74-9"></a>
<a href="#__codelineno-74-10" id="__codelineno-74-10" name="__codelineno-74-10"></a><span class="c1">// (4)</span>
<a href="#__codelineno-74-11" id="__codelineno-74-11" name="__codelineno-74-11"></a><span class="kc">NaN</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="w">           </span><span class="c1">// false</span>
</code></pre></div>
<p>Facepalm.</p>
<p>Here's a pop quiz: what value would <code>isLoggedIn</code> need to hold for both forms of the <code>if</code> statement conditional to pass?</p>
<p>...</p>
<p>...</p>
<p>...</p>
<p>...</p>
<p>What if <code>isLoggedIn</code> was holding the number <code>1</code>? <code>1</code> is truthy, so the <code>if (isLoggedIn)</code> form passes. And the other <code>==</code> form that involves coercion:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-75-1" id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="c1">// (1)</span>
<a href="#__codelineno-75-2" id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="mf">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span>
<a href="#__codelineno-75-3" id="__codelineno-75-3" name="__codelineno-75-3"></a>
<a href="#__codelineno-75-4" id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="c1">// (2)</span>
<a href="#__codelineno-75-5" id="__codelineno-75-5" name="__codelineno-75-5"></a><span class="mf">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span>
<a href="#__codelineno-75-6" id="__codelineno-75-6" name="__codelineno-75-6"></a>
<a href="#__codelineno-75-7" id="__codelineno-75-7" name="__codelineno-75-7"></a><span class="c1">// (3)</span>
<a href="#__codelineno-75-8" id="__codelineno-75-8" name="__codelineno-75-8"></a><span class="mf">1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="w">             </span><span class="c1">// true</span>
</code></pre></div>
<p>But if <code>isLoggedIn</code> was instead holding the string <code>"1"</code>? Again, <code>"1"</code> is truthy, but what about the <code>==</code> coercion?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-76-1" id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="c1">// (1)</span>
<a href="#__codelineno-76-2" id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="s2">"1"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span>
<a href="#__codelineno-76-3" id="__codelineno-76-3" name="__codelineno-76-3"></a>
<a href="#__codelineno-76-4" id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="c1">// (2)</span>
<a href="#__codelineno-76-5" id="__codelineno-76-5" name="__codelineno-76-5"></a><span class="s2">"1"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span>
<a href="#__codelineno-76-6" id="__codelineno-76-6" name="__codelineno-76-6"></a>
<a href="#__codelineno-76-7" id="__codelineno-76-7" name="__codelineno-76-7"></a><span class="c1">// (3)</span>
<a href="#__codelineno-76-8" id="__codelineno-76-8" name="__codelineno-76-8"></a><span class="mf">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span>
<a href="#__codelineno-76-9" id="__codelineno-76-9" name="__codelineno-76-9"></a>
<a href="#__codelineno-76-10" id="__codelineno-76-10" name="__codelineno-76-10"></a><span class="c1">// (4)</span>
<a href="#__codelineno-76-11" id="__codelineno-76-11" name="__codelineno-76-11"></a><span class="mf">1</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="w">             </span><span class="c1">// true</span>
</code></pre></div>
<p>OK, so <code>1</code> and <code>"1"</code> are two values that <code>isLoggedIn</code> can hold that are safe to coerce along with <code>true</code> in a <code>==</code> equality check. But basically almost no other values are safe for <code>isLoggedIn</code> to hold.</p>
<p>We have a similar gotcha if the check is <code>== false</code>. What values are safe in such a comparison? <code>""</code> and <code>0</code> work. But:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-77-1" id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="k">if</span><span class="w"> </span><span class="p">([]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-77-2" id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="w">    </span><span class="c1">// this will run!</span>
<a href="#__codelineno-77-3" id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="p">}</span>
</code></pre></div>
<p><code>[]</code> is a truthy value, but it's also coercively equal to <code>false</code>?! Ouch.</p>
<p>What are we to make of these gotchas with <code>== true</code> and <code>== false</code> checks? I have a plain and simple answer.</p>
<p>Never, ever, under any circumstances, perform a <code>==</code> check if either side of the comparison is a <code>true</code> or <code>false</code> value. It looks like it's going to behave as a nice <code>ToBoolean()</code> coercion, but it slyly won't, and will instead be ensnared in a variety of coercion corner cases (addressed in the next section). And avoid the <code>===</code> forms, too.</p>
<p>When you're dealing with booleans, stick to the implicitly coercive forms that are genuinely activating <code>ToBoolean()</code>, such as <code>if (isLoggedIn)</code>, and stay away from the <code>==</code> / <code>===</code> forms.</p>
<h2 id="coercion-corner-cases">Coercion Corner Cases<a class="headerlink" href="#coercion-corner-cases" title="Permanent link">¶</a></h2>
<p>I've been clear in expressing my pro-coercion opinion thus far. And it <em>is</em> just an opinion, though it's based on interpreting facts gleaned from studying the language specification and observable JS behaviors.</p>
<p>That's not to say that coercion is perfect. There's several frustrating corner cases we need to be aware of, so we avoid tripping into those potholes. In case it's not clear, my following characterizations of these corner cases are just more of my opinions. Your mileage may vary.</p>
<h3 id="strings">Strings<a class="headerlink" href="#strings" title="Permanent link">¶</a></h3>
<p>We already saw that the string coercion of an array looks like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-78-1" id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="nb">String</span><span class="p">([</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="p">]);</span><span class="w">                </span><span class="c1">// "1,2,3"</span>
</code></pre></div>
<p>I personally find that super annoying, that it doesn't include the surrounding <code>[ ]</code>. In particular, that leads to this absurdity:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-79-1" id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="nb">String</span><span class="p">([]);</span><span class="w">                         </span><span class="c1">// ""</span>
</code></pre></div>
<p>So we can't tell that it's even an array, because all we get is an empty string? Great, JS. That's just stupid. Sorry, but it is. And it gets worse:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-80-1" id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="nb">String</span><span class="p">([</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="p">]);</span><span class="w">        </span><span class="c1">// ","</span>
</code></pre></div>
<p>WAT!? We know that <code>null</code> coerces to the string <code>"null"</code>, and <code>undefined</code> coerces to the string <code>"undefined"</code>. But if those values are in an array, they magically just <em>disappear</em> as empty strings in the array-to-string coercion. Only the <code>","</code> remains to even hint to us there was anything at all in the array! That's just silly town, right there.</p>
<p>What about objects? Almost as aggravating, though in the opposite direction:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-81-1" id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="nb">String</span><span class="p">({});</span><span class="w">                         </span><span class="c1">// "[object Object]"</span>
<a href="#__codelineno-81-2" id="__codelineno-81-2" name="__codelineno-81-2"></a>
<a href="#__codelineno-81-3" id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="nb">String</span><span class="p">({</span><span class="w"> </span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">});</span><span class="w">                   </span><span class="c1">// "[object Object]"</span>
</code></pre></div>
<p>Umm... OK. Sure, thanks JS for no help at all in understanding what the object value is.</p>
<h3 id="numbers">Numbers<a class="headerlink" href="#numbers" title="Permanent link">¶</a></h3>
<p>I'm about to reveal what I think is <em>the</em> worst root of all coercion corner case evil. Are you ready for it?!?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-82-1" id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span><span class="w">                         </span><span class="c1">// 0</span>
<a href="#__codelineno-82-2" id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"       "</span><span class="p">);</span><span class="w">                  </span><span class="c1">// 0</span>
</code></pre></div>
<p>I'm still shaking my head at this one, and I've known about it for nearly 20 years. I still don't get what Brendan was thinking with this one.</p>
<p>The empty string is devoid of any contents; it has nothing in it with which to determine a numeric representation. <code>0</code> is absolutely <strong><em>NOT</em></strong> the numeric equivalent of missing/invalid numeric value. You know what number value we have that is well-suited to communicate that? <code>NaN</code>. Don't even get me started on how whitespace is stripped from strings when coercing to a number, so the very-much-not-empty <code>"       "</code> string is still treated the same as <code>""</code> for numeric coercion purposes.</p>
<p>Even worse, recall how <code>[]</code> coerces to the string <code>""</code>? By extension:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-83-1" id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="nb">Number</span><span class="p">([]);</span><span class="w">                         </span><span class="c1">// 0</span>
</code></pre></div>
<p>Doh! If <code>""</code> didn't coerce to <code>0</code> -- remember, this is the root of all coercion evil! --, then <code>[]</code> wouldn't coerce to <code>0</code> either.</p>
<p>This is just absurd, upside-down universe territory.</p>
<p>Much more tame, but still mildly annoying:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-84-1" id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"NaN"</span><span class="p">);</span><span class="w">                      </span><span class="c1">// NaN  &lt;--- accidental!</span>
<a href="#__codelineno-84-2" id="__codelineno-84-2" name="__codelineno-84-2"></a>
<a href="#__codelineno-84-3" id="__codelineno-84-3" name="__codelineno-84-3"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"Infinity"</span><span class="p">);</span><span class="w">                 </span><span class="c1">// Infinity</span>
<a href="#__codelineno-84-4" id="__codelineno-84-4" name="__codelineno-84-4"></a><span class="nb">Number</span><span class="p">(</span><span class="s2">"infinity"</span><span class="p">);</span><span class="w">                 </span><span class="c1">// NaN  &lt;--- oops, watch case!</span>
</code></pre></div>
<p>The string <code>"NaN"</code> is not parsed as a recognizable numeric value, so the coercion fails, producing (accidentally!) the <code>NaN</code> value. <code>"Infinity"</code> is explicitly parseable for the coercion, but any other casing, including <code>"infinity"</code>, will fail, again producing <code>NaN</code>.</p>
<p>This next example, you may not think is a corner case at all:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-85-1" id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="nb">Number</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w">                      </span><span class="c1">// 0</span>
<a href="#__codelineno-85-2" id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="nb">Number</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">                       </span><span class="c1">// 1</span>
</code></pre></div>
<p>It's merely programmer convention, legacy from languages that didn't originally have boolean <code>true</code> and <code>false</code> values, that we treat <code>0</code> as <code>false</code>, and <code>1</code> as <code>true</code>. But does it <em>really</em> make sense to go the other direction?</p>
<p>Think about it this way:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-86-1" id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="kc">false</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">        </span><span class="c1">// 2</span>
</code></pre></div>
<p>Really? I don't think there's any case where treating a <code>boolean</code> as its <code>number</code> equivalent makes any rational sense in a program. I can understand the reverse, for historical reasons: <code>Boolean(0)</code> and <code>Boolean(1)</code>.</p>
<p>But I genuniely feel that <code>Number(false)</code> and <code>Number(true)</code> (as well as any implicit coercion forms) should produce <code>NaN</code>, not <code>0</code> / <code>1</code>.</p>
<h3 id="coercion-absurdity">Coercion Absurdity<a class="headerlink" href="#coercion-absurdity" title="Permanent link">¶</a></h3>
<p>To prove my point, let's take the absurdity up to level 11:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-87-1" id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="p">[]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">!</span><span class="p">[];</span><span class="w">                          </span><span class="c1">// true</span>
</code></pre></div>
<p>How!? That seems beyond credibility that a value could be coercively equal to its negation, right!?</p>
<p>But follow down the coercion rabbit hole:</p>
<ol>
<li><code>[] == ![]</code></li>
<li><code>[] == false</code></li>
<li><code>"" == false</code></li>
<li><code>0 == false</code></li>
<li><code>0 == 0</code></li>
<li><code>0 === 0</code>  -&gt;  <code>true</code></li>
</ol>
<p>We've got three different absurdities conspiring against us: <code>String([])</code>, <code>Number("")</code>, and <code>Number(false)</code>; if any of these weren't true, this nonsense corner case outcome wouldn't occur.</p>
<p>Let me make something absolutely clear, though: none of this is <code>==</code>'s fault. It gets the blame here, of course. But the real culprits are the underlying <code>string</code> and <code>number</code> corner cases.</p>
<h2 id="type-awareness">Type Awareness<a class="headerlink" href="#type-awareness" title="Permanent link">¶</a></h2>
<p>We've now sliced and diced and examined coercion from every conceivable angle, starting from the abstract internals of the specification, then moving to the concrete expressions and statements that actually trigger the coercions.</p>
<p>But what's the point of all this? Is the detail in this chapter, and indeed this whole book up to this point, mostly just trivia? Eh, I don't think so.</p>
<p>Let's return to the observations/questions I posed way back at the beginning of this long chapter.</p>
<p>There's no shortage of opinions (especially negative) about coercion. The nearly universally held position is that coercion is mostly/entirely a <em>bad part</em> of JS's language design. But inspite of that reality, most every developer, in most every JS program ever written, faces the reality that coercion cannot be avoided.</p>
<p>In other words, no matter what you do, you won't be able to get away from the need to be aware of, understand, and manage JS's value-types and the conversions them. Contrary to common assumptions, embracing a dynamically-typed (or even a weakly-typed) language, does <em>not</em> mean being careless or unaware of types.</p>
<p>Type-aware programming is always, always better than type ignorant/agnostic programming.</p>
<h3 id="uhh-typescript">Uhh... TypeScript?<a class="headerlink" href="#uhh-typescript" title="Permanent link">¶</a></h3>
<p>Surely you're thinking at this moment: "Why can't I just use TypeScript and declare all my types statically, avoiding all the confusion of dynamic typing and coercion?"</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">I have many more detailed thoughts on TypeScript and the larger role it plays in our ecosystem; I'll save those opinions for the appendix ("Thoughts on TypeScript").</td>
</tr>
</tbody>
</table>
<p>Let's start by addressing head on the ways TypeScript does, and does not, aid in type-aware programming, as I'm advocating.</p>
<p>TypeScript is both <strong>statically-typed</strong> (meaning types are declared at author time and checked at compile-time) and <strong>strongly-typed</strong> (meaning variables/containers are typed, and these associations are enforced; strongly-typed systems also disallow <em>implicit</em> coercion). The greatest strength of TypeScript is that it typically forces both the author of the code, and the reader of the code, to confront the types comprising most (ideally, all!) of a program. That's definitely a good thing.</p>
<p>By contrast, JS is <strong>dynamically-typed</strong> (meaning types are discovered and managed purely at runtime) and <strong>weakly-typed</strong> (meaning variables/containers are not typed, so there's no associations to enforce, and variables can thus hold any value-types; weakly-typed systems allow any form of coercion).</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">I'm hand-waving at a pretty high level here, and intentionally not diving deeply into lots of nuance on the static/dynamic and strong/weak typing spectrums. If you're feeling the urge to "Well, actually..." me at this moment, please just hold on a bit and let me lay out my arguments.</td>
</tr>
</tbody>
</table>
<h3 id="type-awareness-without-typescript">Type-Awareness <em>Without</em> TypeScript<a class="headerlink" href="#type-awareness-without-typescript" title="Permanent link">¶</a></h3>
<p>Does a dynamically-typed system automatically mean you're programming with less type-awareness? Many would argue that, but I disagree.</p>
<p>I do not at all think that declaring static types (annotations, as in TypeScript) is the only way to accomplish effective type-awareness. Clearly, though, proponents of static-typing believe that is the <em>best</em> way.</p>
<p>Let me illustrate type-awareness without TypeScript's static typing. Consider this variable declaration:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-88-1" id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">API_BASE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://some.tld/api/2"</span><span class="p">;</span>
</code></pre></div>
<p>Is that statement in any way <em>type-aware</em>? Sure, there's no <code>: string</code> annotation after <code>API_BASE_URL</code>. But I definitely think it <em>is</em> still type-aware! We clearly see the value-type (<code>string</code>) of the value being assigned to <code>API_BASE_URL</code>.</p>
<table>
<thead>
<tr>
<th align="left">WARNING:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Don't get distracted by the <code>let</code> declaration being re-assignable (as opposed to a <code>const</code>). JS's <code>const</code> is <em>not</em> a first-class feature of its type system. We don't really gain additional type-awareness simply because we know that reassignment of a <code>const</code> variable is disallowed by the JS engine. If the code is structured well -- ahem, structured with type-awareness as a priority -- we can just read the code and see clearly that <code>API_BASE_URL</code> is <em>not</em> reassigned and is thus still the value-type it was previously assigned. From a type-awareness perspective, that's effectively the same thing as if it <em>couldn't</em> be reassigned.</td>
</tr>
</tbody>
</table>
<p>If I later want to do something like:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-89-1" id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="c1">// are we using the secure API URL?</span>
<a href="#__codelineno-89-2" id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="nx">isSecureAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^https/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">API_BASE_URL</span><span class="p">);</span>
</code></pre></div>
<p>I know the regular-expression <code>test(..)</code> method expects a string, and since I know <code>API_BASE_URL</code> is holding a string, I know that operation is type-safe.</p>
<p>Similarly, since I know the simple rules of <code>ToBoolean()</code> coercion as it relates to string values, I know this kind of statement is also type-safe:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-90-1" id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="c1">// do we have an API URL determined yet?</span>
<a href="#__codelineno-90-2" id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">API_BASE_URL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-90-3" id="__codelineno-90-3" name="__codelineno-90-3"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-90-4" id="__codelineno-90-4" name="__codelineno-90-4"></a><span class="p">}</span>
</code></pre></div>
<p>But if later, I start to type something like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-91-1" id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="nx">APIVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">API_BASE_URL</span><span class="p">);</span>
</code></pre></div>
<p>A warning siren triggers in my head. Since I know there's some very specific rules about how string values coerce to numbers, I recognize that this operation is <strong>not</strong> type-safe. So I instead approach it differently:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-92-1" id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="c1">// pull out the version number from API URL</span>
<a href="#__codelineno-92-2" id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="nx">versionDigit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">API_BASE_URL</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\/api\/(\d+)$/</span><span class="p">)[</span><span class="mf">1</span><span class="p">];</span>
<a href="#__codelineno-92-3" id="__codelineno-92-3" name="__codelineno-92-3"></a>
<a href="#__codelineno-92-4" id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="c1">// make sure the version is actually a number</span>
<a href="#__codelineno-92-5" id="__codelineno-92-5" name="__codelineno-92-5"></a><span class="nx">APIVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">versionDigit</span><span class="p">);</span>
</code></pre></div>
<p>I know that <code>API_BASE_URL</code> is a string, and I further know the format of its contents includes <code>".../api/{digits}"</code> at the end. That lets me know that the regular expression match will succeed, so the <code>[1]</code> array accesss is type-safe.</p>
<p>I also know that <code>versionDigit</code> will hold a string, because that's what regular-expression matches return. Now, I know it's safe to coerce that numeric-digit string into a number with <code>Number(..)</code>.</p>
<p>By my definition, that kind of thinking, and that style of coding, is type-aware. Type-awareness in coding means thinking carefully about whether or not such things will be <em>clear</em> and <em>obvious</em> to the reader of the code.</p>
<h3 id="type-awareness-with-typescript">Type-Awareness <em>With</em> TypeScript<a class="headerlink" href="#type-awareness-with-typescript" title="Permanent link">¶</a></h3>
<p>TypeScript fans will point out that TypeScript can, via type inference, do static typing (enforcement) without ever needing a single type annotation in the program. So all the code examples I shared in the previous section, TypeScript can also handle, and provide its flavor of compile-time static type enforcement.</p>
<p>In other words, TypeScript will give us the same kind of benefit in type checking, whichever of these two we write:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-93-1" id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">API_BASE_URL</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://some.tld/api/2"</span><span class="p">;</span>
<a href="#__codelineno-93-2" id="__codelineno-93-2" name="__codelineno-93-2"></a>
<a href="#__codelineno-93-3" id="__codelineno-93-3" name="__codelineno-93-3"></a><span class="c1">// vs:</span>
<a href="#__codelineno-93-4" id="__codelineno-93-4" name="__codelineno-93-4"></a>
<a href="#__codelineno-93-5" id="__codelineno-93-5" name="__codelineno-93-5"></a><span class="kd">let</span><span class="w"> </span><span class="nx">API_BASE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://some.tld/api/2"</span><span class="p">;</span>
</code></pre></div>
<p>But there's no free-lunch. We have some issues we need to confront. First of all, TypeScript does <em>not</em> trigger an error here:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-94-1" id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="nx">API_BASE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://some.tld/api/2"</span><span class="p">;</span>
<a href="#__codelineno-94-2" id="__codelineno-94-2" name="__codelineno-94-2"></a>
<a href="#__codelineno-94-3" id="__codelineno-94-3" name="__codelineno-94-3"></a><span class="nx">APIVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">API_BASE_URL</span><span class="p">);</span>
<a href="#__codelineno-94-4" id="__codelineno-94-4" name="__codelineno-94-4"></a><span class="c1">// NaN</span>
</code></pre></div>
<p>Intuitively, <em>I</em> want a type-aware system to understand why that's unsafe. But maybe that's just too much to ask. Or perhaps if we actually define a more narrow/specific type for that <code>API_BASE_URL</code> variable, than simply <code>string</code>, it might help? We can use a TypeScript trick called "Template Literal Types": <sup id="fnref:TSLiteralTypes"><a class="footnote-ref" href="#fn:TSLiteralTypes">28</a></sup></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-95-1" id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">VersionedURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`https://some.tld/api/</span><span class="si">${</span><span class="kt">number</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<a href="#__codelineno-95-2" id="__codelineno-95-2" name="__codelineno-95-2"></a>
<a href="#__codelineno-95-3" id="__codelineno-95-3" name="__codelineno-95-3"></a><span class="nx">API_BASE_URL</span><span class="o">:</span><span class="w"> </span><span class="kt">VersionedURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://some.tld/api/2"</span><span class="p">;</span>
<a href="#__codelineno-95-4" id="__codelineno-95-4" name="__codelineno-95-4"></a>
<a href="#__codelineno-95-5" id="__codelineno-95-5" name="__codelineno-95-5"></a><span class="nx">APIVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Number</span><span class="p">(</span><span class="nx">API_BASE_URL</span><span class="p">);</span>
<a href="#__codelineno-95-6" id="__codelineno-95-6" name="__codelineno-95-6"></a><span class="c1">// NaN</span>
</code></pre></div>
<p>Nope, TypeScript still doesn't see any problem with that. Yes, I know there's an explanation for why (how <code>Number(..)</code> itself is typed).</p>
<table>
<thead>
<tr>
<th align="left">NOTE:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">I imagine the really smart folks who <em>know</em> TypeScript well have creative ideas on how we can contort ourselves into raising an error there. Maybe there's even a dozen different ways to force TypeScript to trigger on that code. But that's not really the point.</td>
</tr>
</tbody>
</table>
<p>My point is, we cannot fully rely on TypeScript types to solve all our problems, letting us check out and remain blissfully unaware of the nuances of types and, in this case, coercion behaviors.</p>
<p>But! You're surely objecting to this line of argument, desperate to assert that even if TypeScript can't understand some specific situation, surely using TypeScript doesn't make it <em>worse</em>! Right!?</p>
<p>Let's look at what TypeScript has to say<sup id="fnref:TSExample1"><a class="footnote-ref" href="#fn:TSExample1">26</a></sup> about this line:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-96-1" id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">VersionedURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`https://some.tld/api/</span><span class="si">${</span><span class="kt">number</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<a href="#__codelineno-96-2" id="__codelineno-96-2" name="__codelineno-96-2"></a>
<a href="#__codelineno-96-3" id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="kd">let</span><span class="w"> </span><span class="nx">API_BASE_URL</span><span class="o">:</span><span class="w"> </span><span class="kt">VersionedURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://some.tld/api/2"</span><span class="p">;</span>
<a href="#__codelineno-96-4" id="__codelineno-96-4" name="__codelineno-96-4"></a>
<a href="#__codelineno-96-5" id="__codelineno-96-5" name="__codelineno-96-5"></a><span class="kd">let</span><span class="w"> </span><span class="nx">versionDigit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">API_BASE_URL</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\/api\/(\d+)$/</span><span class="p">)[</span><span class="mf">1</span><span class="p">];</span>
<a href="#__codelineno-96-6" id="__codelineno-96-6" name="__codelineno-96-6"></a><span class="c1">// Object is possibly 'null'.</span>
</code></pre></div>
<p>The error indicates that the <code>[1]</code> access isn't type-safe, because if the regular expression fails to find any match on the string, <code>match(..)</code> returns <code>null</code>.</p>
<p>You see, even though <em>I</em> can reason about the contents of the string compared to how the regular expression is written, and even if <em>I</em> went to the trouble to make it super clear to TypeScript exactly what those specific string contents are, it's not quite smart enough to line those two up to see that it's actually fully type-safe to assume the match happens.</p>
<table>
<thead>
<tr>
<th align="left">TIP:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Is it really the job of, and best use of, a type-aware tool to be contorted to express every single possible nuance of type-safety? We don't need perfect and universal tools to derive immense amounts of benefit from the stuff they <em>can</em> do.</td>
</tr>
</tbody>
</table>
<p>Moreover, comparing the code style in the previous section to the code in this section (with or without the annotations), is TypeScript actually making our coding more type-aware?</p>
<p>Like, does that <code>type VersionedURL = ..</code> and <code>API_BASE_URL: VersionedURL</code> stuff <em>actually</em> make our code more clearly type-aware? I don't necessarily think so.</p>
<h3 id="typescript-intelligence">TypeScript Intelligence<a class="headerlink" href="#typescript-intelligence" title="Permanent link">¶</a></h3>
<p>Yes, I hear you screaming at me through the computer screen. Yes, I know that TypeScript provides what type information it discovers (or infers) to your code editor, which comes through in the form of intelligent autocompletes, helpful inline warning markers, etc.</p>
<p>But I'm arguing that even <em>those</em> don't, in and of themselves, make you more type-aware as a developer</p>
<p>Why? Because type-awareness is <em>not</em> just about the authoring experience. It's also about the reading experience, maybe even moreso. And not all places/mechanisms where code is read, have access to benefit from all the extra intelligence.</p>
<p>Look, the magic of a language-server pumping intelligence into your code editor is unquestionably amazing. It's cool and super helpful.</p>
<p>And I don't begrudge TypeScript as a tool inferring things about my <strong>JS code</strong> and giving me hints and suggestions through delightful code editor integrations. I just don't necessarily want to <em>have</em> to annotate type information in some extremely specific way just to silence the tool's complaints.</p>
<h3 id="the-bar-above-typescript">The Bar Above TypeScript<a class="headerlink" href="#the-bar-above-typescript" title="Permanent link">¶</a></h3>
<p>But even if I did/had all that, it's still not <strong><em>sufficient</em></strong> for me to be fully type-aware, both as a code-author and as a code-reader.</p>
<p>These tools don't catch every type error that can happen, no matter how much we want to tell ourselves they can, and no matter how many hoops and contortions we endure to wish it so. All the efforts to coax and <em>coerce</em> a tool into catching those nuanced errors, through endlessly increasing complexity of type syntax tricks, is... at best, misplaced effort.</p>
<p>Moreover, no such tool is immune to false positives, complaining about things which aren't actually errors; these tools will never be as smart as we are as humans. You're really wasting your time in chasing down some quirky syntax trick to quite down the tool's complaints.</p>
<p>There's just no subsitute, if you want to truly be a type-aware code-author and code-reader, from learning how the language's built-in type systems work. And yes, that means every single developer on your team needs to spend the efforts to learn it. You can't water this stuff down just to be more attainable for less experienced developers on the project/team.</p>
<p>Even if we granted that you could avoid 100% of all <em>implicit</em> coercions -- you can't -- you are absolutely going to face the need to <em>explicit</em> coercions -- all programs do!</p>
<p>And if your response to that fact is to suggest that you'll just offload the mental burden of understanding them to a tool like TypeScript... then I'm sorry to tell you, but you're plainly and painfully falling short of the <em>type-aware</em> bar that I'm challenging all developers to strive towards.</p>
<p>I'm not advocating, here, for you to ditch TypeScript. If you like it, fine. But I am very explicitly and passionately challenging you: stop using TypeScript as a crutch. Stop prostrating yourself to appease the TypeScript engine overlords. Stop foolishly chasing every type rabbit down every syntactic hole.</p>
<p>From my observation, there's a tragic, inverse relationship between usage of type-aware tooling (like TypeScript) and the desire/effort to pursue actual type-awareness as a code-author and code-reader. The more you rely on TypeScript, the more it seems you're tempted and encouraged to shift your attention away from JS's type system (and especially, from coercion) to the alternate TypeScript type system.</p>
<p>Unfortunately, TypeScript can never fully escape JS's type system, because TypeScript's types are <em>erased</em> by the compiler, and what's left is just JS that the JS engine has to contend with.</p>
<table>
<thead>
<tr>
<th align="left">TIP:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Imagine if someone handed you a cup of filtered water to drink. And just before you took a sip, they said, "We extracted that water from the ground near a waste dump. But don't worry, we used a perfectly great filter, and that water is totally safe!" How much do you trust that filter? More to my overall point, wouldn't you feel more comfortable drinking that water if you understood everything about the source of the water, all the processes of filtration, and everything that was <em>in</em> the water of the glass in your hand!? Or is trusting that filter good enough?</td>
</tr>
</tbody>
</table>
<h3 id="type-aware-equality">Type Aware Equality<a class="headerlink" href="#type-aware-equality" title="Permanent link">¶</a></h3>
<p>I'll close this long, winding chapter with one final illustration, modeling how I think developers should -- armed with more critical thinking than bandwagon conformism -- approach type-aware coding, whether you use a tool like TypeScript or not.</p>
<p>We'll yet again revisit equality comparisons (<code>==</code> vs <code>===</code>), from the perspective of type-awareness. Earlier in this chapter, I promised that I would make the case for <code>==</code> over <code>===</code>, so here it goes.</p>
<p>Let's restate/summarize what we know about <code>==</code> and <code>===</code> so far:</p>
<ol>
<li>
<p>If the types of the operands for <code>==</code> match, it behaves <em>exactly the same</em> as <code>===</code>.</p>
</li>
<li>
<p>If the types of the operands for <code>===</code> do not match, it will always return <code>false</code>.</p>
</li>
<li>
<p>If the types of the operands for <code>==</code> do not match, it will allow coercion of either operand (generally preferring numeric type-values), until the types finally match; once they match, see (1).</p>
</li>
</ol>
<p>OK, so let's take those facts and analyze how they might interact in our program.</p>
<p>If you are making an equality comparison of <code>x</code> and <code>y</code> like this:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-97-1" id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="cm">/* are x and y equal */</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-97-2" id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-97-3" id="__codelineno-97-3" name="__codelineno-97-3"></a><span class="p">}</span>
</code></pre></div>
<p>What are the possible conditions we may be in, with respect to the types of <code>x</code> and <code>y</code>?</p>
<ol>
<li>
<p>We might know exactly what type(s) <code>x</code> and <code>y</code> could be, because we know how those variables are getting assigned.</p>
</li>
<li>
<p>Or we might not be able to tell what those types could be. It could be that <code>x</code> or <code>y</code> could be any type, or at least any of several different types, such that the possible combinations of types in the comparison are too complex to understand/predict.</p>
</li>
</ol>
<p>Can we agree that (1) is far preferable to (2)? Can we further agree that (1) represents having written our code in a type-aware fashion, whereas (2) represents code that is decidedly type-<em>unaware</em>?</p>
<p>If you're using TypeScript, you're very likely to be aware of the types of <code>x</code> and <code>y</code>, right? Even if you're not using TypeScript, we've already shown that you can take intentional steps to write your code in such a way that the types of <code>x</code> and <code>y</code> are known and obvious.</p>
<h4 id="2-unknown-types">(2) Unknown Types<a class="headerlink" href="#2-unknown-types" title="Permanent link">¶</a></h4>
<p>If you're in scenario (2), I'm going to assert that your code is in a problem state. Your code is less-than-ideal. Your code needs to be refactored. The best thing to do, if you find code in this state, is... fix it!</p>
<p>Change the code so it's type-aware. If that means using TypeScript, and even inserting some type annotations, do so. Or if you feel you can get to the type-aware state with <em>just JS</em>, do that. Either way, do whatever you can to get to scenario (1).</p>
<p>If you cannot ensure the code doing this equality comparison between <code>x</code> and <code>y</code> is type-aware, and you have no other options, then you absolutely <em>must</em> use the <code>===</code> strict-equality operator. Not doing so would be supremely irresponsible.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-98-1" id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-98-2" id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-98-3" id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="p">}</span>
</code></pre></div>
<p>If you don't know anything about the types, how could you (or any other future reader of your code) have any idea how the coercive steps in <code>==</code> are going to behave!? You can't.</p>
<p>The only responsible thing to do is, avoid coercion and use <code>===</code>.</p>
<p>But don't lose sight of this fact: you're only picking <code>===</code> as a last resort, when your code is so type-unaware -- ahem, type-broken! -- as to have no other choice.</p>
<h4 id="1-known-types">(1) Known Types<a class="headerlink" href="#1-known-types" title="Permanent link">¶</a></h4>
<p>OK, let's instead assume you're in scenario (1). You know the types of <code>x</code> and <code>y</code>. It's very clear in the code what this narrow set of types participating in the equality check can be.</p>
<p>Great!</p>
<p>But there's still two possible sub-conditions you may be in:</p>
<ul>
<li>
<p>(1a): <code>x</code> and <code>y</code> might already be of the same type, whether that be both are <code>string</code>s, <code>number</code>s, etc.</p>
</li>
<li>
<p>(1b): <code>x</code> and <code>y</code> might be of different types.</p>
</li>
</ul>
<p>Let's consider each of these cases individually.</p>
<h5 id="1a-known-matching-types">(1a) Known Matching Types<a class="headerlink" href="#1a-known-matching-types" title="Permanent link">¶</a></h5>
<p>If the types in the equality comparison match (whatever they are), we already know for certain that <code>==</code> and <code>===</code> do exactly the same thing. There's absolutely no difference.</p>
<p>Except, <code>==</code> <em>is</em> shorter by one character. Most developers feel instinctively that the most terse but equivalent version of something is often most preferable. That's not universal, of course, but it's a general preference at least.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-99-1" id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="c1">// this is best</span>
<a href="#__codelineno-99-2" id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-99-3" id="__codelineno-99-3" name="__codelineno-99-3"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-99-4" id="__codelineno-99-4" name="__codelineno-99-4"></a><span class="p">}</span>
</code></pre></div>
<p>In this particular case, an extra <code>=</code> would do nothing for us to make the code more clear. In fact, it actually would make the comparison worse!</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-100-1" id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="c1">// this is strictly worse here!</span>
<a href="#__codelineno-100-2" id="__codelineno-100-2" name="__codelineno-100-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-100-3" id="__codelineno-100-3" name="__codelineno-100-3"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-100-4" id="__codelineno-100-4" name="__codelineno-100-4"></a><span class="p">}</span>
</code></pre></div>
<p>Why is it worse?</p>
<p>Because in scenario (2), we already established that <code>===</code> is used for the last-resort when we don't know enough/anything about the types to be able to predict the outcome. We use <code>===</code> when we want to make sure we're avoiding coercion when we know coercion could occur.</p>
<p>But that doesn't apply here! We already know that no coercion would occur. There's no reason to confuse the reader with a <code>===</code> here. If you use <code>===</code> in a place where you already <em>know</em> the types -- and moreover, they're matched! -- that actually might send a mixed signal to the reader. They might have assumed they knew what would happen in the equality check, but then they see the <code>===</code> and they second guess themselves!</p>
<p>Again, to state it plainly, if you know the types of an equality comparison, and you know they match, there's only one right choice: <code>==</code>.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-101-1" id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="c1">// stick to this option</span>
<a href="#__codelineno-101-2" id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-101-3" id="__codelineno-101-3" name="__codelineno-101-3"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-101-4" id="__codelineno-101-4" name="__codelineno-101-4"></a><span class="p">}</span>
</code></pre></div>
<h5 id="1b-known-mismatched-types">(1b) Known Mismatched Types<a class="headerlink" href="#1b-known-mismatched-types" title="Permanent link">¶</a></h5>
<p>OK, we're in our final scenario. We need to compare <code>x</code> and <code>y</code>, and we know their types, but we also know their types are <strong>NOT</strong> the same.</p>
<p>Which operator should we use here?</p>
<p>If you pick <code>===</code>, you've made a huge mistake. Why!? Because <code>===</code> used with known-mismatched types will never, ever, ever return <code>true</code>. It will always fail.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-102-1" id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="c1">// `x` and `y` have different types?</span>
<a href="#__codelineno-102-2" id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-102-3" id="__codelineno-102-3" name="__codelineno-102-3"></a><span class="w">    </span><span class="c1">// congratulations, this code in here will NEVER run</span>
<a href="#__codelineno-102-4" id="__codelineno-102-4" name="__codelineno-102-4"></a><span class="p">}</span>
</code></pre></div>
<p>OK. So, <code>===</code> is out when the types are known and mismatched. What's our only other choice?</p>
<p>Well, actually, we again have two options. We <em>could</em> decide:</p>
<ul>
<li>
<p>(1b-1): Let's change the code so we're not trying to do an equality check with known mismatched types; that could involve explicitly coercing one or both values so they types now match, in which case pop back up to scenario (1a).</p>
</li>
<li>
<p>(1b-2): If we're going to compare known mismatched types for equality, and we want any hope of that check ever passing, we <em>must</em> used <code>==</code>, because it's the only one of the equality operators which can coerce one or both operands until the types match.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-103-1" id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="c1">// `x` and `y` have different types,</span>
<a href="#__codelineno-103-2" id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="c1">// so let's allow JS to coerce them</span>
<a href="#__codelineno-103-3" id="__codelineno-103-3" name="__codelineno-103-3"></a><span class="c1">// for equality comparison</span>
<a href="#__codelineno-103-4" id="__codelineno-103-4" name="__codelineno-103-4"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-103-5" id="__codelineno-103-5" name="__codelineno-103-5"></a><span class="w">    </span><span class="c1">// .. (so, you're saying there's a chance?)</span>
<a href="#__codelineno-103-6" id="__codelineno-103-6" name="__codelineno-103-6"></a><span class="p">}</span>
</code></pre></div>
<p>That's it. We're done. We've looked at every possible type-sensitive equality comparison condition (between <code>x</code> and <code>y</code>).</p>
<h4 id="summarizing-type-sensitive-equality-comparison">Summarizing Type-Sensitive Equality Comparison<a class="headerlink" href="#summarizing-type-sensitive-equality-comparison" title="Permanent link">¶</a></h4>
<p>The case for always preferring <code>==</code> over <code>===</code> is as follows:</p>
<ol>
<li>
<p>Whether you use TypeScript or not -- but especially if you <em>do</em> use TypeScript -- the goal should be to have every single part of the code, including all equality comparisons, be <em>type-aware</em>.</p>
</li>
<li>
<p>If you know the types, you should always prefer <code>==</code>.</p>
<ul>
<li>
<p>In the case where the types match, <code>==</code> is both shorter and more proper for the check.</p>
</li>
<li>
<p>In the case where the types are not matched, <code>==</code> is the only operator that can coerce operand(s) until the types match, so it's the only way such a check could ever hope to pass</p>
</li>
</ul>
</li>
<li>
<p>Finally, only if you <em>can't</em> know/predict the types, for some frustrating reason, and you have no other option, fall back to using <code>===</code> as a last resort. And probably add a code comment there admitting why <code>===</code> is being used, and maybe prompting some future developer to later change the code to fix that deficiency and remove the crutch of <code>===</code>.</p>
</li>
</ol>
<h4 id="typescripts-inconsistency-problem">TypeScript's Inconsistency Problem<a class="headerlink" href="#typescripts-inconsistency-problem" title="Permanent link">¶</a></h4>
<p>Let me be super clear: if you're using TypeScript properly, and you know the types of an equality comparison, using <code>===</code> for that comparison is just plain <em>wrong</em>! Period.</p>
<p>The problem is, TypeScript strangely and frustratingly still requires you to use <code>===</code>, unless it already knows that the types are matched.</p>
<p>That's because TypeScript either doesn't fully understand type-awareness and coercion, or -- and this is even more infuriating! -- it fully understands but it still despises JS's type system so much as to eschew even the most basic of type-aware reasoning.</p>
<p>Don't believe me? Think I'm being too harsh? Try this in TypeScript: <sup id="fnref:TSExample2"><a class="footnote-ref" href="#fn:TSExample2">27</a></sup></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-104-1" id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">42</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"42"</span><span class="p">);</span>
<a href="#__codelineno-104-2" id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="c1">// This condition will always return 'false' since</span>
<a href="#__codelineno-104-3" id="__codelineno-104-3" name="__codelineno-104-3"></a><span class="c1">// the types 'number' and 'string' have no overlap.</span>
</code></pre></div>
<p>I am at a loss for words to describe how aggravating that is to me. If you've paid attention to this long, heavy chapter, you know that TypeScript is basically telling a lie here. Of course <code>42 == "42"</code> will produce <code>true</code> in JS.</p>
<p>Well, it's not a lie, but it's exposing a fundamental truth that so many still don't fully appreciate: TypeScript completely tosses out the normal rules of JS's type system, because TypeScript's position is that JS's type system -- and especially, implicit coercion -- are bad, and need to be replaced.</p>
<p>In TypeScript's world, <code>42</code> and <code>"42"</code> can never be equal to each other. Hence the error message. But in JS land, <code>42</code> and <code>"42"</code> are absolutely coercively equal to each other. And I believe I've made a strong case here that they <em>should be</em> assumed to be safely coercively equivalent.</p>
<p>What bothers me even more is, TypeScript has a variety of inconsistencies in this respect. TypeScript is perfectly fine with the <em>implicit</em> coercion in this code:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-105-1" id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="nx">irony</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`The value '42' and </span><span class="si">${</span><span class="mf">42</span><span class="si">}</span><span class="sb"> are coercively equal.`</span><span class="p">;</span>
</code></pre></div>
<p>The <code>42</code> gets implicitly coerced to a string when interpolating it into the sentence. Why is TypeScript ok with this implicit coercion, but not the <code>42 == "42"</code> implicit coercion?</p>
<p>TypeScript has no complaints about this code, either:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-106-1" id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="nx">API_BASE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://some.tld/api/2"</span><span class="p">;</span>
<a href="#__codelineno-106-2" id="__codelineno-106-2" name="__codelineno-106-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">API_BASE_URL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-106-3" id="__codelineno-106-3" name="__codelineno-106-3"></a><span class="w">    </span><span class="c1">// ..</span>
<a href="#__codelineno-106-4" id="__codelineno-106-4" name="__codelineno-106-4"></a><span class="p">}</span>
</code></pre></div>
<p>Why is <code>ToBoolean()</code> an OK implicit coercion, but <code>ToNumber()</code> in the <code>==</code> algorithm is not?</p>
<p>I will leave you to ponder this: do you really think it's a good idea to write code that will ultimately run in a JS engine, but use a tool and style of code that has intentionally ejected most of an entire pillar of the JS language? Moreover, is it fine that it's also flip-flopped with a variety of inconsistent exceptions, simply to cater to the old habits of JS developers?</p>
<h2 id="whats-left">What's Left?<a class="headerlink" href="#whats-left" title="Permanent link">¶</a></h2>
<p>I hope by now you're feeling a lot more informed about how JS's type system works, from primitive value types to the object types, to how type coercions are performed by the engine.</p>
<p>More importantly, you also now have a much more complete picture of the pros/cons of the choices we make using JS's type system, such as choosing <em>implicit</em> or <em>explicit</em> coercions at different points.</p>
<p>But we haven't fully covered the context in which the type system operates. For the remainder of this book, we'll turn our attention to the syntax/grammar rules of JS that govern how operators and statements behave.</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:EichCoercion">
<p>"The State of JavaScript - Brendan Eich", comment thread, Hacker News; Oct 9 2012; https://news.ycombinator.com/item?id=4632704 ; Accessed August 2022 <a class="footnote-backref" href="#fnref:EichCoercion" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:CrockfordCoercion">
<p>"JavaScript: The World's Most Misunderstood Programming Language"; 2001; https://www.crockford.com/javascript/javascript.html ; Accessed August 2022 <a class="footnote-backref" href="#fnref:CrockfordCoercion" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:CrockfordIfs">
<p>"json2.js", Github; Apr 21 2018; https://github.com/douglascrockford/JSON-js/blob/8e8b0407e475e35942f7e9461dab81929fcc7321/json2.js#L336 ; Accessed August 2022 <a class="footnote-backref" href="#fnref:CrockfordIfs" title="Jump back to footnote 3 in the text">↩</a><a class="footnote-backref" href="#fnref2:CrockfordIfs" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:BrendanToString">
<p>ESDiscuss mailing list; Aug 26 2014; https://esdiscuss.org/topic/string-symbol#content-15 ; Accessed August 2022 <a class="footnote-backref" href="#fnref:BrendanToString" title="Jump back to footnote 4 in the text">↩</a><a class="footnote-backref" href="#fnref2:BrendanToString" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
<li id="fn:AbstractOperations">
<p>"7.1 Type Conversion", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-type-conversion ; Accessed August 2022 <a class="footnote-backref" href="#fnref:AbstractOperations" title="Jump back to footnote 5 in the text">↩</a></p>
</li>
<li id="fn:ToBoolean">
<p>"7.1.2 ToBoolean(argument)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-toboolean ; Accessed August 2022 <a class="footnote-backref" href="#fnref:ToBoolean" title="Jump back to footnote 6 in the text">↩</a></p>
</li>
<li id="fn:ExoticFalsyObjects">
<p>"B.3.6 The [[IsHTMLDDA]] Internal Slot", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-IsHTMLDDA-internal-slot ; Accessed August 2022 <a class="footnote-backref" href="#fnref:ExoticFalsyObjects" title="Jump back to footnote 7 in the text">↩</a><a class="footnote-backref" href="#fnref2:ExoticFalsyObjects" title="Jump back to footnote 7 in the text">↩</a><a class="footnote-backref" href="#fnref3:ExoticFalsyObjects" title="Jump back to footnote 7 in the text">↩</a></p>
</li>
<li id="fn:OrdinaryToPrimitive">
<p>"7.1.1.1 OrdinaryToPrimitive(O,hint)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-ordinarytoprimitive ; Accessed August 2022 <a class="footnote-backref" href="#fnref:OrdinaryToPrimitive" title="Jump back to footnote 8 in the text">↩</a></p>
</li>
<li id="fn:ToString">
<p>"7.1.17 ToString(argument)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-tostring ; Accessed August 2022 <a class="footnote-backref" href="#fnref:ToString" title="Jump back to footnote 9 in the text">↩</a></p>
</li>
<li id="fn:StringConstructor">
<p>"22.1.1 The String Constructor", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-string-constructor ; Accessed August 2022 <a class="footnote-backref" href="#fnref:StringConstructor" title="Jump back to footnote 10 in the text">↩</a></p>
</li>
<li id="fn:StringFunction">
<p>"22.1.1.1 String(value)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-string-constructor-string-value ; Accessed August 2022 <a class="footnote-backref" href="#fnref:StringFunction" title="Jump back to footnote 11 in the text">↩</a></p>
</li>
<li id="fn:ToNumber">
<p>"7.1.4 ToNumber(argument)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-tonumber ; Accessed August 2022 <a class="footnote-backref" href="#fnref:ToNumber" title="Jump back to footnote 12 in the text">↩</a></p>
</li>
<li id="fn:ToNumeric">
<p>"7.1.3 ToNumeric(argument)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-tonumeric ; Accessed August 2022 <a class="footnote-backref" href="#fnref:ToNumeric" title="Jump back to footnote 13 in the text">↩</a></p>
</li>
<li id="fn:NumberConstructor">
<p>"21.1.1 The Number Constructor", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-number-constructor ; Accessed August 2022 <a class="footnote-backref" href="#fnref:NumberConstructor" title="Jump back to footnote 14 in the text">↩</a></p>
</li>
<li id="fn:NumberFunction">
<p>"21.1.1.1 Number(value)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-number-constructor-number-value ; Accessed August 2022 <a class="footnote-backref" href="#fnref:NumberFunction" title="Jump back to footnote 15 in the text">↩</a></p>
</li>
<li id="fn:SameValue">
<p>"7.2.11 SameValue(x,y)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-samevalue ; Accessed August 2022 <a class="footnote-backref" href="#fnref:SameValue" title="Jump back to footnote 16 in the text">↩</a><a class="footnote-backref" href="#fnref2:SameValue" title="Jump back to footnote 16 in the text">↩</a></p>
</li>
<li id="fn:StrictEquality">
<p>"7.2.16 IsStrictlyEqual(x,y)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-isstrictlyequal ; Accessed August 2022 <a class="footnote-backref" href="#fnref:StrictEquality" title="Jump back to footnote 17 in the text">↩</a><a class="footnote-backref" href="#fnref2:StrictEquality" title="Jump back to footnote 17 in the text">↩</a></p>
</li>
<li id="fn:LooseEquality">
<p>"7.2.15 IsLooselyEqual(x,y)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-islooselyequal ; Accessed August 2022 <a class="footnote-backref" href="#fnref:LooseEquality" title="Jump back to footnote 18 in the text">↩</a><a class="footnote-backref" href="#fnref2:LooseEquality" title="Jump back to footnote 18 in the text">↩</a><a class="footnote-backref" href="#fnref3:LooseEquality" title="Jump back to footnote 18 in the text">↩</a></p>
</li>
<li id="fn:NumericAbstractOps">
<p>"6.1.6 Numeric Types", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-numeric-types ; Accessed August 2022 <a class="footnote-backref" href="#fnref:NumericAbstractOps" title="Jump back to footnote 19 in the text">↩</a><a class="footnote-backref" href="#fnref2:NumericAbstractOps" title="Jump back to footnote 19 in the text">↩</a></p>
</li>
<li id="fn:NumberEqual">
<p>"6.1.6.1.13 Number:equal(x,y)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-numeric-types-number-equal ; Accessed August 2022 <a class="footnote-backref" href="#fnref:NumberEqual" title="Jump back to footnote 20 in the text">↩</a></p>
</li>
<li id="fn:BigIntEqual">
<p>"6.1.6.2.13 BigInt:equal(x,y)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-numeric-types-bigint-equal ; Accessed August 2022 <a class="footnote-backref" href="#fnref:BigIntEqual" title="Jump back to footnote 21 in the text">↩</a></p>
</li>
<li id="fn:LessThan">
<p>"7.2.14 IsLessThan(x,y,LeftFirst)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-islessthan ; Accessed August 2022 <a class="footnote-backref" href="#fnref:LessThan" title="Jump back to footnote 22 in the text">↩</a></p>
</li>
<li id="fn:StringPrefix">
<p>"7.2.9 IsStringPrefix(p,q)", ECMAScript 2022 Language Specification; https://262.ecma-international.org/13.0/#sec-isstringprefix ; Accessed August 2022 <a class="footnote-backref" href="#fnref:StringPrefix" title="Jump back to footnote 23 in the text">↩</a></p>
</li>
<li id="fn:SymbolString">
<p>"String(symbol)", ESDiscuss mailing list; Aug 12 2014; https://esdiscuss.org/topic/string-symbol ; Accessed August 2022 <a class="footnote-backref" href="#fnref:SymbolString" title="Jump back to footnote 24 in the text">↩</a></p>
</li>
<li id="fn:ASMjs">
<p>"ASM.js - Working Draft"; Aug 18 2014; http://asmjs.org/spec/latest/ ; Accessed August 2022 <a class="footnote-backref" href="#fnref:ASMjs" title="Jump back to footnote 25 in the text">↩</a></p>
</li>
<li id="fn:TSExample1">
<p>"TypeScript Playground"; https://tinyurl.com/ydkjs-ts-example-1 ; Accessed August 2022 <a class="footnote-backref" href="#fnref:TSExample1" title="Jump back to footnote 26 in the text">↩</a></p>
</li>
<li id="fn:TSExample2">
<p>"TypeScript Playground"; https://tinyurl.com/ydkjs-ts-example-2 ; Accessed August 2022 <a class="footnote-backref" href="#fnref:TSExample2" title="Jump back to footnote 27 in the text">↩</a></p>
</li>
<li id="fn:TSLiteralTypes">
<p>"TypeScript 4.1, Template Literal Types"; https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html#template-literal-types ; Accessed August 2022 <a class="footnote-backref" href="#fnref:TSLiteralTypes" title="Jump back to footnote 28 in the text">↩</a></p>
</li>
</ol>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Chapter 3: Object Values" class="md-footer__link md-footer__link--prev" href="../ch3/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                  Previous
                </span>
                Chapter 3: Object Values
              </div>
</div>
</a>
<a aria-label="Next: nucamp notes" class="md-footer__link md-footer__link--next" href="../../../nucamp/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                  Next
                </span>
                nucamp notes
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://shanenull.com/" rel="noopener" target="_blank" title="shanenull.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M256 8C119.3 8 8 119.2 8 256c0 136.7 111.3 248 248 248s248-111.3 248-248C504 119.2 392.7 8 256 8zM33 256c0-32.3 6.9-63 19.3-90.7l106.4 291.4C84.3 420.5 33 344.2 33 256zm223 223c-21.9 0-43-3.2-63-9.1l66.9-194.4 68.5 187.8c.5 1.1 1 2.1 1.6 3.1-23.1 8.1-48 12.6-74 12.6zm30.7-327.5c13.4-.7 25.5-2.1 25.5-2.1 12-1.4 10.6-19.1-1.4-18.4 0 0-36.1 2.8-59.4 2.8-21.9 0-58.7-2.8-58.7-2.8-12-.7-13.4 17.7-1.4 18.4 0 0 11.4 1.4 23.4 2.1l34.7 95.2L200.6 393l-81.2-241.5c13.4-.7 25.5-2.1 25.5-2.1 12-1.4 10.6-19.1-1.4-18.4 0 0-36.1 2.8-59.4 2.8-4.2 0-9.1-.1-14.4-.3C109.6 73 178.1 33 256 33c58 0 110.9 22.2 150.6 58.5-1-.1-1.9-.2-2.9-.2-21.9 0-37.4 19.1-37.4 39.6 0 18.4 10.6 33.9 21.9 52.3 8.5 14.8 18.4 33.9 18.4 61.5 0 19.1-7.3 41.2-17 72.1l-22.2 74.3-80.7-239.6zm81.4 297.2 68.1-196.9c12.7-31.8 17-57.2 17-79.9 0-8.2-.5-15.8-1.5-22.9 17.4 31.8 27.3 68.2 27.3 107 0 82.3-44.6 154.1-110.9 192.7z"></path></svg>
</a>
<a class="md-social__link" href="https://shane0.pythonanywhere.com/" rel="noopener" target="_blank" title="shane0.pythonanywhere.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"></path></svg>
</a>
<a class="md-social__link" href="http://www.youtube.com/c/ShaneNull" rel="noopener" target="_blank" title="www.youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg>
</a>
<a class="md-social__link" href="https://www.instagram.com/nullshane/" rel="noopener" target="_blank" title="www.instagram.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg>
</a>
<a class="md-social__link" href="https://earmassagetherapist.bandcamp.com/releases" rel="noopener" target="_blank" title="earmassagetherapist.bandcamp.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8Zm48.2 326.1h-181L207.9 178h181Z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/shane0" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://gitlab.com/shane0" rel="noopener" target="_blank" title="gitlab.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/shane_null" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/in/shanenull" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.action.edit", "content.action.view", "navigation.footer"], "search": "../../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": 2023, "provider": "mike"}}</script>
<script src="../../../assets/javascripts/bundle.51d95adb.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js?tex"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>